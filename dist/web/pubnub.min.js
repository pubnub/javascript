!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).PubNub=t()}(this,(function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function i(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function u(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function p(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var l={exports:{}};!function(e){!function(t,n){var r=Math.pow(2,-24),i=Math.pow(2,32),o=Math.pow(2,53);var s={encode:function(e){var t,r=new ArrayBuffer(256),s=new DataView(r),a=0;function u(e){for(var n=r.byteLength,i=a+e;n<i;)n*=2;if(n!==r.byteLength){var o=s;r=new ArrayBuffer(n),s=new DataView(r);for(var u=a+3>>2,c=0;c<u;++c)s.setUint32(4*c,o.getUint32(4*c))}return t=e,s}function c(){a+=t}function p(e){c(u(1).setUint8(a,e))}function l(e){for(var t=u(e.length),n=0;n<e.length;++n)t.setUint8(a+n,e[n]);c()}function h(e,t){t<24?p(e<<5|t):t<256?(p(e<<5|24),p(t)):t<65536?(p(e<<5|25),function(e){c(u(2).setUint16(a,e))}(t)):t<4294967296?(p(e<<5|26),function(e){c(u(4).setUint32(a,e))}(t)):(p(e<<5|27),function(e){var t=e%i,n=(e-t)/i,r=u(8);r.setUint32(a,n),r.setUint32(a+4,t),c()}(t))}if(function e(t){var r;if(!1===t)return p(244);if(!0===t)return p(245);if(null===t)return p(246);if(t===n)return p(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=o)return h(0,t);if(-o<=t&&t<0)return h(1,-(t+1))}return p(251),function(e){c(u(8).setFloat64(a,e))}(t);case"string":var i=[];for(r=0;r<t.length;++r){var s=t.charCodeAt(r);s<128?i.push(s):s<2048?(i.push(192|s>>6),i.push(128|63&s)):s<55296?(i.push(224|s>>12),i.push(128|s>>6&63),i.push(128|63&s)):(s=(1023&s)<<10,s|=1023&t.charCodeAt(++r),s+=65536,i.push(240|s>>18),i.push(128|s>>12&63),i.push(128|s>>6&63),i.push(128|63&s))}return h(3,i.length),l(i);default:var f;if(Array.isArray(t))for(h(4,f=t.length),r=0;r<f;++r)e(t[r]);else if(t instanceof Uint8Array)h(2,t.length),l(t);else{var d=Object.keys(t);for(h(5,f=d.length),r=0;r<f;++r){var y=d[r];e(y),e(t[y])}}}}(e),"slice"in r)return r.slice(0,a);for(var f=new ArrayBuffer(a),d=new DataView(f),y=0;y<a;++y)d.setUint8(y,s.getUint8(y));return f},decode:function(e,t,o){var s=new DataView(e),a=0;function u(e,t){return a+=t,e}function c(t){return u(new Uint8Array(e,a,t),t)}function p(){return u(s.getUint8(a),1)}function l(){return u(s.getUint16(a),2)}function h(){return u(s.getUint32(a),4)}function f(){return 255===s.getUint8(a)&&(a+=1,!0)}function d(e){if(e<24)return e;if(24===e)return p();if(25===e)return l();if(26===e)return h();if(27===e)return h()*i+h();if(31===e)return-1;throw"Invalid length encoding"}function y(e){var t=p();if(255===t)return-1;var n=d(31&t);if(n<0||t>>5!==e)throw"Invalid indefinite length element";return n}function g(e,t){for(var n=0;n<t;++n){var r=p();128&r&&(r<224?(r=(31&r)<<6|63&p(),t-=1):r<240?(r=(15&r)<<12|(63&p())<<6|63&p(),t-=2):(r=(15&r)<<18|(63&p())<<12|(63&p())<<6|63&p(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof o&&(o=function(){return n});var v=function e(){var i,h,v=p(),b=v>>5,m=31&v;if(7===b)switch(m){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),n=l(),i=32768&n,o=31744&n,s=1023&n;if(31744===o)o=261120;else if(0!==o)o+=114688;else if(0!==s)return s*r;return t.setUint32(0,i<<16|o<<13|s<<13),t.getFloat32(0)}();case 26:return u(s.getFloat32(a),4);case 27:return u(s.getFloat64(a),8)}if((h=d(m))<0&&(b<2||6<b))throw"Invalid length";switch(b){case 0:return h;case 1:return-1-h;case 2:if(h<0){for(var w=[],S=0;(h=y(b))>=0;)S+=h,w.push(c(h));var k=new Uint8Array(S),P=0;for(i=0;i<w.length;++i)k.set(w[i],P),P+=w[i].length;return k}return c(h);case 3:var E=[];if(h<0)for(;(h=y(b))>=0;)g(E,h);else g(E,h);return String.fromCharCode.apply(null,E);case 4:var O;if(h<0)for(O=[];!f();)O.push(e());else for(O=new Array(h),i=0;i<h;++i)O[i]=e();return O;case 5:var C={};for(i=0;i<h||h<0&&!f();++i){C[e()]=e()}return C;case 6:return t(e(),h);case 7:switch(h){case 20:return!1;case 21:return!0;case 22:return null;case 23:return n;default:return o(h)}}}();if(a!==e.byteLength)throw"Remaining bytes";return v}};e.exports?e.exports=s:t.CBOR||(t.CBOR=s)}(c)}(l);var h=p(l.exports),f=function(){function e(e){var t;this.defaultCryptor=e.default,this.cryptors=null!==(t=e.cryptors)&&void 0!==t?t:[]}return e.legacyCryptoModule=function(e){throw new Error("Should be implemented by concrete crypto module implementation.")},e.aesCbcCryptoModule=function(e){throw new Error("Should be implemented by concrete crypto module implementation.")},e.prototype.getAllCryptors=function(){return u([this.defaultCryptor],a(this.cryptors),!1)},e.encoder=new TextEncoder,e.decoder=new TextDecoder,e}(),d=function(){function e(e){var t,n,r;if(e instanceof File)r=e,n=e.name,t=e.type;else if("data"in e){var i=e.data;t=e.mimeType,n=e.name,r=new File([i],n,{type:t})}if(void 0===r)throw new Error("Couldn't construct a file out of supplied options.");if(void 0===n)throw new Error("Couldn't guess filename out of the options. Please provide one.");this.mimeType=t,this.data=r,this.name=n}return e.create=function(t){return new e(t)},e.prototype.toBuffer=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("This feature is only supported in Node.js environments.")}))}))},e.prototype.toArrayBuffer=function(){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){return[2,new Promise((function(t,n){var r=new FileReader;r.addEventListener("load",(function(){if(r.result instanceof ArrayBuffer)return t(r.result)})),r.addEventListener("error",(function(){return n(r.error)})),r.readAsArrayBuffer(e.data)}))]}))}))},e.prototype.toString=function(){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){return[2,new Promise((function(t,n){var r=new FileReader;r.addEventListener("load",(function(){if("string"==typeof r.result)return t(r.result)})),r.addEventListener("error",(function(){n(r.error)})),r.readAsBinaryString(e.data)}))]}))}))},e.prototype.toStream=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("This feature is only supported in Node.js environments.")}))}))},e.prototype.toFile=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.data]}))}))},e.prototype.toFileUri=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){throw new Error("This feature is only supported in React Native environments.")}))}))},e.prototype.toBlob=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.data]}))}))},e.supportsBlob="undefined"!=typeof Blob,e.supportsFile="undefined"!=typeof File,e.supportsBuffer=!1,e.supportsStream=!1,e.supportsString=!0,e.supportsArrayBuffer=!0,e.supportsEncryptFile=!0,e.supportsFileUri=!1,e}();function y(e){var t=e.replace(/==?$/,""),n=Math.floor(t.length/4*3),r=new ArrayBuffer(n),i=new Uint8Array(r),o=0;function s(){var e=t.charAt(o++),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(e);if(-1===n)throw new Error("Illegal character at ".concat(o,": ").concat(t.charAt(o-1)));return n}for(var a=0;a<n;a+=3){var u=s(),c=s(),p=s(),l=s(),h=(63&u)<<2|c>>4,f=(15&c)<<4|p>>2,d=(3&p)<<6|l;i[a]=h,64!=p&&(i[a+1]=f),64!=l&&(i[a+2]=d)}return r}function g(e){for(var t,n="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(e),o=i.byteLength,s=o%3,a=o-s,u=0;u<a;u+=3)n+=r[(16515072&(t=i[u]<<16|i[u+1]<<8|i[u+2]))>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==s?n+=r[(252&(t=i[a]))>>2]+r[(3&t)<<4]+"==":2==s&&(n+=r[(64512&(t=i[a]<<8|i[a+1]))>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n}var v=function(e){function n(t,n){var r=this.constructor,i=e.call(this,t)||this;return i.status=n,i.name=i.constructor.name,i.message=t,Object.setPrototypeOf(i,r.prototype),i}return t(n,e),n}(Error);function b(e,t){return r=n({message:e},void 0!==t?{statusCode:t}:{}),i="validationError",null!==(o=r.statusCode)&&void 0!==o||(r.statusCode=0),n(n({},r),{statusCode:r.statusCode,error:!0,type:i});var r,i,o}var m,w,S,k,P,E=E||function(e,t){var n={},r=n.lib={},i=function(){},o=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),a=n.enc={},u=a.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},p=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,a=i/(4*o);if(t=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,i=e.min(4*t,i),t){for(var u=0;u<t;u+=o)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new s.init(u,i)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=l.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){for(var t=E,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,o=[],s=[],a=function(e){return 4294967296*(e-(0|e))|0},u=2,c=0;64>c;){var p;e:{p=u;for(var l=e.sqrt(p),h=2;h<=l;h++)if(!(p%h)){p=!1;break e}p=!0}p&&(8>c&&(o[c]=a(e.pow(u,.5))),s[c]=a(e.pow(u,1/3)),c++),u++}var f=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],a=n[3],u=n[4],c=n[5],p=n[6],l=n[7],h=0;64>h;h++){if(16>h)f[h]=0|e[t+h];else{var d=f[h-15],y=f[h-2];f[h]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+f[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+f[h-16]}d=l+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&p)+s[h]+f[h],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&o^i&o),l=p,p=c,c=u,u=a+d|0,a=o,o=i,i=r,r=d+y|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+p|0,n[7]=n[7]+l|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math),w=(m=E).enc.Utf8,m.algo.HMAC=m.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=w.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,a=o.words,u=0;u<n;u++)s[u]^=1549556828,a[u]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),k=(S=E).lib.WordArray,S.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;4>s&&i+.75*s<n;s++)e.push(r.charAt(o>>>6*(3-s)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(r=n.charAt(64))&&-1!=(r=e.indexOf(r))&&(t=r);for(var r=[],i=0,o=0;o<t;o++)if(o%4){var s=n.indexOf(e.charAt(o-1))<<o%4*2,a=n.indexOf(e.charAt(o))>>>6-o%4*2;r[i>>>2]|=(s|a)<<24-i%4*8,i++}return k.create(r,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,r,i,o,s){return((e=e+(t&n|~t&r)+i+s)<<o|e>>>32-o)+t}function n(e,t,n,r,i,o,s){return((e=e+(t&r|n&~r)+i+s)<<o|e>>>32-o)+t}function r(e,t,n,r,i,o,s){return((e=e+(t^n^r)+i+s)<<o|e>>>32-o)+t}function i(e,t,n,r,i,o,s){return((e=e+(n^(t|~r))+i+s)<<o|e>>>32-o)+t}for(var o=E,s=(u=o.lib).WordArray,a=u.Hasher,u=o.algo,c=[],p=0;64>p;p++)c[p]=4294967296*e.abs(e.sin(p+1))|0;u=u.MD5=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var s=0;16>s;s++){var a=e[u=o+s];e[u]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}s=this._hash.words;var u=e[o+0],p=(a=e[o+1],e[o+2]),l=e[o+3],h=e[o+4],f=e[o+5],d=e[o+6],y=e[o+7],g=e[o+8],v=e[o+9],b=e[o+10],m=e[o+11],w=e[o+12],S=e[o+13],k=e[o+14],P=e[o+15],E=t(E=s[0],_=s[1],C=s[2],O=s[3],u,7,c[0]),O=t(O,E,_,C,a,12,c[1]),C=t(C,O,E,_,p,17,c[2]),_=t(_,C,O,E,l,22,c[3]);E=t(E,_,C,O,h,7,c[4]),O=t(O,E,_,C,f,12,c[5]),C=t(C,O,E,_,d,17,c[6]),_=t(_,C,O,E,y,22,c[7]),E=t(E,_,C,O,g,7,c[8]),O=t(O,E,_,C,v,12,c[9]),C=t(C,O,E,_,b,17,c[10]),_=t(_,C,O,E,m,22,c[11]),E=t(E,_,C,O,w,7,c[12]),O=t(O,E,_,C,S,12,c[13]),C=t(C,O,E,_,k,17,c[14]),E=n(E,_=t(_,C,O,E,P,22,c[15]),C,O,a,5,c[16]),O=n(O,E,_,C,d,9,c[17]),C=n(C,O,E,_,m,14,c[18]),_=n(_,C,O,E,u,20,c[19]),E=n(E,_,C,O,f,5,c[20]),O=n(O,E,_,C,b,9,c[21]),C=n(C,O,E,_,P,14,c[22]),_=n(_,C,O,E,h,20,c[23]),E=n(E,_,C,O,v,5,c[24]),O=n(O,E,_,C,k,9,c[25]),C=n(C,O,E,_,l,14,c[26]),_=n(_,C,O,E,g,20,c[27]),E=n(E,_,C,O,S,5,c[28]),O=n(O,E,_,C,p,9,c[29]),C=n(C,O,E,_,y,14,c[30]),E=r(E,_=n(_,C,O,E,w,20,c[31]),C,O,f,4,c[32]),O=r(O,E,_,C,g,11,c[33]),C=r(C,O,E,_,m,16,c[34]),_=r(_,C,O,E,k,23,c[35]),E=r(E,_,C,O,a,4,c[36]),O=r(O,E,_,C,h,11,c[37]),C=r(C,O,E,_,y,16,c[38]),_=r(_,C,O,E,b,23,c[39]),E=r(E,_,C,O,S,4,c[40]),O=r(O,E,_,C,u,11,c[41]),C=r(C,O,E,_,l,16,c[42]),_=r(_,C,O,E,d,23,c[43]),E=r(E,_,C,O,v,4,c[44]),O=r(O,E,_,C,w,11,c[45]),C=r(C,O,E,_,P,16,c[46]),E=i(E,_=r(_,C,O,E,p,23,c[47]),C,O,u,6,c[48]),O=i(O,E,_,C,y,10,c[49]),C=i(C,O,E,_,k,15,c[50]),_=i(_,C,O,E,f,21,c[51]),E=i(E,_,C,O,w,6,c[52]),O=i(O,E,_,C,l,10,c[53]),C=i(C,O,E,_,b,15,c[54]),_=i(_,C,O,E,a,21,c[55]),E=i(E,_,C,O,g,6,c[56]),O=i(O,E,_,C,P,10,c[57]),C=i(C,O,E,_,d,15,c[58]),_=i(_,C,O,E,S,21,c[59]),E=i(E,_,C,O,h,6,c[60]),O=i(O,E,_,C,m,10,c[61]),C=i(C,O,E,_,p,15,c[62]),_=i(_,C,O,E,v,21,c[63]);s[0]=s[0]+E|0,s[1]=s[1]+_|0,s[2]=s[2]+C|0,s[3]=s[3]+O|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=a._createHelper(u),o.HmacMD5=a._createHmacHelper(u)}(Math),function(){var e,t=E,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(a=this.cfg).hasher.create(),i=r.create(),o=i.words,s=a.keySize,a=a.iterations;o.length<s;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var c=1;c<a;c++)u=n.finalize(u),n.reset();i.concat(u)}return i.sigBytes=4*s,i}});t.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}}(),E.lib.Cipher||function(e){var t=(f=E).lib,n=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,o=f.enc.Base64,s=f.algo.EvpKDF,a=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?d:h).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?d:h).decrypt(e,t,n,r)}}}});t.StreamCipher=a.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var u=f.mode={},c=function(e,t,n){var r=this._iv;r?this._iv=undefined:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},p=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();p.Encryptor=p.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;c.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),p.Decryptor=p.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),c.call(this,e,t,r),this._prevBlock=i}}),u=u.CBC=p,p=(f.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,o=[],s=0;s<n;s+=4)o.push(i);n=r.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=a.extend({cfg:a.cfg.extend({mode:u,padding:p}),reset:function(){a.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var l=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(u=(f.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t=(e=o.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return l.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:u}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,l.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),f=(f.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=s.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,l.create({key:e,iv:n,salt:i})}},d=t.PasswordBasedCipher=h.extend({cfg:h.cfg.extend({kdf:f}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=h.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,h.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=E,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],o=[],s=[],a=[],u=[],c=[],p=[],l=[],h=[],f=[],d=0;256>d;d++)f[d]=128>d?d<<1:d<<1^283;var y=0,g=0;for(d=0;256>d;d++){var v=(v=g^g<<1^g<<2^g<<3^g<<4)>>>8^255&v^99;r[y]=v,i[v]=y;var b=f[y],m=f[b],w=f[m],S=257*f[v]^16843008*v;o[y]=S<<24|S>>>8,s[y]=S<<16|S>>>16,a[y]=S<<8|S>>>24,u[y]=S,S=16843009*w^65537*m^257*b^16843008*y,c[v]=S<<24|S>>>8,p[v]=S<<16|S>>>16,l[v]=S<<8|S>>>24,h[v]=S,y?(y=b^f[f[f[w^b]]],g^=f[f[g]]):y=g=1}var k=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],o=0;o<n;o++)if(o<t)i[o]=e[o];else{var s=i[o-1];o%t?6<t&&4==o%t&&(s=r[s>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s]):(s=r[(s=s<<8|s>>>24)>>>24]<<24|r[s>>>16&255]<<16|r[s>>>8&255]<<8|r[255&s],s^=k[o/t|0]<<24),i[o]=i[o-t]^s}for(e=this._invKeySchedule=[],t=0;t<n;t++)o=n-t,s=t%4?i[o]:i[o-4],e[t]=4>t||4>=o?s:c[r[s>>>24]]^p[r[s>>>16&255]]^l[r[s>>>8&255]]^h[r[255&s]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,s,a,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,c,p,l,h,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,s,a){for(var u=this._nRounds,c=e[t]^n[0],p=e[t+1]^n[1],l=e[t+2]^n[2],h=e[t+3]^n[3],f=4,d=1;d<u;d++){var y=r[c>>>24]^i[p>>>16&255]^o[l>>>8&255]^s[255&h]^n[f++],g=r[p>>>24]^i[l>>>16&255]^o[h>>>8&255]^s[255&c]^n[f++],v=r[l>>>24]^i[h>>>16&255]^o[c>>>8&255]^s[255&p]^n[f++];h=r[h>>>24]^i[c>>>16&255]^o[p>>>8&255]^s[255&l]^n[f++],c=y,p=g,l=v}y=(a[c>>>24]<<24|a[p>>>16&255]<<16|a[l>>>8&255]<<8|a[255&h])^n[f++],g=(a[p>>>24]<<24|a[l>>>16&255]<<16|a[h>>>8&255]<<8|a[255&c])^n[f++],v=(a[l>>>24]<<24|a[h>>>16&255]<<16|a[c>>>8&255]<<8|a[255&p])^n[f++],h=(a[h>>>24]<<24|a[c>>>16&255]<<16|a[p>>>8&255]<<8|a[255&l])^n[f++],e[t]=y,e[t+1]=g,e[t+2]=v,e[t+3]=h},keySize:8});e.AES=t._createHelper(n)}(),E.mode.ECB=((P=E.lib.BlockCipherMode.extend()).Encryptor=P.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),P.Decryptor=P.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),P);var O=p(E),C=function(){function e(e){var t=e.cipherKey;this.cipherKey=t,this.CryptoJS=O,this.encryptedKey=this.CryptoJS.SHA256(t)}return e.prototype.encrypt=function(t){if(0===("string"==typeof t?t:e.decoder.decode(t)).length)throw new Error("encryption error. empty content");var n=this.getIv();return{metadata:n,data:y(this.CryptoJS.AES.encrypt(t,this.encryptedKey,{iv:this.bufferToWordArray(n),mode:this.CryptoJS.mode.CBC}).ciphertext.toString(this.CryptoJS.enc.Base64))}},e.prototype.encryptFileData=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return[4,this.getKey()];case 1:return t=i.sent(),n=this.getIv(),r={},[4,crypto.subtle.encrypt({name:this.algo,iv:n},t,e)];case 2:return[2,(r.data=i.sent(),r.metadata=n,r)]}}))}))},e.prototype.decrypt=function(t){var n=this.bufferToWordArray(new Uint8ClampedArray(t.metadata)),r=this.bufferToWordArray(new Uint8ClampedArray(t.data));return e.encoder.encode(this.CryptoJS.AES.decrypt({ciphertext:r},this.encryptedKey,{iv:n,mode:this.CryptoJS.mode.CBC}).toString(this.CryptoJS.enc.Utf8)).buffer},e.prototype.decryptFileData=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.getKey()];case 1:return t=n.sent(),[2,crypto.subtle.decrypt({name:this.algo,iv:e.metadata},t,e.data)]}}))}))},Object.defineProperty(e.prototype,"identifier",{get:function(){return"ACRH"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"algo",{get:function(){return"AES-CBC"},enumerable:!1,configurable:!0}),e.prototype.getIv=function(){return crypto.getRandomValues(new Uint8Array(e.BLOCK_SIZE))},e.prototype.getKey=function(){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=e.encoder.encode(this.cipherKey),[4,crypto.subtle.digest("SHA-256",t.buffer)];case 1:return n=r.sent(),[2,crypto.subtle.importKey("raw",n,this.algo,!0,["encrypt","decrypt"])]}}))}))},e.prototype.bufferToWordArray=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n[t/4|0]|=e[t]<<24-8*t;return this.CryptoJS.lib.WordArray.create(n,e.length)},e.BLOCK_SIZE=16,e.encoder=new TextEncoder,e.decoder=new TextDecoder,e}();function _(e){var t,n=[];for(t=0;t<e.length;t+=1)n[t/4|0]|=e[t]<<24-8*t;return O.lib.WordArray.create(n,e.length)}var N=function(){function e(e){this.configuration=e,this.iv="0123456789012345",this.allowedKeyEncodings=["hex","utf8","base64","binary"],this.allowedKeyLengths=[128,256],this.allowedModes=["ecb","cbc"],this.defaultOptions={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"}}return e.prototype.HMACSHA256=function(e){return O.HmacSHA256(e,this.configuration.secretKey).toString(O.enc.Base64)},e.prototype.SHA256=function(e){return O.SHA256(e).toString(O.enc.Hex)},e.prototype.encrypt=function(e,t,n){return this.configuration.customEncrypt?this.configuration.customEncrypt(e):this.pnEncrypt(e,t,n)},e.prototype.decrypt=function(e,t,n){return this.configuration.customDecrypt?this.configuration.customDecrypt(e):this.pnDecrypt(e,t,n)},e.prototype.pnEncrypt=function(e,t,n){var r=null!=t?t:this.configuration.cipherKey;if(!r)return e;n=this.parseOptions(n);var i=this.getMode(n),o=this.getPaddedKey(r,n);if(this.configuration.useRandomIVs){var s=this.getRandomIV(),a=O.AES.encrypt(e,o,{iv:s,mode:i}).ciphertext;return s.clone().concat(a.clone()).toString(O.enc.Base64)}var u=this.getIV(n);return O.AES.encrypt(e,o,{iv:u,mode:i}).ciphertext.toString(O.enc.Base64)||e},e.prototype.pnDecrypt=function(e,t,n){var r=null!=t?t:this.configuration.cipherKey;if(!r)return e;n=this.parseOptions(n);var i=this.getMode(n),o=this.getPaddedKey(r,n);if(this.configuration.useRandomIVs){var s=_((c=new Uint8ClampedArray(y(e))).slice(0,16)),a=_(c.slice(16));try{var u=O.AES.decrypt({ciphertext:a},o,{iv:s,mode:i}).toString(O.enc.Utf8);return JSON.parse(u)}catch(e){return null}}else{s=this.getIV(n);try{var c=O.enc.Base64.parse(e);u=O.AES.decrypt({ciphertext:c},o,{iv:s,mode:i}).toString(O.enc.Utf8);return JSON.parse(u)}catch(e){return null}}},e.prototype.parseOptions=function(e){var t,n,r,i;if(!e)return this.defaultOptions;var o={encryptKey:null!==(t=e.encryptKey)&&void 0!==t?t:this.defaultOptions.encryptKey,keyEncoding:null!==(n=e.keyEncoding)&&void 0!==n?n:this.defaultOptions.keyEncoding,keyLength:null!==(r=e.keyLength)&&void 0!==r?r:this.defaultOptions.keyLength,mode:null!==(i=e.mode)&&void 0!==i?i:this.defaultOptions.mode};return-1===this.allowedKeyEncodings.indexOf(o.keyEncoding.toLowerCase())&&(o.keyEncoding=this.defaultOptions.keyEncoding),-1===this.allowedKeyLengths.indexOf(o.keyLength)&&(o.keyLength=this.defaultOptions.keyLength),-1===this.allowedModes.indexOf(o.mode.toLowerCase())&&(o.mode=this.defaultOptions.mode),o},e.prototype.decodeKey=function(e,t){return"base64"===t.keyEncoding?O.enc.Base64.parse(e):"hex"===t.keyEncoding?O.enc.Hex.parse(e):e},e.prototype.getPaddedKey=function(e,t){return e=this.decodeKey(e,t),t.encryptKey?O.enc.Utf8.parse(this.SHA256(e).slice(0,32)):e},e.prototype.getMode=function(e){return"ecb"===e.mode?O.mode.ECB:O.mode.CBC},e.prototype.getIV=function(e){return"cbc"===e.mode?O.enc.Utf8.parse(this.iv):null},e.prototype.getRandomIV=function(){return O.lib.WordArray.random(16)},e}();function M(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}var A=function(){function e(){}return e.prototype.encrypt=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:if(!(t instanceof ArrayBuffer)&&"string"!=typeof t)throw new Error("Cannot encrypt this file. In browsers file encryption supports only string or ArrayBuffer");return[4,this.getKey(e)];case 1:return n=r.sent(),[2,t instanceof ArrayBuffer?this.encryptArrayBuffer(n,t):this.encryptString(n,t)]}}))}))},e.prototype.encryptArrayBuffer=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return n=crypto.getRandomValues(new Uint8Array(16)),r=M,i=[n.buffer],[4,crypto.subtle.encrypt({name:"AES-CBC",iv:n},e,t)];case 1:return[2,r.apply(void 0,i.concat([o.sent()]))]}}))}))},e.prototype.encryptString=function(t,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return r=crypto.getRandomValues(new Uint8Array(16)),i=e.encoder.encode(n).buffer,[4,crypto.subtle.encrypt({name:"AES-CBC",iv:r},t,i)];case 1:return s=o.sent(),a=M(r.buffer,s),[2,e.decoder.decode(a)]}}))}))},e.prototype.encryptFile=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,s,a,u;return o(this,(function(o){switch(o.label){case 0:if(null===(a=t.contentLength)||void 0===a||a)throw new Error("encryption error. empty content");return[4,this.getKey(e)];case 1:return r=o.sent(),[4,t.toArrayBuffer()];case 2:return i=o.sent(),[4,this.encryptArrayBuffer(r,i)];case 3:return s=o.sent(),[2,n.create({name:t.name,mimeType:null!==(u=t.mimeType)&&void 0!==u?u:"application/octet-stream",data:s})]}}))}))},e.prototype.decrypt=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:if(!(t instanceof ArrayBuffer)&&"string"!=typeof t)throw new Error("Cannot decrypt this file. In browsers file decryption supports only string or ArrayBuffer");return[4,this.getKey(e)];case 1:return n=r.sent(),[2,t instanceof ArrayBuffer?this.decryptArrayBuffer(n,t):this.decryptString(n,t)]}}))}))},e.prototype.decryptArrayBuffer=function(t,n){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:if(r=n.slice(0,16),n.slice(e.IV_LENGTH).byteLength<=0)throw new Error("decryption error: empty content");return[4,crypto.subtle.decrypt({name:"AES-CBC",iv:r},t,n.slice(e.IV_LENGTH))];case 1:return[2,i.sent()]}}))}))},e.prototype.decryptString=function(t,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return r=e.encoder.encode(n).buffer,i=r.slice(0,16),s=r.slice(16),[4,crypto.subtle.decrypt({name:"AES-CBC",iv:i},t,s)];case 1:return a=o.sent(),[2,e.decoder.decode(a)]}}))}))},e.prototype.decryptFile=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,s;return o(this,(function(o){switch(o.label){case 0:return[4,this.getKey(e)];case 1:return r=o.sent(),[4,t.toArrayBuffer()];case 2:return i=o.sent(),[4,this.decryptArrayBuffer(r,i)];case 3:return s=o.sent(),[2,n.create({name:t.name,mimeType:t.mimeType,data:s})]}}))}))},e.prototype.getKey=function(t){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return[4,crypto.subtle.digest("SHA-256",e.encoder.encode(t))];case 1:return n=o.sent(),r=Array.from(new Uint8Array(n)).map((function(e){return e.toString(16).padStart(2,"0")})).join(""),i=e.encoder.encode(r.slice(0,32)).buffer,[2,crypto.subtle.importKey("raw",i,"AES-CBC",!0,["encrypt","decrypt"])]}}))}))},e.IV_LENGTH=16,e.encoder=new TextEncoder,e.decoder=new TextDecoder,e}(),R=function(){function e(e){this.config=e,this.cryptor=new N(n({},e)),this.fileCryptor=new A}return e.prototype.encrypt=function(t){var n="string"==typeof t?t:e.decoder.decode(t);return{data:e.encoder.encode(this.cryptor.encrypt(n)),metadata:null}},e.prototype.encryptFile=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){if(!this.config.cipherKey)throw new v("File encryption error: cipher key not set.");return[2,this.fileCryptor.encryptFile(null===(n=this.config)||void 0===n?void 0:n.cipherKey,e,t)]}))}))},e.prototype.decrypt=function(e){var t="string"==typeof e.data?e.data:g(e.data);return this.cryptor.decrypt(t)},e.prototype.decryptFile=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){if(!this.config.cipherKey)throw new v("File encryption error: cipher key not set.");return[2,this.fileCryptor.decryptFile(this.config.cipherKey,e,t)]}))}))},Object.defineProperty(e.prototype,"identifier",{get:function(){return""},enumerable:!1,configurable:!0}),e.encoder=new TextEncoder,e.decoder=new TextDecoder,e}(),j=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),r.legacyCryptoModule=function(e){var t;if(!e.cipherKey)throw new v("Crypto module error: cipher key not set.");return new r({default:new R(n(n({},e),{useRandomIVs:null===(t=e.useRandomIVs)||void 0===t||t})),cryptors:[new C({cipherKey:e.cipherKey})]})},r.aesCbcCryptoModule=function(e){var t;if(!e.cipherKey)throw new v("Crypto module error: cipher key not set.");return new r({default:new C({cipherKey:e.cipherKey}),cryptors:[new R(n(n({},e),{useRandomIVs:null===(t=e.useRandomIVs)||void 0===t||t}))]})},r.withDefaultCryptor=function(e){return new this({default:e})},r.prototype.encrypt=function(e){var t=e instanceof ArrayBuffer&&this.defaultCryptor.identifier===r.LEGACY_IDENTIFIER?this.defaultCryptor.encrypt(r.decoder.decode(e)):this.defaultCryptor.encrypt(e);if(!t.metadata)return t.data;var n=this.getHeaderData(t);return this.concatArrayBuffer(n,t.data)},r.prototype.encryptFile=function(e,t){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){switch(i.label){case 0:return this.defaultCryptor.identifier===I.LEGACY_IDENTIFIER?[2,this.defaultCryptor.encryptFile(e,t)]:[4,this.getFileData(e)];case 1:return n=i.sent(),[4,this.defaultCryptor.encryptFileData(n)];case 2:return r=i.sent(),[2,t.create({name:e.name,mimeType:"application/octet-stream",data:this.concatArrayBuffer(this.getHeaderData(r),r.data)})]}}))}))},r.prototype.decrypt=function(e){var t="string"==typeof e?y(e):e,n=I.tryParse(t),r=this.getCryptor(n),i=n.length>0?t.slice(n.length-n.metadataLength,n.length):null;if(t.slice(n.length).byteLength<=0)throw new Error("Decryption error: empty content");return r.decrypt({data:t.slice(n.length),metadata:i})},r.prototype.decryptFile=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c,p;return o(this,(function(o){switch(o.label){case 0:return[4,e.data.arrayBuffer()];case 1:return n=o.sent(),r=I.tryParse(n),(null==(i=this.getCryptor(r))?void 0:i.identifier)===I.LEGACY_IDENTIFIER?[2,i.decryptFile(e,t)]:[4,this.getFileData(n)];case 2:return s=o.sent(),a=s.slice(r.length-r.metadataLength,r.length),c=(u=t).create,p={name:e.name},[4,this.defaultCryptor.decryptFileData({data:n.slice(r.length),metadata:a})];case 3:return[2,c.apply(u,[(p.data=o.sent(),p)])]}}))}))},r.prototype.getCryptorFromId=function(e){var t=this.getAllCryptors().find((function(t){return e===t.identifier}));if(t)return t;throw Error("Unknown cryptor error")},r.prototype.getCryptor=function(e){if("string"==typeof e){var t=this.getAllCryptors().find((function(t){return t.identifier===e}));if(t)return t;throw new Error("Unknown cryptor error")}if(e instanceof T)return this.getCryptorFromId(e.identifier)},r.prototype.getHeaderData=function(e){if(e.metadata){var t=I.from(this.defaultCryptor.identifier,e.metadata),n=new Uint8Array(t.length),r=0;return n.set(t.data,r),r+=t.length-e.metadata.byteLength,n.set(new Uint8Array(e.metadata),r),n.buffer}},r.prototype.concatArrayBuffer=function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer},r.prototype.getFileData=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(e instanceof ArrayBuffer)return[2,e];if(e instanceof d)return[2,e.toArrayBuffer()];throw new Error("Cannot decrypt/encrypt file. In browsers file encrypt/decrypt supported for string, ArrayBuffer or Blob")}))}))},r.LEGACY_IDENTIFIER="",r}(f),I=function(){function e(){}return e.from=function(t,n){if(t!==e.LEGACY_IDENTIFIER)return new T(t,n.byteLength)},e.tryParse=function(t){var n,r,i=new Uint8Array(t);if(i.byteLength>=4&&(n=i.slice(0,4),this.decoder.decode(n)!==e.SENTINEL))return j.LEGACY_IDENTIFIER;if(!(i.byteLength>=5))throw new Error("Decryption error: invalid header version");if(i[4]>e.MAX_VERSION)throw new Error("Decryption error: Unknown cryptor error");var o=5+e.IDENTIFIER_LENGTH;if(!(i.byteLength>=o))throw new Error("Decryption error: invalid crypto identifier");r=i.slice(5,o);var s=null;if(!(i.byteLength>=o+1))throw new Error("Decryption error: invalid metadata length");return s=i[o],o+=1,255===s&&i.byteLength>=o+2&&(s=new Uint16Array(i.slice(o,o+2)).reduce((function(e,t){return(e<<8)+t}),0)),new T(this.decoder.decode(r),s)},e.SENTINEL="PNED",e.LEGACY_IDENTIFIER="",e.IDENTIFIER_LENGTH=4,e.VERSION=1,e.MAX_VERSION=1,e.decoder=new TextDecoder,e}(),T=function(){function e(e,t){this._identifier=e,this._metadataLength=t}return Object.defineProperty(e.prototype,"identifier",{get:function(){return this._identifier},set:function(e){this._identifier=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadataLength",{get:function(){return this._metadataLength},set:function(e){this._metadataLength=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return I.VERSION},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return I.SENTINEL.length+1+I.IDENTIFIER_LENGTH+(this.metadataLength<255?1:3)+this.metadataLength},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){var e=0,t=new Uint8Array(this.length),n=new TextEncoder;t.set(n.encode(I.SENTINEL)),t[e+=I.SENTINEL.length]=this.version,e++,this.identifier&&t.set(n.encode(this.identifier),e);var r=this.metadataLength;return e+=I.IDENTIFIER_LENGTH,r<255?t[e]=r:t.set([255,r>>8,255&r],e),t},enumerable:!1,configurable:!0}),e.IDENTIFIER_LENGTH=4,e.SENTINEL="PNED",e}();function U(e){var t=function(e){return e&&"object"==typeof e&&e.constructor===Object};if(!t(e))return e;var n={};return Object.keys(e).forEach((function(r){var i=function(e){return"string"==typeof e||e instanceof String}(r),o=r,s=e[r];Array.isArray(r)||i&&r.indexOf(",")>=0?o=(i?r.split(","):r).reduce((function(e,t){return e+=String.fromCharCode(t)}),""):(function(e){return"number"==typeof e&&isFinite(e)}(r)||i&&!isNaN(r))&&(o=String.fromCharCode(i?parseInt(r,10):10));n[o]=t(s)?U(s):s})),n}var F={exports:{}};
/*! lil-uuid - v0.1 - MIT License - https://github.com/lil-js/uuid */!function(e,t){!function(e){var t="0.1.0",n={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function r(){var e,t,n="";for(e=0;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(n+="-"),n+=(12===e?4:16===e?3&t|8:t).toString(16);return n}function i(e,t){var r=n[t||"all"];return r&&r.test(e)||!1}r.isUUID=i,r.VERSION=t,e.uuid=r,e.isUUID=i}(t),null!==e&&(e.exports=t.uuid)}(F,F.exports);var D,x=p(F.exports),K=function(){return x.uuid?x.uuid():x()},G=function(e,t){var n=e?"https://":"http://";return"string"==typeof t?"".concat(n).concat(t):"".concat(n).concat(t[Math.floor(Math.random()*t.length)])},q=function(e){var t,r;return n(n({},function(e){var t,r,i,o,s,a,u,c,p,l,h,f,d=n({},e);null!==(t=d.logVerbosity)&&void 0!==t||(d.logVerbosity=!1),null!==(r=d.ssl)&&void 0!==r||(d.ssl=!0),null!==(i=d.transactionalRequestTimeout)&&void 0!==i||(d.transactionalRequestTimeout=15),null!==(o=d.subscribeRequestTimeout)&&void 0!==o||(d.subscribeRequestTimeout=310),null!==(s=d.restore)&&void 0!==s||(d.restore=!1),null!==(a=d.useInstanceId)&&void 0!==a||(d.useInstanceId=!1),null!==(u=d.suppressLeaveEvents)&&void 0!==u||(d.suppressLeaveEvents=!1),null!==(c=d.requestMessageCountThreshold)&&void 0!==c||(d.requestMessageCountThreshold=100),null!==(p=d.autoNetworkDetection)&&void 0!==p||(d.autoNetworkDetection=!1),null!==(l=d.enableEventEngine)&&void 0!==l||(d.enableEventEngine=!1),null!==(h=d.maintainPresenceState)&&void 0!==h||(d.maintainPresenceState=!0),null!==(f=d.keepAlive)&&void 0!==f||(d.keepAlive=!1),d.origin||(d.origin=Array.from({length:20},(function(e,t){return"ps".concat(t+1,".pndsn.com")})));var y={subscribeKey:d.subscribeKey,publishKey:d.publishKey,secretKey:d.secretKey};d.presenceTimeout&&d.presenceTimeout<20&&(d.presenceTimeout=20,console.log("WARNING: Presence timeout is less than the minimum. Using minimum value: ",20)),d.presenceTimeout?d.heartbeatInterval=d.presenceTimeout/2-1:d.presenceTimeout=300;var g=!1,v=!0,b=5,m=!1,w=!1;return d.dedupeOnSubscribe&&"boolean"==typeof d.dedupeOnSubscribe&&(m=d.dedupeOnSubscribe),d.useRequestId&&"boolean"==typeof d.useRequestId&&(w=d.useRequestId),d.announceSuccessfulHeartbeats&&"boolean"==typeof d.announceSuccessfulHeartbeats&&(g=d.announceSuccessfulHeartbeats),d.announceFailedHeartbeats&&"boolean"==typeof d.announceFailedHeartbeats&&(v=d.announceFailedHeartbeats),d.fileUploadPublishRetryLimit&&"number"==typeof d.fileUploadPublishRetryLimit&&(b=d.fileUploadPublishRetryLimit),n(n({},d),{keySet:y,dedupeOnSubscribe:m,maximumCacheSize:100,useRequestId:w,announceSuccessfulHeartbeats:g,announceFailedHeartbeats:v,fileUploadPublishRetryLimit:b})}(e)),{listenToBrowserNetworkEvents:null===(t=e.listenToBrowserNetworkEvents)||void 0===t||t,keepAlive:null===(r=e.keepAlive)||void 0===r||r})},L=function(){function e(e){this._cbor=e}return e.prototype.setToken=function(e){e&&e.length>0?this._token=e:this._token=void 0},e.prototype.getToken=function(){return this._token},e.prototype.extractPermissions=function(e){var t={read:!1,write:!1,manage:!1,delete:!1,get:!1,update:!1,join:!1};return 128&~e||(t.join=!0),64&~e||(t.update=!0),32&~e||(t.get=!0),8&~e||(t.delete=!0),4&~e||(t.manage=!0),2&~e||(t.write=!0),1&~e||(t.read=!0),t},e.prototype.parseToken=function(e){var t=this,n=this._cbor.decodeToken(e);if(void 0!==n){var r=n.res.uuid?Object.keys(n.res.uuid):[],i=Object.keys(n.res.chan),o=Object.keys(n.res.grp),s=n.pat.uuid?Object.keys(n.pat.uuid):[],a=Object.keys(n.pat.chan),u=Object.keys(n.pat.grp),c={version:n.v,timestamp:n.t,ttl:n.ttl,authorized_uuid:n.uuid},p=r.length>0,l=i.length>0,h=o.length>0;(p||l||h)&&(c.resources={},p&&(c.resources.uuids={},r.forEach((function(e){c.resources.uuids[e]=t.extractPermissions(n.res.uuid[e])}))),l&&(c.resources.channels={},i.forEach((function(e){c.resources.channels[e]=t.extractPermissions(n.res.chan[e])}))),h&&(c.resources.groups={},o.forEach((function(e){c.resources.groups[e]=t.extractPermissions(n.res.grp[e])}))));var f=s.length>0,d=a.length>0,y=u.length>0;return(f||d||y)&&(c.patterns={},f&&(c.patterns.uuids={},s.forEach((function(e){c.patterns.uuids[e]=t.extractPermissions(n.pat.uuid[e])}))),d&&(c.patterns.channels={},a.forEach((function(e){c.patterns.channels[e]=t.extractPermissions(n.pat.chan[e])}))),y&&(c.patterns.groups={},u.forEach((function(e){c.patterns.groups[e]=t.extractPermissions(n.pat.grp[e])})))),Object.keys(n.meta).length>0&&(c.meta=n.meta),c.signature=n.sig,c}},e}();!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.DELETE="DELETE",e.LOCAL="LOCAL"}(D||(D={}));var B,H=function(e){return encodeURIComponent(e).replace(/[!~*'()]/g,(function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())}))},z=function(e,t){var n=Object.fromEntries(t.map((function(e){return[e,!1]})));return e.filter((function(e){return!(t.includes(e)&&!n[e])||(n[e]=!0,!1)}))},V=function(e,t){return u([],a(e),!1).filter((function(n){return t.includes(n)&&e.indexOf(n)===e.lastIndexOf(n)&&t.indexOf(n)===t.lastIndexOf(n)}))},W=function(){function e(e,t,n){this.publishKey=e,this.secretKey=t,this.hasher=n}return e.prototype.signature=function(t){var n=t.path.startsWith("/publish")?D.GET:t.method,r="".concat(n,"\n").concat(this.publishKey,"\n").concat(t.path,"\n").concat(this.queryParameters(t.queryParameters),"\n");if(n===D.POST||n===D.PATCH){var i=t.body,o=void 0;i&&i instanceof ArrayBuffer?o=e.textDecoder.decode(i):i&&"object"!=typeof i&&(o=i),o&&(r+=o)}return"v2.".concat(this.hasher(r,this.secretKey)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},e.prototype.queryParameters=function(e){return Object.keys(e).sort().map((function(t){var n=e[t];return Array.isArray(n)?n.sort().map((function(e){return"".concat(t,"=").concat(H(e))})).join("&"):"".concat(t,"=").concat(H(n))})).join("&")},e.textDecoder=new TextDecoder("utf-8"),e}(),J=function(){function e(e){this.configuration=e;var t=e.clientConfiguration.keySet,n=e.shaHMAC;t.secretKey&&n&&(this.signatureGenerator=new W(t.publishKey,t.secretKey,n))}return e.prototype.makeSendable=function(e){return this.configuration.transport.makeSendable(this.request(e))},e.prototype.request=function(e){var t,n=this.configuration.clientConfiguration;return e.queryParameters||(e.queryParameters={}),n.useInstanceId&&(e.queryParameters.instanceid=n.instanceId),e.queryParameters.uuid||(e.queryParameters.uuid=n.userId),e.queryParameters.requestid=e.identifier,e.queryParameters.pnsdk=this.generatePNSDK(),null!==(t=e.origin)&&void 0!==t||(e.origin=n.origin),this.authenticateRequest(e),this.signRequest(e),e},e.prototype.authenticateRequest=function(e){var t;if(!(e.path.startsWith("/v2/auth/")||e.path.startsWith("/v3/pam/")||e.path.startsWith("/time"))){var n=this.configuration,r=n.clientConfiguration,i=null!==(t=n.tokenManager.getToken())&&void 0!==t?t:r.authKey;i&&(e.queryParameters.auth=i)}},e.prototype.signRequest=function(e){this.signatureGenerator&&!e.path.startsWith("/time")&&(e.queryParameters.timestamp=String(Math.floor((new Date).getTime()/1e3)),e.queryParameters.signature=this.signatureGenerator.signature(e))},e.prototype.generatePNSDK=function(){var e=this.configuration.clientConfiguration;if(e.sdkName)return e.sdkName;var t="PubNub-JS-".concat(e.sdkFamily);e.partnerId&&(t+="-".concat(e.partnerId)),t+="/".concat(e.version);var n=e._getPnsdkSuffix(" ");return n.length>0&&(t+=n),t},e}();!function(e){e.PNNetworkIssuesCategory="PNNetworkIssuesCategory",e.PNTimeoutCategory="PNTimeoutCategory",e.PNCancelledCategory="PNCancelledCategory",e.PNBadRequestCategory="PNBadRequestCategory",e.PNAccessDeniedCategory="PNAccessDeniedCategory",e.PNUnknownCategory="PNUnknownCategory",e.PNNetworkUpCategory="PNNetworkUpCategory",e.PNNetworkDownCategory="PNNetworkDownCategory",e.PNReconnectedCategory="PNReconnectedCategory",e.PNConnectedCategory="PNConnectedCategory",e.PNRequestMessageCountExceededCategory="PNRequestMessageCountExceededCategory",e.PNDisconnectedCategory="PNDisconnectedCategory",e.PNConnectionErrorCategory="PNConnectionErrorCategory",e.PNDisconnectedUnexpectedlyCategory="PNDisconnectedUnexpectedlyCategory"}(B||(B={}));var Y,X=B,$=function(e){function n(t,n,r,i){var o=e.call(this,t)||this;return o.category=n,o.statusCode=r,o.errorData=i,o.name=o.constructor.name,o}return t(n,e),n.create=function(e,t){return e instanceof Error?n.createFromError(e):n.createFromServiceResponse(e,t)},n.createFromError=function(e){var t=X.PNUnknownCategory,r="Unknown error",i="Error";if(!e)return new n(r,t,0);if(e instanceof Error&&(r=e.message,i=e.name),"AbortError"===i)t=X.PNCancelledCategory,r="Request cancelled";else if("FetchError"===i){var o=e.code;o in["ECONNREFUSED","ENOTFOUND","ECONNRESET","EAI_AGAIN"]&&(t=X.PNNetworkIssuesCategory),"ECONNREFUSED"===o?r="Connection refused":"ENOTFOUND"===o?r="Server not found":"ECONNRESET"===o?r="Connection reset by peer":"EAI_AGAIN"===o?r="Name resolution error":"ETIMEDOUT"===o?(t=X.PNTimeoutCategory,r="Request timeout"):r="Unknown system error: ".concat(e)}else"Request timeout"===r&&(t=X.PNTimeoutCategory);return new n(r,t,0,e)},n.createFromServiceResponse=function(e,t){var r,i=X.PNUnknownCategory,o="Unknown error",s=e.status;if(402===s?o="Not available for used key set. Contact support@pubnub.com":400===s?(i=X.PNBadRequestCategory,o="Bad request"):403===s&&(i=X.PNAccessDeniedCategory,o="Access denied"),t&&t.byteLength>0){var a=(new TextDecoder).decode(t);if(e.headers["content-type"].includes("application/json"))try{var u=JSON.parse(a);"object"!=typeof u||Array.isArray(u)||("error"in u&&1===u.error&&"status"in u&&"number"==typeof u.status&&"message"in u&&"service"in u&&(r=u,s=u.status),"error"in u&&"object"==typeof u.error&&!Array.isArray(u.error)&&"message"in u.error&&(r=u.error))}catch(e){r=a}else r=a}return new n(o,i,s,r)},n.prototype.toStatus=function(e){return{error:!0,category:this.category,operation:e,statusCode:this.statusCode,errorData:this.errorData}},n}(Error),Z=function(){function e(e,t){void 0===e&&(e=!1),this.keepAlive=e,this.logVerbosity=t,this.setupWorker()}return e.prototype.makeSendable=function(e){var t,n=this,r={type:"send-request",request:e};return e.cancellable&&(t={abort:function(){var t={type:"cancel-request",identifier:e.identifier};n.worker.postMessage(t)}}),[new Promise((function(t,i){n.callbacks.set(e.identifier,{resolve:t,reject:i}),n.worker.postMessage(r)})),t]},e.prototype.request=function(e){return e},e.prototype.setupWorker=function(){var e=this;this.worker=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})),{name:"/pubnub",type:"module"}),this.callbacks=new Map;var t={type:"setup",logVerbosity:this.logVerbosity,keepAlive:this.keepAlive};this.worker.postMessage(t),this.worker.onmessage=function(t){var n=t.data;if("request-progress-start"===n.type||"request-progress-end"===n.type)e.logRequestProgress(n);else if("request-process-success"===n.type||"request-process-error"===n.type){var r=e.callbacks.get(n.identifier),i=r.resolve,o=r.reject;if("request-process-success"===n.type)i({status:n.response.status,url:n.url,headers:n.response.headers,body:n.response.body});else{var s=X.PNUnknownCategory,a="Unknown error";if(n.error)"NETWORK_ISSUE"===n.error.type?s=X.PNNetworkIssuesCategory:"TIMEOUT"===n.error.type&&(s=X.PNTimeoutCategory),a=n.error.message;else if(n.response)return o($.create({url:n.url,headers:n.response.headers,body:n.response.body,status:n.response.status}));o(new $(a,s,0))}}}},e.prototype.logRequestProgress=function(e){var t,n;"request-progress-start"===e.type?(console.log("<<<<<"),console.log("[".concat(e.timestamp,"]"),"\n",e.url,"\n",JSON.stringify(null!==(t=e.query)&&void 0!==t?t:{})),console.log("-----")):(console.log(">>>>>>"),console.log("[".concat(e.timestamp," / ").concat(e.duration,"]"),"\n",e.url,"\n",JSON.stringify(null!==(n=e.query)&&void 0!==n?n:{}),"\n",e.response),console.log("-----"))},e}(),Q=function(){function e(){this.listeners=[]}return e.prototype.addListener=function(e){this.listeners.includes(e)||this.listeners.push(e)},e.prototype.removeListener=function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))},e.prototype.removeAllListeners=function(){this.listeners=[]},e.prototype.announceStatus=function(e){this.listeners.forEach((function(t){t.status&&t.status(e)}))},e.prototype.announcePresence=function(e){this.listeners.forEach((function(t){t.presence&&t.presence(e)}))},e.prototype.announceMessage=function(e){this.listeners.forEach((function(t){t.message&&t.message(e)}))},e.prototype.announceSignal=function(e){this.listeners.forEach((function(t){t.signal&&t.signal(e)}))},e.prototype.announceMessageAction=function(e){this.listeners.forEach((function(t){t.messageAction&&t.messageAction(e)}))},e.prototype.announceFile=function(e){this.listeners.forEach((function(t){t.file&&t.file(e)}))},e.prototype.announceObjects=function(e){this.listeners.forEach((function(t){t.objects&&t.objects(e)}))},e.prototype.announceNetworkUp=function(){this.listeners.forEach((function(e){e.status&&e.status({category:X.PNNetworkUpCategory})}))},e.prototype.announceNetworkDown=function(){this.listeners.forEach((function(e){e.status&&e.status({category:X.PNNetworkDownCategory})}))},e.prototype.announceUser=function(e){this.listeners.forEach((function(t){t.user&&t.user(e)}))},e.prototype.announceSpace=function(e){this.listeners.forEach((function(t){t.space&&t.space(e)}))},e.prototype.announceMembership=function(e){this.listeners.forEach((function(t){t.membership&&t.membership(e)}))},e}(),ee=function(){function e(e){this.time=e}return e.prototype.onReconnect=function(e){this.callback=e},e.prototype.startPolling=function(){var e=this;this.timeTimer=setInterval((function(){return e.callTime()}),3e3)},e.prototype.stopPolling=function(){this.timeTimer&&clearInterval(this.timeTimer),this.timeTimer=null},e.prototype.callTime=function(){var e=this;this.time((function(t){t.error||(e.stopPolling(),e.callback&&e.callback())}))},e}(),te=function(){function e(e){var t=e.config;this.hashHistory=[],this._config=t}return e.prototype.getKey=function(e){var t=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n+=1)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}(JSON.stringify(e.payload)).toString(),n=e.publishMetaData.publishTimetoken;return"".concat(n,"-").concat(t)},e.prototype.isDuplicate=function(e){return this.hashHistory.includes(this.getKey(e))},e.prototype.addEntry=function(e){this.hashHistory.length>=this._config.maximumCacheSize&&this.hashHistory.shift(),this.hashHistory.push(this.getKey(e))},e.prototype.clearHistory=function(){this.hashHistory=[]},e}(),ne=function(){function e(e,t,n,r,i,o,s){this.configuration=e,this.listenerManager=t,this.eventEmitter=n,this.subscribeCall=r,this.heartbeatCall=i,this.leaveCall=o,this.reconnectionManager=new ee(s),this.dedupingManager=new te({config:this.configuration}),this.heartbeatChannelGroups={},this.heartbeatChannels={},this.presenceChannelGroups={},this.presenceChannels={},this.heartbeatTimer=null,this.presenceState={},this.pendingChannelGroupSubscriptions=[],this.pendingChannelSubscriptions=[],this.channelGroups={},this.channels={},this.currentTimetoken="0",this.lastTimetoken="0",this.storedTimetoken=null,this.subscriptionStatusAnnounced=!1,this.isOnline=!0}return Object.defineProperty(e.prototype,"subscribedChannels",{get:function(){return Object.keys(this.channels)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscribedChannelGroups",{get:function(){return Object.keys(this.channelGroups)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"abort",{set:function(e){this._subscribeAbort=e},enumerable:!1,configurable:!0}),e.prototype.disconnect=function(){this.stopSubscribeLoop(),this.stopHeartbeatTimer(),this.reconnectionManager.stopPolling()},e.prototype.reconnect=function(){this.startSubscribeLoop(),this.startHeartbeatTimer()},e.prototype.subscribe=function(e){var t=this,n=e.channels,r=e.channelGroups,i=e.timetoken,o=e.withPresence,s=void 0!==o&&o,a=e.withHeartbeats,u=void 0!==a&&a;i&&(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=i),"0"!==this.currentTimetoken&&0!==this.currentTimetoken&&(this.storedTimetoken=this.currentTimetoken,this.currentTimetoken=0),null==n||n.forEach((function(e){t.pendingChannelSubscriptions.push(e),t.channels[e]={},s&&(t.presenceChannels[e]={}),(u||t.configuration.getHeartbeatInterval())&&(t.heartbeatChannels[e]={})})),null==r||r.forEach((function(e){t.pendingChannelGroupSubscriptions.push(e),t.channelGroups[e]={},s&&(t.presenceChannelGroups[e]={}),(u||t.configuration.getHeartbeatInterval())&&(t.heartbeatChannelGroups[e]={})})),this.subscriptionStatusAnnounced=!1,this.reconnect()},e.prototype.unsubscribe=function(e,t){var r=this,i=e.channels,o=e.channelGroups,s=[],a=[];null==i||i.forEach((function(e){e in r.channels&&(delete r.channels[e],a.push(e),e in r.heartbeatChannels&&delete r.heartbeatChannels[e]),e in r.presenceState&&delete r.presenceState[e],e in r.presenceChannels&&(delete r.presenceChannels[e],a.push(e))})),null==o||o.forEach((function(e){e in r.channelGroups&&(delete r.channelGroups[e],s.push(e),e in r.heartbeatChannelGroups&&delete r.heartbeatChannelGroups[e]),e in r.presenceState&&delete r.presenceState[e],e in r.presenceChannelGroups&&(delete r.presenceChannelGroups[e],s.push(e))})),0===a.length&&0===s.length||(!1!==this.configuration.suppressLeaveEvents||t||this.leaveCall({channels:a,channelGroups:s},(function(e){r.listenerManager.announceStatus(n(n({},e),{affectedChannels:a,affectedChannelGroups:s,currentTimetoken:r.currentTimetoken,lastTimetoken:r.lastTimetoken}))})),0===Object.keys(this.channels).length&&0===Object.keys(this.presenceChannels).length&&0===Object.keys(this.channelGroups).length&&0===Object.keys(this.presenceChannelGroups).length&&(this.lastTimetoken=0,this.currentTimetoken=0,this.storedTimetoken=null,this.region=null,this.reconnectionManager.stopPolling()),this.reconnect())},e.prototype.unsubscribeAll=function(e){this.unsubscribe({channels:this.subscribedChannels,channelGroups:this.subscribedChannelGroups},e)},e.prototype.startSubscribeLoop=function(){var e=this;this.stopSubscribeLoop();var t=u([],a(Object.keys(this.channelGroups)),!1),n=u([],a(Object.keys(this.channels)),!1);Object.keys(this.presenceChannelGroups).forEach((function(e){return t.push("".concat(e,"-pnpres"))})),Object.keys(this.presenceChannels).forEach((function(e){return n.push("".concat(e,"-pnpres"))})),0===n.length&&0===t.length||this.subscribeCall({channels:n,channelGroups:t,state:this.presenceState,timetoken:this.currentTimetoken,region:null!==this.region?this.region:void 0,filterExpression:this.configuration.filterExpression},(function(t,n){e.processSubscribeResponse(t,n)}))},e.prototype.stopSubscribeLoop=function(){this._subscribeAbort&&(this._subscribeAbort(),this._subscribeAbort=null)},e.prototype.processSubscribeResponse=function(e,t){var n=this;if(e.error){if("object"==typeof e.errorData&&"name"in e.errorData&&"AbortError"===e.errorData.name)return;e.category===X.PNTimeoutCategory?this.startSubscribeLoop():e.category===X.PNNetworkIssuesCategory?(this.disconnect(),e.error&&this.configuration.autoNetworkDetection&&this.isOnline&&(this.isOnline=!1,this.listenerManager.announceNetworkDown()),this.reconnectionManager.onReconnect((function(){n.configuration.autoNetworkDetection&&!n.isOnline&&(n.isOnline=!0,n.listenerManager.announceNetworkUp()),n.reconnect(),n.subscriptionStatusAnnounced=!0;var t={category:X.PNReconnectedCategory,operation:e.operation,lastTimetoken:n.lastTimetoken,currentTimetoken:n.currentTimetoken};n.listenerManager.announceStatus(t)})),this.reconnectionManager.startPolling(),this.listenerManager.announceStatus(e)):e.category===X.PNBadRequestCategory?(this.stopHeartbeatTimer(),this.listenerManager.announceStatus(e)):this.listenerManager.announceStatus(e)}else{if(this.storedTimetoken?(this.currentTimetoken=this.storedTimetoken,this.storedTimetoken=null):(this.lastTimetoken=this.currentTimetoken,this.currentTimetoken=t.cursor.timetoken),!this.subscriptionStatusAnnounced){var r={category:X.PNConnectedCategory,operation:e.operation,affectedChannels:this.pendingChannelSubscriptions,subscribedChannels:this.subscribedChannels,affectedChannelGroups:this.pendingChannelGroupSubscriptions,lastTimetoken:this.lastTimetoken,currentTimetoken:this.currentTimetoken};this.subscriptionStatusAnnounced=!0,this.listenerManager.announceStatus(r),this.pendingChannelGroupSubscriptions=[],this.pendingChannelSubscriptions=[]}var i=t.messages,o=this.configuration,s=o.requestMessageCountThreshold,a=o.dedupeOnSubscribe;s&&i.length>=s&&this.listenerManager.announceStatus({category:X.PNRequestMessageCountExceededCategory,operation:e.operation}),i.forEach((function(e){if(a){if(n.dedupingManager.isDuplicate(e))return;n.dedupingManager.addEntry(e)}n.eventEmitter.emitEvent(e)})),this.region=t.cursor.region,this.startSubscribeLoop()}},e.prototype.setState=function(e){var t=this,n=e.state,r=e.channels,i=e.channelGroups;null==r||r.forEach((function(e){return e in t.channels&&(t.presenceState[e]=n)})),null==i||i.forEach((function(e){return e in t.channelGroups&&(t.presenceState[e]=n)}))},e.prototype.changePresence=function(e){var t=this,n=e.connected,r=e.channels,i=e.channelGroups;n?(null==r||r.forEach((function(e){return t.heartbeatChannels[e]={}})),null==i||i.forEach((function(e){return t.heartbeatChannelGroups[e]={}}))):(null==r||r.forEach((function(e){e in t.heartbeatChannels&&delete t.heartbeatChannels[e]})),null==i||i.forEach((function(e){e in t.heartbeatChannelGroups&&delete t.heartbeatChannelGroups[e]})),!1===this.configuration.suppressLeaveEvents&&this.leaveCall({channels:r,channelGroups:i},(function(e){return t.listenerManager.announceStatus(e)}))),this.reconnect()},e.prototype.startHeartbeatTimer=function(){var e=this;this.stopHeartbeatTimer();var t=this.configuration.getHeartbeatInterval();t&&0!==t&&(this.sendHeartbeat(),this.heartbeatTimer=setInterval((function(){return e.sendHeartbeat()}),1e3*t))},e.prototype.stopHeartbeatTimer=function(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)},e.prototype.sendHeartbeat=function(){var e=this,t=Object.keys(this.heartbeatChannelGroups),n=Object.keys(this.heartbeatChannels);0===n.length&&0===t.length||this.heartbeatCall({channels:n,channelGroups:t,heartbeat:this.configuration.getPresenceTimeout(),state:this.presenceState},(function(t){t.error&&e.configuration.announceFailedHeartbeats&&e.listenerManager.announceStatus(t),t.error&&e.configuration.autoNetworkDetection&&e.isOnline&&(e.isOnline=!1,e.disconnect(),e.listenerManager.announceNetworkDown(),e.reconnect()),!t.error&&e.configuration.announceSuccessfulHeartbeats&&e.listenerManager.announceNetworkUp()}))},e}(),re=function(){function e(e,t,n){this._payload=e,this._setDefaultPayloadStructure(),this.title=t,this.body=n}return Object.defineProperty(e.prototype,"payload",{get:function(){return this._payload},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"title",{set:function(e){this._title=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subtitle",{set:function(e){this._subtitle=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"body",{set:function(e){this._body=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"badge",{set:function(e){this._badge=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sound",{set:function(e){this._sound=e},enumerable:!1,configurable:!0}),e.prototype._setDefaultPayloadStructure=function(){},e.prototype.toObject=function(){return{}},e}(),ie=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),Object.defineProperty(r.prototype,"configurations",{set:function(e){e&&e.length&&(this._configurations=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"notification",{get:function(){return this._payload.aps},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"title",{get:function(){return this._title},set:function(e){e&&e.length&&(this._payload.aps.alert.title=e,this._title=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"subtitle",{get:function(){return this._subtitle},set:function(e){e&&e.length&&(this._payload.aps.alert.subtitle=e,this._subtitle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){return this._body},set:function(e){e&&e.length&&(this._payload.aps.alert.body=e,this._body=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"badge",{get:function(){return this._badge},set:function(e){null!=e&&(this._payload.aps.badge=e,this._badge=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"sound",{get:function(){return this._sound},set:function(e){e&&e.length&&(this._payload.aps.sound=e,this._sound=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"silent",{set:function(e){this._isSilent=e},enumerable:!1,configurable:!0}),r.prototype._setDefaultPayloadStructure=function(){this._payload.aps={alert:{}}},r.prototype.toObject=function(){var e=this,t=n({},this._payload),r=t.aps,i=r.alert;if(this._isSilent&&(r["content-available"]=1),"apns2"===this._apnsPushType){if(!this._configurations||!this._configurations.length)throw new ReferenceError("APNS2 configuration is missing");var o=[];this._configurations.forEach((function(t){o.push(e._objectFromAPNS2Configuration(t))})),o.length&&(t.pn_push=o)}return i&&Object.keys(i).length||delete r.alert,this._isSilent&&(delete r.alert,delete r.badge,delete r.sound,i={}),this._isSilent||Object.keys(i).length?t:null},r.prototype._objectFromAPNS2Configuration=function(e){var t=this;if(!e.targets||!e.targets.length)throw new ReferenceError("At least one APNS2 target should be provided");var n=[];e.targets.forEach((function(e){n.push(t._objectFromAPNSTarget(e))}));var r=e.collapseId,i=e.expirationDate,o={auth_method:"token",targets:n,version:"v2"};return r&&r.length&&(o.collapse_id=r),i&&(o.expiration=i.toISOString()),o},r.prototype._objectFromAPNSTarget=function(e){if(!e.topic||!e.topic.length)throw new TypeError("Target 'topic' undefined.");var t=e.topic,n=e.environment,r=void 0===n?"development":n,i=e.excludedDevices,o=void 0===i?[]:i,s={topic:t,environment:r};return o.length&&(s.excluded_devices=o),s},r}(re),oe=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),Object.defineProperty(r.prototype,"backContent",{get:function(){return this._backContent},set:function(e){e&&e.length&&(this._payload.back_content=e,this._backContent=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"backTitle",{get:function(){return this._backTitle},set:function(e){e&&e.length&&(this._payload.back_title=e,this._backTitle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"count",{get:function(){return this._count},set:function(e){null!=e&&(this._payload.count=e,this._count=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"title",{get:function(){return this._title},set:function(e){e&&e.length&&(this._payload.title=e,this._title=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"type",{get:function(){return this._type},set:function(e){e&&e.length&&(this._payload.type=e,this._type=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"subtitle",{get:function(){return this.backTitle},set:function(e){this.backTitle=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){return this.backContent},set:function(e){this.backContent=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"badge",{get:function(){return this.count},set:function(e){this.count=e},enumerable:!1,configurable:!0}),r.prototype.toObject=function(){return Object.keys(this._payload).length?n({},this._payload):null},r}(re),se=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return t(i,e),Object.defineProperty(i.prototype,"notification",{get:function(){return this._payload.notification},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"data",{get:function(){return this._payload.data},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"title",{get:function(){return this._title},set:function(e){e&&e.length&&(this._payload.notification.title=e,this._title=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"body",{get:function(){return this._body},set:function(e){e&&e.length&&(this._payload.notification.body=e,this._body=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sound",{get:function(){return this._sound},set:function(e){e&&e.length&&(this._payload.notification.sound=e,this._sound=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"icon",{get:function(){return this._icon},set:function(e){e&&e.length&&(this._payload.notification.icon=e,this._icon=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tag",{get:function(){return this._tag},set:function(e){e&&e.length&&(this._payload.notification.tag=e,this._tag=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"silent",{set:function(e){this._isSilent=e},enumerable:!1,configurable:!0}),i.prototype._setDefaultPayloadStructure=function(){this._payload.notification={},this._payload.data={}},i.prototype.toObject=function(){var e=n({},this._payload.data),t=null,i={};if(Object.keys(this._payload).length>2){var o=this._payload;o.notification,o.data;var s=r(o,["notification","data"]);e=n(n({},e),s)}return this._isSilent?e.notification=this._payload.notification:t=this._payload.notification,Object.keys(e).length&&(i.data=e),t&&Object.keys(t).length&&(i.notification=t),Object.keys(i).length?i:null},i}(re),ae=function(){function e(e,t){this._payload={apns:{},mpns:{},fcm:{}},this._title=e,this._body=t,this.apns=new ie(this._payload.apns,e,t),this.mpns=new oe(this._payload.mpns,e,t),this.fcm=new se(this._payload.fcm,e,t)}return Object.defineProperty(e.prototype,"debugging",{set:function(e){this._debugging=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return this._body},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subtitle",{get:function(){return this._subtitle},set:function(e){this._subtitle=e,this.apns.subtitle=e,this.mpns.subtitle=e,this.fcm.subtitle=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"badge",{get:function(){return this._badge},set:function(e){this._badge=e,this.apns.badge=e,this.mpns.badge=e,this.fcm.badge=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._sound},set:function(e){this._sound=e,this.apns.sound=e,this.mpns.sound=e,this.fcm.sound=e},enumerable:!1,configurable:!0}),e.prototype.buildPayload=function(e){var t={};if(e.includes("apns")||e.includes("apns2")){this.apns._apnsPushType=e.includes("apns")?"apns":"apns2";var n=this.apns.toObject();n&&Object.keys(n).length&&(t.pn_apns=n)}if(e.includes("mpns")){var r=this.mpns.toObject();r&&Object.keys(r).length&&(t.pn_mpns=r)}if(e.includes("fcm")){var i=this.fcm.toObject();i&&Object.keys(i).length&&(t.pn_gcm=i)}return Object.keys(t).length&&this._debugging&&(t.pn_debug=!0),t},e}(),ue=function(){function e(e){this.params=e,this._cancellationController=null}return Object.defineProperty(e.prototype,"cancellationController",{get:function(){return this._cancellationController},set:function(e){this._cancellationController=e},enumerable:!1,configurable:!0}),e.prototype.abort=function(){this.cancellationController&&this.cancellationController.abort()},e.prototype.operation=function(){throw Error("Should be implemented by subclass.")},e.prototype.validate=function(){},e.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(e){throw Error("Should be implemented by subclass.")}))}))},e.prototype.request=function(){var e,t,n,r,i={method:null!==(t=null===(e=this.params)||void 0===e?void 0:e.method)&&void 0!==t?t:D.GET,path:this.path,queryParameters:this.queryParameters,cancellable:null!==(r=null===(n=this.params)||void 0===n?void 0:n.cancellable)&&void 0!==r&&r,timeout:1e4,identifier:K()},o=this.headers;if(o&&(i.headers=o),i.method===D.POST||i.method===D.PATCH){var s=a([this.body,this.formData],2),u=s[0],c=s[1];c&&(i.formData=c),u&&(i.body=u)}return i},Object.defineProperty(e.prototype,"headers",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){throw Error("`path` getter should be implemented by subclass.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"queryParameters",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"formData",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){},enumerable:!1,configurable:!0}),e.prototype.deserializeResponse=function(t){var n=t.headers["content-type"];if(-1!==n.indexOf("javascript")&&-1!==n.indexOf("json")){var r=e.decoder.decode(t.body);try{return JSON.parse(r)}catch(e){return void console.error("Error parsing JSON response:",e)}}},e.decoder=new TextDecoder,e}();!function(e){e.PNPublishOperation="PNPublishOperation",e.PNSignalOperation="PNSignalOperation",e.PNSubscribeOperation="PNSubscribeOperation",e.PNUnsubscribeOperation="PNUnsubscribeOperation",e.PNWhereNowOperation="PNWhereNowOperation",e.PNHereNowOperation="PNHereNowOperation",e.PNSetStateOperation="PNSetStateOperation",e.PNGetStateOperation="PNGetStateOperation",e.PNHeartbeatOperation="PNHeartbeatOperation",e.PNAddMessageActionOperation="PNAddActionOperation",e.PNRemoveMessageActionOperation="PNRemoveMessageActionOperation",e.PNGetMessageActionsOperation="PNGetMessageActionsOperation",e.PNTimeOperation="PNTimeOperation",e.PNHistoryOperation="PNHistoryOperation",e.PNDeleteMessagesOperation="PNDeleteMessagesOperation",e.PNFetchMessagesOperation="PNFetchMessagesOperation",e.PNMessageCounts="PNMessageCountsOperation",e.PNGetAllUUIDMetadataOperation="PNGetAllUUIDMetadataOperation",e.PNGetUUIDMetadataOperation="PNGetUUIDMetadataOperation",e.PNSetUUIDMetadataOperation="PNSetUUIDMetadataOperation",e.PNRemoveUUIDMetadataOperation="PNRemoveUUIDMetadataOperation",e.PNGetAllChannelMetadataOperation="PNGetAllChannelMetadataOperation",e.PNGetChannelMetadataOperation="PNGetChannelMetadataOperation",e.PNSetChannelMetadataOperation="PNSetChannelMetadataOperation",e.PNRemoveChannelMetadataOperation="PNRemoveChannelMetadataOperation",e.PNGetMembersOperation="PNGetMembersOperation",e.PNSetMembersOperation="PNSetMembersOperation",e.PNGetMembershipsOperation="PNGetMembershipsOperation",e.PNSetMembershipsOperation="PNSetMembershipsOperation",e.PNListFilesOperation="PNListFilesOperation",e.PNGenerateUploadUrlOperation="PNGenerateUploadUrlOperation",e.PNPublishFileOperation="PNPublishFileOperation",e.PNPublishFileMessageOperation="PNPublishFileMessageOperation",e.PNGetFileUrlOperation="PNGetFileUrlOperation",e.PNDownloadFileOperation="PNDownloadFileOperation",e.PNDeleteFileOperation="PNDeleteFileOperation",e.PNAddPushNotificationEnabledChannelsOperation="PNAddPushNotificationEnabledChannelsOperation",e.PNRemovePushNotificationEnabledChannelsOperation="PNRemovePushNotificationEnabledChannelsOperation",e.PNPushNotificationEnabledChannelsOperation="PNPushNotificationEnabledChannelsOperation",e.PNRemoveAllPushNotificationsOperation="PNRemoveAllPushNotificationsOperation",e.PNChannelGroupsOperation="PNChannelGroupsOperation",e.PNRemoveGroupOperation="PNRemoveGroupOperation",e.PNChannelsForGroupOperation="PNChannelsForGroupOperation",e.PNAddChannelsToGroupOperation="PNAddChannelsToGroupOperation",e.PNRemoveChannelsFromGroupOperation="PNRemoveChannelsFromGroupOperation",e.PNAccessManagerGrant="PNAccessManagerGrant",e.PNAccessManagerGrantToken="PNAccessManagerGrantToken",e.PNAccessManagerAudit="PNAccessManagerAudit",e.PNAccessManagerRevokeToken="PNAccessManagerRevokeToken",e.PNHandshakeOperation="PNHandshakeOperation",e.PNReceiveMessagesOperation="PNReceiveMessagesOperation"}(Y||(Y={}));var ce,pe=Y;!function(e){e[e.Presence=-2]="Presence",e[e.Message=-1]="Message",e[e.Signal=1]="Signal",e[e.AppContext=2]="AppContext",e[e.MessageAction=3]="MessageAction",e[e.Files=4]="Files"}(ce||(ce={}));var le=function(e){function r(t){var n,r,i,o,s,a,u=e.call(this,{cancellable:!0})||this;return u.parameters=t,null!==(n=(o=u.parameters).withPresence)&&void 0!==n||(o.withPresence=false),null!==(r=(s=u.parameters).channelGroups)&&void 0!==r||(s.channelGroups=[]),null!==(i=(a=u.parameters).channels)&&void 0!==i||(a.channels=[]),u}return t(r,e),r.prototype.operation=function(){return pe.PNSubscribeOperation},r.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroups;return t?n||r?void 0:"`channels` and `channelGroups` both should not be empty":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return o(this,(function(i){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return n=t.m.map((function(e){var t=e.e;return null!=t||(t=e.c.endsWith("-pnpres")?ce.Presence:ce.Message),"string"==typeof e.d?t==ce.Message?{type:ce.Message,data:r.messageFromEnvelope(e)}:{type:ce.Files,data:r.fileFromEnvelope(e)}:t===ce.Presence?{type:ce.Presence,data:r.presenceEventFromEnvelope(e)}:t==ce.Signal?{type:ce.Signal,data:r.signalFromEnvelope(e)}:t===ce.AppContext?{type:ce.AppContext,data:r.appContextFromEnvelope(e)}:t===ce.MessageAction?{type:ce.MessageAction,data:r.messageActionFromEnvelope(e)}:{type:ce.Files,data:r.fileFromEnvelope(e)}})),[2,{cursor:{timetoken:t.t.t,region:t.t.r},messages:n}]}))}))},r.prototype.presenceEventFromEnvelope=function(e){var t=e.d,r=a(this.subscriptionChannelFromEnvelope(e),2),i=r[0],o=r[1];return i=i.replace("-pnpres",""),o&&(o=o.replace("-pnpres","")),n({channel:i,subscription:o,actualChannel:null!==o?i:null,subscribedChannel:null!==o?o:i,timetoken:e.p.t},t)},r.prototype.messageFromEnvelope=function(e){var t=a(this.subscriptionChannelFromEnvelope(e),2),n=t[0],r=t[1],i=a(this.decryptedData(e.d),2),o=i[0],s=i[1],u={channel:n,subscription:r,actualChannel:null!==r?n:null,subscribedChannel:null!==r?r:n,timetoken:e.p.t,publisher:e.i,userMetadata:e.u,message:o};return s&&(u.error=s),u},r.prototype.signalFromEnvelope=function(e){var t=a(this.subscriptionChannelFromEnvelope(e),2);return{channel:t[0],subscription:t[1],timetoken:e.p.t,publisher:e.i,userMetadata:e.u,message:e.d}},r.prototype.messageActionFromEnvelope=function(e){var t=a(this.subscriptionChannelFromEnvelope(e),2),r=t[0],i=t[1],o=e.d;return{channel:r,subscription:i,timetoken:e.p.t,publisher:e.i,event:o.event,data:n(n({},o.data),{uuid:e.i})}},r.prototype.appContextFromEnvelope=function(e){var t=a(this.subscriptionChannelFromEnvelope(e),2),n=t[0],r=t[1],i=e.d;return{channel:n,subscription:r,timetoken:e.p.t,message:i}},r.prototype.fileFromEnvelope=function(e){var t=a(this.subscriptionChannelFromEnvelope(e),2),n=t[0],r=t[1],i=a(this.decryptedData(e.d),2),o=i[0],s=i[1],u={channel:n,subscription:r,timetoken:e.p.t,publisher:e.i,userMetadata:e.u};return o?"string"==typeof o?null!=s||(s="Unexpected file information payload data type."):(u.message=o.message,o.file&&(u.file={id:o.file.id,name:o.file.name,url:this.parameters.getFileUrl({id:o.file.id,name:o.file.name,channel:n})})):null!=s||(s="File information payload is missing."),s&&(u.error=s),u},r.prototype.subscriptionChannelFromEnvelope=function(e){return[e.c,void 0===e.b||e.b===e.c?null:e.b]},r.prototype.decryptedData=function(e){if(!this.parameters.crypto||"string"!=typeof e)return[e,void 0];var t,n;try{var r=this.parameters.crypto.decrypt(e);t=r instanceof ArrayBuffer?JSON.parse(he.decoder.decode(r)):r}catch(e){t=null,n="Error while decrypting file message content: ".concat(e.message)}return[null!=t?t:e,n]},r}(ue),he=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels;return"/v2/subscribe/".concat(t,"/").concat(H(n.length>0?n.join(","):","),"/0")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channelGroups,n=e.filterExpression,r=e.state,i=e.timetoken,o=e.region,s={};return t&&t.length>0&&(s["channel-group"]=t.join(",")),n&&n.length>0&&(s["filter-expr"]=n),r&&Object.keys(r).length>0&&(s.state=JSON.stringify(r)),"string"==typeof i?i&&i.length>0&&(s.tt=i):i&&i>0&&(s.tt=i),o&&(s.tr=o),s},enumerable:!1,configurable:!0}),n}(le),fe=function(){function e(e){this.listenerManager=e,this.channelListenerMap=new Map,this.groupListenerMap=new Map}return e.prototype.emitEvent=function(e){if(e.type===ce.Message)this.listenerManager.announceMessage(e.data),this.announce("message",e.data,e.data.channel,e.data.subscription);else if(e.type===ce.Signal)this.listenerManager.announceSignal(e.data),this.announce("signal",e.data,e.data.channel,e.data.subscription);else if(e.type===ce.Presence)this.listenerManager.announcePresence(e.data),this.announce("presence",e.data,e.data.channel,e.data.subscription);else if(e.type===ce.AppContext){var t=e.data,i=t.message;if(this.listenerManager.announceObjects(t),this.announce("objects",t,t.channel,t.subscription),"uuid"===i.type){t.message;var o=t.channel,s=r(t,["message","channel"]),a=i.event;i.type;var u=r(i,["event","type"]),c=n(n({},s),{spaceId:o,message:n(n({},u),{event:"set"===a?"updated":"removed",type:"user"})});this.listenerManager.announceUser(c),this.announce("user",c,c.spaceId,c.subscription)}else if("channel"===i.type){t.message;o=t.channel,s=r(t,["message","channel"]);var p=i.event;i.type;u=r(i,["event","type"]);var l=n(n({},s),{spaceId:o,message:n(n({},u),{event:"set"===p?"updated":"removed",type:"space"})});this.listenerManager.announceSpace(l),this.announce("space",l,l.spaceId,l.subscription)}else if("membership"===i.type){t.message;o=t.channel,s=r(t,["message","channel"]);var h=i.event,f=i.data,d=(u=r(i,["event","data"]),f.uuid),y=f.channel,g=r(f,["uuid","channel"]),v=n(n({},s),{spaceId:o,message:n(n({},u),{event:"set"===h?"updated":"removed",data:n(n({},g),{user:d,space:y})})});this.listenerManager.announceMembership(v),this.announce("membership",v,v.spaceId,v.subscription)}}else e.type===ce.MessageAction?(this.listenerManager.announceMessageAction(e.data),this.announce("messageAction",e.data,e.data.channel,e.data.subscription)):e.type===ce.Files&&(this.listenerManager.announceFile(e.data),this.announce("file",e.data,e.data.channel,e.data.subscription))},e.prototype.addListener=function(e,t,n){var r=this;t&&n?(null==t||t.forEach((function(t){if(r.channelListenerMap.has(t)){var n=r.channelListenerMap.get(t);n.includes(e)||n.push(e)}else r.channelListenerMap.set(t,[e])})),null==n||n.forEach((function(t){if(r.groupListenerMap.has(t)){var n=r.groupListenerMap.get(t);n.includes(e)||n.push(e)}else r.groupListenerMap.set(t,[e])}))):this.listenerManager.addListener(e)},e.prototype.removeListener=function(e,t,n){var r=this;t&&n?(null==t||t.forEach((function(t){r.channelListenerMap.has(t)&&r.channelListenerMap.set(t,r.channelListenerMap.get(t).filter((function(t){return t!==e})))})),null==n||n.forEach((function(t){r.groupListenerMap.has(t)&&r.groupListenerMap.set(t,r.groupListenerMap.get(t).filter((function(t){return t!==e})))}))):this.listenerManager.removeListener(e)},e.prototype.removeAllListeners=function(){this.listenerManager.removeAllListeners(),this.channelListenerMap.clear(),this.groupListenerMap.clear()},e.prototype.announce=function(e,t,n,r){t&&this.channelListenerMap.has(n)&&this.channelListenerMap.get(n).forEach((function(n){var r=n[e];r&&r(t)})),r&&this.groupListenerMap.has(r)&&this.groupListenerMap.get(r).forEach((function(n){var r=n[e];r&&r(t)}))},e}(),de=function(){function e(e){void 0===e&&(e=!1),this.sync=e,this.listeners=new Set}return e.prototype.subscribe=function(e){var t=this;return this.listeners.add(e),function(){t.listeners.delete(e)}},e.prototype.notify=function(e){var t=this,n=function(){t.listeners.forEach((function(t){t(e)}))};this.sync?n():setTimeout(n,0)},e}(),ye=function(){function e(e){this.label=e,this.transitionMap=new Map,this.enterEffects=[],this.exitEffects=[]}return e.prototype.transition=function(e,t){var n;if(this.transitionMap.has(t.type))return null===(n=this.transitionMap.get(t.type))||void 0===n?void 0:n(e,t)},e.prototype.on=function(e,t){return this.transitionMap.set(e,t),this},e.prototype.with=function(e,t){return[this,e,null!=t?t:[]]},e.prototype.onEnter=function(e){return this.enterEffects.push(e),this},e.prototype.onExit=function(e){return this.exitEffects.push(e),this},e}(),ge=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.describe=function(e){return new ye(e)},n.prototype.start=function(e,t){this.currentState=e,this.currentContext=t,this.notify({type:"engineStarted",state:e,context:t})},n.prototype.transition=function(e){var t,n,r,i,o,u;if(!this.currentState)throw new Error("Start the engine first");this.notify({type:"eventReceived",event:e});var c=this.currentState.transition(this.currentContext,e);if(c){var p=a(c,3),l=p[0],h=p[1],f=p[2];try{for(var d=s(this.currentState.exitEffects),y=d.next();!y.done;y=d.next()){var g=y.value;this.notify({type:"invocationDispatched",invocation:g(this.currentContext)})}}catch(e){t={error:e}}finally{try{y&&!y.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}var v=this.currentState;this.currentState=l;var b=this.currentContext;this.currentContext=h,this.notify({type:"transitionDone",fromState:v,fromContext:b,toState:l,toContext:h,event:e});try{for(var m=s(f),w=m.next();!w.done;w=m.next()){g=w.value;this.notify({type:"invocationDispatched",invocation:g})}}catch(e){r={error:e}}finally{try{w&&!w.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}try{for(var S=s(this.currentState.enterEffects),k=S.next();!k.done;k=S.next()){g=k.value;this.notify({type:"invocationDispatched",invocation:g(this.currentContext)})}}catch(e){o={error:e}}finally{try{k&&!k.done&&(u=S.return)&&u.call(S)}finally{if(o)throw o.error}}}},n}(de),ve=function(){function e(e){this.dependencies=e,this.instances=new Map,this.handlers=new Map}return e.prototype.on=function(e,t){this.handlers.set(e,t)},e.prototype.dispatch=function(e){if("CANCEL"!==e.type){var t=this.handlers.get(e.type);if(!t)throw new Error("Unhandled invocation '".concat(e.type,"'"));var n=t(e.payload,this.dependencies);e.managed&&this.instances.set(e.type,n),n.start()}else if(this.instances.has(e.payload)){var r=this.instances.get(e.payload);null==r||r.cancel(),this.instances.delete(e.payload)}},e.prototype.dispose=function(){var e,t;try{for(var n=s(this.instances.entries()),r=n.next();!r.done;r=n.next()){var i=a(r.value,2),o=i[0];i[1].cancel(),this.instances.delete(o)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e}();function be(e,t){var n=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return{type:e,payload:null==t?void 0:t.apply(void 0,u([],a(n),!1))}};return n.type=e,n}function me(e,t){var n=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return{type:e,payload:t.apply(void 0,u([],a(n),!1)),managed:!1}};return n.type=e,n}function we(e,t){var n=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return{type:e,payload:t.apply(void 0,u([],a(n),!1)),managed:!0}};return n.type=e,n.cancel={type:"CANCEL",payload:e,managed:!1},n}var Se=function(e){function n(){var t=this.constructor,n=e.call(this,"The operation was aborted.")||this;return n.name="AbortError",Object.setPrototypeOf(n,t.prototype),n}return t(n,e),n}(Error),ke=function(e){function n(){var t=e.apply(this,u([],a(arguments),!1))||this;return t._aborted=!1,t}return t(n,e),Object.defineProperty(n.prototype,"aborted",{get:function(){return this._aborted},enumerable:!1,configurable:!0}),n.prototype.throwIfAborted=function(){if(this._aborted)throw new Se},n.prototype.abort=function(){this._aborted=!0,this.notify(new Se)},n}(de),Pe=function(e){function n(t,n,r){var i=e.call(this,t,n)||this;return i.asyncFunction=r,i.abortSignal=new ke,i}return t(n,e),n.prototype.start=function(){this.asyncFunction(this.payload,this.abortSignal,this.dependencies).catch((function(e){}))},n.prototype.cancel=function(){this.abortSignal.abort()},n}((function(e,t){this.payload=e,this.dependencies=t})),Ee=function(e){return function(t,n){return new Pe(t,n,e)}},Oe=be("RECONNECT",(function(){return{}})),Ce=be("DISCONNECT",(function(){return{}})),_e=be("JOINED",(function(e,t){return{channels:e,groups:t}})),Ne=be("LEFT",(function(e,t){return{channels:e,groups:t}})),Me=be("LEFT_ALL",(function(){return{}})),Ae=be("HEARTBEAT_SUCCESS",(function(e){return{statusCode:e}})),Re=be("HEARTBEAT_FAILURE",(function(e){return e})),je=be("HEARTBEAT_GIVEUP",(function(){return{}})),Ie=be("TIMES_UP",(function(){return{}})),Te=me("HEARTBEAT",(function(e,t){return{channels:e,groups:t}})),Ue=me("LEAVE",(function(e,t){return{channels:e,groups:t}})),Fe=me("EMIT_STATUS",(function(e){return e})),De=we("WAIT",(function(){return{}})),xe=we("DELAYED_HEARTBEAT",(function(e){return e})),Ke=function(e){function r(t,r){var s=e.call(this,r)||this;return s.on(Te.type,Ee((function(e,r,a){return i(s,[e,r,a],void 0,(function(e,r,i){var s,a=i.heartbeat,u=i.presenceState,c=i.config;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,a(n(n({channels:e.channels,channelGroups:e.groups},c.maintainPresenceState&&{state:u}),{heartbeat:c.presenceTimeout}))];case 1:return r.sent(),t.transition(Ae(200)),[3,3];case 2:return(s=r.sent())instanceof v?[2,t.transition(Re(s))]:[3,3];case 3:return[2]}}))}))}))),s.on(Ue.type,Ee((function(e,t,n){return i(s,[e,t,n],void 0,(function(e,t,n){var r=n.leave,i=n.config;return o(this,(function(t){if(!i.suppressLeaveEvents)try{r({channels:e.channels,channelGroups:e.groups})}catch(e){}return[2]}))}))}))),s.on(De.type,Ee((function(e,n,r){return i(s,[e,n,r],void 0,(function(e,n,r){var i=r.heartbeatDelay;return o(this,(function(e){switch(e.label){case 0:return n.throwIfAborted(),[4,i()];case 1:return e.sent(),n.throwIfAborted(),[2,t.transition(Ie())]}}))}))}))),s.on(xe.type,Ee((function(e,r,a){return i(s,[e,r,a],void 0,(function(e,r,i){var s,a=i.heartbeat,u=i.retryDelay,c=i.presenceState,p=i.config;return o(this,(function(i){switch(i.label){case 0:return p.retryConfiguration&&p.retryConfiguration.shouldRetry(e.reason,e.attempts)?(r.throwIfAborted(),[4,u(p.retryConfiguration.getDelay(e.attempts,e.reason))]):[3,6];case 1:i.sent(),r.throwIfAborted(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,a(n(n({channels:e.channels,channelGroups:e.groups},p.maintainPresenceState&&{state:c}),{heartbeat:p.presenceTimeout}))];case 3:return i.sent(),[2,t.transition(Ae(200))];case 4:return(s=i.sent())instanceof Error&&"Aborted"===s.message?[2]:s instanceof v?[2,t.transition(Re(s))]:[3,5];case 5:return[3,7];case 6:return[2,t.transition(je())];case 7:return[2]}}))}))}))),s.on(Fe.type,Ee((function(e,t,r){return i(s,[e,t,r],void 0,(function(e,t,r){var i,s=r.emitStatus,a=r.config;return o(this,(function(t){return a.announceFailedHeartbeats&&!0===(null===(i=null==e?void 0:e.status)||void 0===i?void 0:i.error)?s(e.status):a.announceSuccessfulHeartbeats&&200===e.statusCode&&s(n(n({},e),{operation:pe.PNHeartbeatOperation,error:!1})),[2]}))}))}))),s}return t(r,e),r}(ve),Ge=new ye("HEARTBEAT_STOPPED");Ge.on(_e.type,(function(e,t){return Ge.with({channels:u(u([],a(e.channels),!1),a(t.payload.channels),!1),groups:u(u([],a(e.groups),!1),a(t.payload.groups),!1)})})),Ge.on(Ne.type,(function(e,t){return Ge.with({channels:e.channels.filter((function(e){return!t.payload.channels.includes(e)})),groups:e.groups.filter((function(e){return!t.payload.groups.includes(e)}))})})),Ge.on(Oe.type,(function(e,t){return He.with({channels:e.channels,groups:e.groups})})),Ge.on(Me.type,(function(e,t){return ze.with(void 0)}));var qe=new ye("HEARTBEAT_COOLDOWN");qe.onEnter((function(){return De()})),qe.onExit((function(){return De.cancel})),qe.on(Ie.type,(function(e,t){return He.with({channels:e.channels,groups:e.groups})})),qe.on(_e.type,(function(e,t){return He.with({channels:u(u([],a(e.channels),!1),a(t.payload.channels),!1),groups:u(u([],a(e.groups),!1),a(t.payload.groups),!1)})})),qe.on(Ne.type,(function(e,t){return He.with({channels:e.channels.filter((function(e){return!t.payload.channels.includes(e)})),groups:e.groups.filter((function(e){return!t.payload.groups.includes(e)}))},[Ue(t.payload.channels,t.payload.groups)])})),qe.on(Ce.type,(function(e){return Ge.with({channels:e.channels,groups:e.groups},[Ue(e.channels,e.groups)])})),qe.on(Me.type,(function(e,t){return ze.with(void 0,[Ue(e.channels,e.groups)])}));var Le=new ye("HEARTBEAT_FAILED");Le.on(_e.type,(function(e,t){return He.with({channels:u(u([],a(e.channels),!1),a(t.payload.channels),!1),groups:u(u([],a(e.groups),!1),a(t.payload.groups),!1)})})),Le.on(Ne.type,(function(e,t){return He.with({channels:e.channels.filter((function(e){return!t.payload.channels.includes(e)})),groups:e.groups.filter((function(e){return!t.payload.groups.includes(e)}))},[Ue(t.payload.channels,t.payload.groups)])})),Le.on(Oe.type,(function(e,t){return He.with({channels:e.channels,groups:e.groups})})),Le.on(Ce.type,(function(e,t){return Ge.with({channels:e.channels,groups:e.groups},[Ue(e.channels,e.groups)])})),Le.on(Me.type,(function(e,t){return ze.with(void 0,[Ue(e.channels,e.groups)])}));var Be=new ye("HEARBEAT_RECONNECTING");Be.onEnter((function(e){return xe(e)})),Be.onExit((function(){return xe.cancel})),Be.on(_e.type,(function(e,t){return He.with({channels:u(u([],a(e.channels),!1),a(t.payload.channels),!1),groups:u(u([],a(e.groups),!1),a(t.payload.groups),!1)})})),Be.on(Ne.type,(function(e,t){return He.with({channels:e.channels.filter((function(e){return!t.payload.channels.includes(e)})),groups:e.groups.filter((function(e){return!t.payload.groups.includes(e)}))},[Ue(t.payload.channels,t.payload.groups)])})),Be.on(Ce.type,(function(e,t){Ge.with({channels:e.channels,groups:e.groups},[Ue(e.channels,e.groups)])})),Be.on(Ae.type,(function(e,t){return qe.with({channels:e.channels,groups:e.groups})})),Be.on(Re.type,(function(e,t){return Be.with(n(n({},e),{attempts:e.attempts+1,reason:t.payload}))})),Be.on(je.type,(function(e,t){return Le.with({channels:e.channels,groups:e.groups})})),Be.on(Me.type,(function(e,t){return ze.with(void 0,[Ue(e.channels,e.groups)])}));var He=new ye("HEARTBEATING");He.onEnter((function(e){return Te(e.channels,e.groups)})),He.on(Ae.type,(function(e,t){return qe.with({channels:e.channels,groups:e.groups})})),He.on(_e.type,(function(e,t){return He.with({channels:u(u([],a(e.channels),!1),a(t.payload.channels),!1),groups:u(u([],a(e.groups),!1),a(t.payload.groups),!1)})})),He.on(Ne.type,(function(e,t){return He.with({channels:e.channels.filter((function(e){return!t.payload.channels.includes(e)})),groups:e.groups.filter((function(e){return!t.payload.groups.includes(e)}))},[Ue(t.payload.channels,t.payload.groups)])})),He.on(Re.type,(function(e,t){return Be.with(n(n({},e),{attempts:0,reason:t.payload}))})),He.on(Ce.type,(function(e){return Ge.with({channels:e.channels,groups:e.groups},[Ue(e.channels,e.groups)])})),He.on(Me.type,(function(e,t){return ze.with(void 0,[Ue(e.channels,e.groups)])}));var ze=new ye("HEARTBEAT_INACTIVE");ze.on(_e.type,(function(e,t){return He.with({channels:t.payload.channels,groups:t.payload.groups})}));var Ve=function(){function e(e){var t=this;this.dependencies=e,this.engine=new ge,this.channels=[],this.groups=[],this.dispatcher=new Ke(this.engine,e),this._unsubscribeEngine=this.engine.subscribe((function(e){"invocationDispatched"===e.type&&t.dispatcher.dispatch(e.invocation)})),this.engine.start(ze,void 0)}return Object.defineProperty(e.prototype,"_engine",{get:function(){return this.engine},enumerable:!1,configurable:!0}),e.prototype.join=function(e){var t=e.channels,n=e.groups;this.channels=u(u([],a(this.channels),!1),a(null!=t?t:[]),!1),this.groups=u(u([],a(this.groups),!1),a(null!=n?n:[]),!1),this.engine.transition(_e(this.channels.slice(0),this.groups.slice(0)))},e.prototype.leave=function(e){var t=this,n=e.channels,r=e.groups;this.dependencies.presenceState&&(null==n||n.forEach((function(e){return delete t.dependencies.presenceState[e]})),null==r||r.forEach((function(e){return delete t.dependencies.presenceState[e]}))),this.engine.transition(Ne(null!=n?n:[],null!=r?r:[]))},e.prototype.leaveAll=function(){this.engine.transition(Me())},e.prototype.dispose=function(){this._unsubscribeEngine(),this.dispatcher.dispose()},e}(),We=function(){function e(){}return e.LinearRetryPolicy=function(e){return{delay:e.delay,maximumRetry:e.maximumRetry,shouldRetry:function(e,t){var n;return 403!==(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)&&this.maximumRetry>t},getDelay:function(e,t){var n;return 1e3*((null!==(n=t.retryAfter)&&void 0!==n?n:this.delay)+Math.random())},getGiveupReason:function(e,t){var n;return this.maximumRetry<=t?"retry attempts exhaused.":403===(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)?"forbidden operation.":"unknown error"},validate:function(){if(this.maximumRetry>10)throw new Error("Maximum retry for linear retry policy can not be more than 10")}}},e.ExponentialRetryPolicy=function(e){return{minimumDelay:e.minimumDelay,maximumDelay:e.maximumDelay,maximumRetry:e.maximumRetry,shouldRetry:function(e,t){var n;return 403!==(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)&&this.maximumRetry>t},getDelay:function(e,t){var n;return 1e3*((null!==(n=t.retryAfter)&&void 0!==n?n:Math.min(Math.pow(2,e),this.maximumDelay))+Math.random())},getGiveupReason:function(e,t){var n;return this.maximumRetry<=t?"retry attempts exhausted.":403===(null===(n=null==e?void 0:e.status)||void 0===n?void 0:n.statusCode)?"forbidden operation.":"unknown error"},validate:function(){if(this.minimumDelay<2)throw new Error("Minimum delay can not be set less than 2 seconds for retry");if(this.maximumDelay)throw new Error("Maximum delay can not be set more than 150 seconds for retry");if(this.maximumRetry>6)throw new Error("Maximum retry for exponential retry policy can not be more than 6")}}},e}(),Je=we("HANDSHAKE",(function(e,t){return{channels:e,groups:t}})),Ye=we("RECEIVE_MESSAGES",(function(e,t,n){return{channels:e,groups:t,cursor:n}})),Xe=me("EMIT_MESSAGES",(function(e){return e})),$e=me("EMIT_STATUS",(function(e){return e})),Ze=we("RECEIVE_RECONNECT",(function(e){return e})),Qe=we("HANDSHAKE_RECONNECT",(function(e){return e})),et=be("SUBSCRIPTION_CHANGED",(function(e,t){return{channels:e,groups:t}})),tt=be("SUBSCRIPTION_RESTORED",(function(e,t,n,r){return{channels:e,groups:t,cursor:{timetoken:n,region:null!=r?r:0}}})),nt=be("HANDSHAKE_SUCCESS",(function(e){return e})),rt=be("HANDSHAKE_FAILURE",(function(e){return e})),it=be("HANDSHAKE_RECONNECT_SUCCESS",(function(e){return{cursor:e}})),ot=be("HANDSHAKE_RECONNECT_FAILURE",(function(e){return e})),st=be("HANDSHAKE_RECONNECT_GIVEUP",(function(e){return e})),at=be("RECEIVE_SUCCESS",(function(e,t){return{cursor:e,events:t}})),ut=be("RECEIVE_FAILURE",(function(e){return e})),ct=be("RECEIVE_RECONNECT_SUCCESS",(function(e,t){return{cursor:e,events:t}})),pt=be("RECEIVE_RECONNECT_FAILURE",(function(e){return e})),lt=be("RECEIVING_RECONNECT_GIVEUP",(function(e){return e})),ht=be("DISCONNECT",(function(){return{}})),ft=be("RECONNECT",(function(e,t){return{cursor:{timetoken:null!=e?e:"",region:null!=t?t:0}}})),dt=be("UNSUBSCRIBE_ALL",(function(){return{}})),yt=function(e){function r(t,r){var s=e.call(this,r)||this;return s.on(Je.type,Ee((function(e,r,a){return i(s,[e,r,a],void 0,(function(e,r,i){var s,a,u=i.handshake,c=i.presenceState,p=i.config;return o(this,(function(i){switch(i.label){case 0:r.throwIfAborted(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,u(n({abortSignal:r,channels:e.channels,channelGroups:e.groups,filterExpression:p.filterExpression},p.maintainPresenceState&&{state:c}))];case 2:return s=i.sent(),[2,t.transition(nt(s))];case 3:return(a=i.sent())instanceof Error&&"Aborted"===a.message?[2]:a instanceof v?[2,t.transition(rt(a))]:[3,4];case 4:return[2]}}))}))}))),s.on(Ye.type,Ee((function(e,n,r){return i(s,[e,n,r],void 0,(function(e,n,r){var i,s,a=r.receiveMessages,u=r.config;return o(this,(function(r){switch(r.label){case 0:n.throwIfAborted(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,a({abortSignal:n,channels:e.channels,channelGroups:e.groups,timetoken:e.cursor.timetoken,region:e.cursor.region,filterExpression:u.filterExpression})];case 2:return i=r.sent(),t.transition(at(i.cursor,i.messages)),[3,4];case 3:return(s=r.sent())instanceof Error&&"Aborted"===s.message?[2]:s instanceof v&&!n.aborted?[2,t.transition(ut(s))]:[3,4];case 4:return[2]}}))}))}))),s.on(Xe.type,Ee((function(e,t,n){return i(s,[e,t,n],void 0,(function(e,t,n){var r=n.emitMessages;return o(this,(function(t){return e.length>0&&r(e),[2]}))}))}))),s.on($e.type,Ee((function(e,t,n){return i(s,[e,t,n],void 0,(function(e,t,n){var r=n.emitStatus;return o(this,(function(t){return r(e),[2]}))}))}))),s.on(Ze.type,Ee((function(e,n,r){return i(s,[e,n,r],void 0,(function(e,n,r){var i,s,a=r.receiveMessages,u=r.delay,c=r.config;return o(this,(function(r){switch(r.label){case 0:return c.retryConfiguration&&c.retryConfiguration.shouldRetry(e.reason,e.attempts)?(n.throwIfAborted(),[4,u(c.retryConfiguration.getDelay(e.attempts,e.reason))]):[3,6];case 1:r.sent(),n.throwIfAborted(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,a({abortSignal:n,channels:e.channels,channelGroups:e.groups,timetoken:e.cursor.timetoken,region:e.cursor.region,filterExpression:c.filterExpression})];case 3:return i=r.sent(),[2,t.transition(ct(i.cursor,i.messages))];case 4:return(s=r.sent())instanceof Error&&"Aborted"===s.message?[2]:s instanceof v?[2,t.transition(pt(s))]:[3,5];case 5:return[3,7];case 6:return[2,t.transition(lt(new v(c.retryConfiguration?c.retryConfiguration.getGiveupReason(e.reason,e.attempts):"Unable to complete subscribe messages receive.")))];case 7:return[2]}}))}))}))),s.on(Qe.type,Ee((function(e,r,a){return i(s,[e,r,a],void 0,(function(e,r,i){var s,a,u=i.handshake,c=i.delay,p=i.presenceState,l=i.config;return o(this,(function(i){switch(i.label){case 0:return l.retryConfiguration&&l.retryConfiguration.shouldRetry(e.reason,e.attempts)?(r.throwIfAborted(),[4,c(l.retryConfiguration.getDelay(e.attempts,e.reason))]):[3,6];case 1:i.sent(),r.throwIfAborted(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,u(n({abortSignal:r,channels:e.channels,channelGroups:e.groups,filterExpression:l.filterExpression},l.maintainPresenceState&&{state:p}))];case 3:return s=i.sent(),[2,t.transition(it(s))];case 4:return(a=i.sent())instanceof Error&&"Aborted"===a.message?[2]:a instanceof v?[2,t.transition(ot(a))]:[3,5];case 5:return[3,7];case 6:return[2,t.transition(st(new v(l.retryConfiguration?l.retryConfiguration.getGiveupReason(e.reason,e.attempts):"Unable to complete subscribe handshake")))];case 7:return[2]}}))}))}))),s}return t(r,e),r}(ve),gt=new ye("HANDSHAKE_FAILED");gt.on(et.type,(function(e,t){return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),gt.on(ft.type,(function(e,t){return Pt.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor||e.cursor})})),gt.on(tt.type,(function(e,t){var n,r;return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region?t.payload.cursor.region:null!==(r=null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)&&void 0!==r?r:0}})})),gt.on(dt.type,(function(e){return Et.with()}));var vt=new ye("HANDSHAKE_STOPPED");vt.on(et.type,(function(e,t){return vt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),vt.on(ft.type,(function(e,t){return Pt.with(n(n({},e),{cursor:t.payload.cursor||e.cursor}))})),vt.on(tt.type,(function(e,t){var n;return vt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)||0}})})),vt.on(dt.type,(function(e){return Et.with()}));var bt=new ye("RECEIVE_FAILED");bt.on(ft.type,(function(e,t){var n;return Pt.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(n=t.payload.cursor)||void 0===n?void 0:n.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),bt.on(et.type,(function(e,t){return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),bt.on(tt.type,(function(e,t){return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),bt.on(dt.type,(function(e){return Et.with(void 0)}));var mt=new ye("RECEIVE_STOPPED");mt.on(et.type,(function(e,t){return mt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),mt.on(tt.type,(function(e,t){return mt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),mt.on(ft.type,(function(e,t){var n;return Pt.with({channels:e.channels,groups:e.groups,cursor:{timetoken:t.payload.cursor.timetoken?null===(n=t.payload.cursor)||void 0===n?void 0:n.timetoken:e.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),mt.on(dt.type,(function(){return Et.with(void 0)}));var wt=new ye("RECEIVE_RECONNECTING");wt.onEnter((function(e){return Ze(e)})),wt.onExit((function(){return Ze.cancel})),wt.on(ct.type,(function(e,t){return St.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[Xe(t.payload.events)])})),wt.on(pt.type,(function(e,t){return wt.with(n(n({},e),{attempts:e.attempts+1,reason:t.payload}))})),wt.on(lt.type,(function(e,t){var n;return bt.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[$e({category:X.PNDisconnectedUnexpectedlyCategory,error:null===(n=t.payload)||void 0===n?void 0:n.message})])})),wt.on(ht.type,(function(e){return mt.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[$e({category:X.PNDisconnectedCategory})])})),wt.on(tt.type,(function(e,t){return St.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),wt.on(et.type,(function(e,t){return St.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),wt.on(dt.type,(function(e){return Et.with(void 0,[$e({category:X.PNDisconnectedCategory})])}));var St=new ye("RECEIVING");St.onEnter((function(e){return Ye(e.channels,e.groups,e.cursor)})),St.onExit((function(){return Ye.cancel})),St.on(at.type,(function(e,t){return St.with({channels:e.channels,groups:e.groups,cursor:t.payload.cursor},[Xe(t.payload.events)])})),St.on(et.type,(function(e,t){return 0===t.payload.channels.length&&0===t.payload.groups.length?Et.with(void 0):St.with({cursor:e.cursor,channels:t.payload.channels,groups:t.payload.groups})})),St.on(tt.type,(function(e,t){return 0===t.payload.channels.length&&0===t.payload.groups.length?Et.with(void 0):St.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||e.cursor.region}})})),St.on(ut.type,(function(e,t){return wt.with(n(n({},e),{attempts:0,reason:t.payload}))})),St.on(ht.type,(function(e){return mt.with({channels:e.channels,groups:e.groups,cursor:e.cursor},[$e({category:X.PNDisconnectedCategory})])})),St.on(dt.type,(function(e){return Et.with(void 0,[$e({category:X.PNDisconnectedCategory})])}));var kt=new ye("HANDSHAKE_RECONNECTING");kt.onEnter((function(e){return Qe(e)})),kt.onExit((function(){return Qe.cancel})),kt.on(it.type,(function(e,t){var n,r,i={timetoken:(null===(n=e.cursor)||void 0===n?void 0:n.timetoken)?null===(r=e.cursor)||void 0===r?void 0:r.timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region};return St.with({channels:e.channels,groups:e.groups,cursor:i},[$e({category:X.PNConnectedCategory})])})),kt.on(ot.type,(function(e,t){return kt.with(n(n({},e),{attempts:e.attempts+1,reason:t.payload}))})),kt.on(st.type,(function(e,t){var n;return gt.with({groups:e.groups,channels:e.channels,cursor:e.cursor,reason:t.payload},[$e({category:X.PNConnectionErrorCategory,error:null===(n=t.payload)||void 0===n?void 0:n.message})])})),kt.on(ht.type,(function(e){return vt.with({channels:e.channels,groups:e.groups,cursor:e.cursor})})),kt.on(et.type,(function(e,t){return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),kt.on(tt.type,(function(e,t){var n,r;return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:(null===(n=t.payload.cursor)||void 0===n?void 0:n.region)||(null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.region)||0}})})),kt.on(dt.type,(function(e){return Et.with(void 0)}));var Pt=new ye("HANDSHAKING");Pt.onEnter((function(e){return Je(e.channels,e.groups)})),Pt.onExit((function(){return Je.cancel})),Pt.on(et.type,(function(e,t){return 0===t.payload.channels.length&&0===t.payload.groups.length?Et.with(void 0):Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:e.cursor})})),Pt.on(nt.type,(function(e,t){var n,r;return St.with({channels:e.channels,groups:e.groups,cursor:{timetoken:(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.timetoken)?null===(r=null==e?void 0:e.cursor)||void 0===r?void 0:r.timetoken:t.payload.timetoken,region:t.payload.region}},[$e({category:X.PNConnectedCategory})])})),Pt.on(rt.type,(function(e,t){return kt.with({channels:e.channels,groups:e.groups,cursor:e.cursor,attempts:0,reason:t.payload})})),Pt.on(ht.type,(function(e){return vt.with({channels:e.channels,groups:e.groups,cursor:e.cursor})})),Pt.on(tt.type,(function(e,t){var n;return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:{timetoken:t.payload.cursor.timetoken,region:t.payload.cursor.region||(null===(n=null==e?void 0:e.cursor)||void 0===n?void 0:n.region)||0}})})),Pt.on(dt.type,(function(e){return Et.with()}));var Et=new ye("UNSUBSCRIBED");Et.on(et.type,(function(e,t){return Pt.with({channels:t.payload.channels,groups:t.payload.groups})})),Et.on(tt.type,(function(e,t){return Pt.with({channels:t.payload.channels,groups:t.payload.groups,cursor:t.payload.cursor})}));var Ot,Ct=function(){function e(e){var t=this;this.engine=new ge,this.channels=[],this.groups=[],this.dependencies=e,this.dispatcher=new yt(this.engine,e),this._unsubscribeEngine=this.engine.subscribe((function(e){"invocationDispatched"===e.type&&t.dispatcher.dispatch(e.invocation)})),this.engine.start(Et,void 0)}return Object.defineProperty(e.prototype,"_engine",{get:function(){return this.engine},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e){var t=this,n=e.channels,r=e.channelGroups,i=e.timetoken,o=e.withPresence;this.channels=u(u([],a(this.channels),!1),a(null!=n?n:[]),!1),this.groups=u(u([],a(this.groups),!1),a(null!=r?r:[]),!1),o&&(this.channels.map((function(e){return t.channels.push("".concat(e,"-pnpres"))})),this.groups.map((function(e){return t.groups.push("".concat(e,"-pnpres"))}))),i?this.engine.transition(tt(Array.from(new Set(u(u([],a(this.channels),!1),a(null!=n?n:[]),!1))),Array.from(new Set(u(u([],a(this.groups),!1),a(null!=r?r:[]),!1))),i)):this.engine.transition(et(Array.from(new Set(u(u([],a(this.channels),!1),a(null!=n?n:[]),!1))),Array.from(new Set(u(u([],a(this.groups),!1),a(null!=r?r:[]),!1))))),this.dependencies.join&&this.dependencies.join({channels:Array.from(new Set(this.channels.filter((function(e){return!e.endsWith("-pnpres")})))),groups:Array.from(new Set(this.groups.filter((function(e){return!e.endsWith("-pnpres")}))))})},e.prototype.unsubscribe=function(e){var t=this,n=e.channels,r=void 0===n?[]:n,i=e.channelGroups,o=void 0===i?[]:i,s=z(this.channels,u(u([],a(r),!1),a(r.map((function(e){return"".concat(e,"-pnpres")}))),!1)),c=z(this.groups,u(u([],a(o),!1),a(o.map((function(e){return"".concat(e,"-pnpres")}))),!1));if(new Set(this.channels).size!==new Set(s).size||new Set(this.groups).size!==new Set(c).size){var p=V(this.channels,r),l=V(this.groups,o);this.dependencies.presenceState&&(null==p||p.forEach((function(e){return delete t.dependencies.presenceState[e]})),null==l||l.forEach((function(e){return delete t.dependencies.presenceState[e]}))),this.channels=s,this.groups=c,this.engine.transition(et(Array.from(new Set(this.channels.slice(0))),Array.from(new Set(this.groups.slice(0))))),this.dependencies.leave&&this.dependencies.leave({channels:p.slice(0),groups:l.slice(0)})}},e.prototype.unsubscribeAll=function(){this.channels=[],this.groups=[],this.dependencies.presenceState&&(this.dependencies.presenceState={}),this.engine.transition(et(this.channels.slice(0),this.groups.slice(0))),this.dependencies.leaveAll&&this.dependencies.leaveAll()},e.prototype.reconnect=function(e){var t=e.timetoken,n=e.region;this.engine.transition(ft(t,n))},e.prototype.disconnect=function(){this.engine.transition(ht()),this.dependencies.leaveAll&&this.dependencies.leaveAll()},e.prototype.getSubscribedChannels=function(){return Array.from(new Set(this.channels.slice(0)))},e.prototype.getSubscribedChannelGroups=function(){return Array.from(new Set(this.groups.slice(0)))},e.prototype.dispose=function(){this.disconnect(),this._unsubscribeEngine(),this.dispatcher.dispose()},e}(),_t=function(e){function r(t){var n,r,i,o,s,a,u=e.call(this,{method:t.sendByPost?D.POST:D.GET})||this;return u.parameters=t,null!==(n=(o=u.parameters).storeInHistory)&&void 0!==n||(o.storeInHistory=true),null!==(r=(s=u.parameters).sendByPost)&&void 0!==r||(s.sendByPost=false),null!==(i=(a=u.parameters).replicate)&&void 0!==i||(a.replicate=true),u}return t(r,e),r.prototype.operation=function(){return pe.PNPublishOperation},r.prototype.validate=function(){var e=this.parameters,t=e.message,n=e.channel,r=e.keySet.publishKey;return n?t?r?void 0:"Missing 'publishKey'":"Missing 'message'":"Missing 'channel''"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{timetoken:t[2]}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.message,n=e.channel,r=e.keySet,i=this.prepareMessagePayload(t);return"/publish/".concat(r.publishKey,"/").concat(r.subscribeKey,"/0/").concat(H(n),"/0").concat(this.parameters.sendByPost?"":"/".concat(H(i)))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.meta,r=e.replicate,i=e.storeInHistory,o=e.ttl;return n(n(n({store:i?"1":"0"},void 0!==o?{ttl:o}:{}),r?{}:{norep:"true"}),t&&"object"==typeof t?{meta:JSON.stringify(t)}:{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){return this.prepareMessagePayload(this.parameters.message)},enumerable:!1,configurable:!0}),r.prototype.prepareMessagePayload=function(e){var t=this.parameters.crypto;if(!t)return JSON.stringify(e)||"";var n=t.encrypt(JSON.stringify(e));return JSON.stringify("string"==typeof n?n:g(n))},r}(ue),Nt=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNSignalOperation},n.prototype.validate=function(){var e=this.parameters,t=e.message,n=e.channel,r=e.keySet.publishKey;return n?t?r?void 0:"Missing 'publishKey'":"Missing 'message'":"Missing 'channel''"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{timetoken:t[2]}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet,n=t.publishKey,r=t.subscribeKey,i=e.channel,o=e.message,s=JSON.stringify(o);return"/signal/".concat(n,"/").concat(r,"/0/").concat(H(i),"/0/").concat(H(s))},enumerable:!1,configurable:!0}),n}(ue),Mt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.operation=function(){return pe.PNReceiveMessagesOperation},n.prototype.validate=function(){var t=e.prototype.validate.call(this);return t||(this.parameters.timetoken?this.parameters.region?void 0:"region can not be empty":"timetoken can not be empty")},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels;return"/v2/subscribe/".concat(t,"/").concat(H(n.length>0?n.join(","):","),"/0")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channelGroups,n=e.filterExpression,r=e.timetoken,i=e.region,o={ee:""};return t&&t.length>0&&(o["channel-group"]=t.join(",")),n&&n.length>0&&(o["filter-expr"]=n),"string"==typeof r?r&&r.length>0&&(o.tt=r):r&&r>0&&(o.tt=r),i&&(o.tr=i),o},enumerable:!1,configurable:!0}),n}(le),At=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.operation=function(){return pe.PNHandshakeOperation},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels;return"/v2/subscribe/".concat(t,"/").concat(H(n.length>0?n.join(","):","),"/0")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channelGroups,n=e.filterExpression,r=e.state,i={tt:0,ee:""};return t&&t.length>0&&(i["channel-group"]=t.join(",")),n&&n.length>0&&(i["filter-expr"]=n),r&&Object.keys(r).length>0&&(i.state=JSON.stringify(r)),i},enumerable:!1,configurable:!0}),n}(le),Rt=function(e){function n(t){var n,r,i,o,s=e.call(this)||this;return s.parameters=t,null!==(n=(i=s.parameters).channels)&&void 0!==n||(i.channels=[]),null!==(r=(o=s.parameters).channelGroups)&&void 0!==r||(o.channelGroups=[]),s}return t(n,e),n.prototype.operation=function(){return pe.PNGetStateOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroups;return t?n&&n.length>0&&r&&r.length>0?"Only `channels` or `channelGroups` can be specified at once.":void 0:"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(o){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return n=this.parameters,r=n.channels,i=n.channelGroups,s={channels:{}},1===(null==r?void 0:r.length)&&0===(null==i?void 0:i.length)?s.channels[r[0]]=t.payload:s.channels=t.payload,[2,s]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid,r=e.channels,i=r&&r.length>0?H(r.join(",")):",";return"/v2/presence/sub-key/".concat(t,"/channel/").concat(i,"/uuid/").concat(n)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters.channelGroups;return e&&0!==e.length?{"channel-group":e.join(",")}:{}},enumerable:!1,configurable:!0}),n}(ue),jt=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNSetStateOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.state,r=e.channels,i=e.channelGroups;return t?n?0===(null==r?void 0:r.length)&&0===(null==i?void 0:i.length)?"Please provide a list of channels and/or channel-groups":void 0:"Missing State":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{state:t.payload}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid,r=e.channels,i=r&&r.length>0?H(r.join(",")):",";return"/v2/presence/sub-key/".concat(t,"/channel/").concat(i,"/uuid/").concat(n,"/data")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channelGroups,n=e.state,r={state:JSON.stringify(n)};return t&&0===t.length&&(r["channel-group"]=t.join(",")),r},enumerable:!1,configurable:!0}),n}(ue),It=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNHeartbeatOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroups;return t?0===(null==n?void 0:n.length)&&0===(null==r?void 0:r.length)?"Please provide a list of channels and/or channel-groups":void 0:"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=n&&n.length>0?H(n.join(",")):",";return"/v2/presence/sub-key/".concat(t,"/channel/").concat(r,"/heartbeat")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channelGroups,n=e.state,r=e.heartbeat,i={heartbeat:"".concat(r)};return t&&0===t.length&&(i["channel-group"]=t.join(",")),n&&(i.state=JSON.stringify(n)),i},enumerable:!1,configurable:!0}),n}(ue),Tt=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNUnsubscribeOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroups;return t?0===(null==n?void 0:n.length)&&0===(null==r?void 0:r.length)?"At least one `channel` or `channel group` should be provided.":void 0:"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=n&&n.length>0?H(n.join(",")):",";return"/v2/presence/sub-key/".concat(t,"/channel/").concat(r,"/leave")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters.channelGroups;return e&&0!==e.length?{"channel-group":e.join(",")}:{}},enumerable:!1,configurable:!0}),n}(ue),Ut=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNWhereNowOperation},n.prototype.validate=function(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return t.payload?[2,{channels:t.payload.channels}]:[2,{channels:[]}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid;return"/v2/presence/sub-key/".concat(t,"/uuid/").concat(H(n))},enumerable:!1,configurable:!0}),n}(ue),Ft=function(e){function r(t){var n,r,i,o,s,a,u=e.call(this)||this;return u.parameters=t,null!==(n=(o=u.parameters).queryParameters)&&void 0!==n||(o.queryParameters={}),null!==(r=(s=u.parameters).includeUUIDs)&&void 0!==r||(s.includeUUIDs=true),null!==(i=(a=u.parameters).includeState)&&void 0!==i||(a.includeState=false),u}return t(r,e),r.prototype.operation=function(){return pe.PNHereNowOperation},r.prototype.validate=function(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a,u,c;return o(this,(function(o){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return n="occupancy"in t?1:t.payload.total_channels,r="occupancy"in t?t.occupancy:t.payload.total_channels,i={},s={},"occupancy"in t?(a=this.parameters.channels[0],s[a]={uuids:null!==(u=t.uuids)&&void 0!==u?u:[],occupancy:r}):s=null!==(c=t.payload.channels)&&void 0!==c?c:{},Object.keys(s).forEach((function(e){var t=s[e];i[e]={occupants:t.uuids.map((function(e){return"string"==typeof e?{uuid:e,state:null}:e})),name:e,occupancy:t.occupancy}})),[2,{totalChannels:n,totalOccupancy:r,channels:i}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroups,i="/v2/presence/sub-key/".concat(t);if(n&&n.length>0||r&&r.length>0){var o=n&&n.length>0?H(n.join(",")):",";i+="/channel/".concat(o)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channelGroups,r=e.includeUUIDs,i=e.includeState,o=e.queryParameters;return n(n(n(n({},r?{}:{disable_uuids:"1"}),null!=i&&i?{state:"1"}:{}),t&&t.length>0?{"channel-group":t.join(",")}:{}),o)},enumerable:!1,configurable:!0}),r}(ue),Dt=function(e){function r(t){var n=e.call(this,{method:D.DELETE})||this;return n.parameters=t,n}return t(r,e),r.prototype.operation=function(){return pe.PNDeleteMessagesOperation},r.prototype.validate=function(){return this.parameters.keySet.subscribeKey?this.parameters.channel?void 0:"Missing channel":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v3/history/sub-key/".concat(t,"/channel/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.start,r=e.end;return n(n({},t?{start:t}:{}),r?{end:r}:{})},enumerable:!1,configurable:!0}),r}(ue),xt=function(e){function r(t){var n=e.call(this)||this;return n.parameters=t,n}return t(r,e),r.prototype.operation=function(){return pe.PNMessageCounts},r.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.timetoken,i=e.channelTimetokens;return t?n?r&&i?"`timetoken` and `channelTimetokens` are incompatible together":r||i?i&&i.length&&i.length!==n.length?"Length of `channelTimetokens` and `channels` do not match":void 0:"`timetoken` or `channelTimetokens` need to be set":"Missing channels":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{channels:t.channels}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){return"/v3/history/sub-key/".concat(this.parameters.keySet.subscribeKey,"/message-counts/").concat(H(this.parameters.channels.join(",")))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters.channelTimetokens;return this.parameters.timetoken&&(e=[this.parameters.timetoken]),n(n({},1===e.length?{timetoken:e[0]}:{}),e.length>1?{channelsTimetoken:e.join(",")}:{})},enumerable:!1,configurable:!0}),r}(ue),Kt=function(e){function r(t){var n,r,i,o=e.call(this)||this;return o.parameters=t,t.count?t.count=Math.min(t.count,100):t.count=100,null!==(n=t.stringifiedTimeToken)&&void 0!==n||(t.stringifiedTimeToken=false),null!==(r=t.includeMeta)&&void 0!==r||(t.includeMeta=false),null!==(i=t.logVerbosity)&&void 0!==i||(t.logVerbosity=false),o}return t(r,e),r.prototype.operation=function(){return pe.PNHistoryOperation},r.prototype.validate=function(){return this.parameters.keySet.subscribeKey?this.parameters.channel?void 0:"Missing channel":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s=this;return o(this,(function(o){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return n=t[0],r=t[1],i=t[2],Array.isArray(n)?[2,{messages:n.map((function(e){var t=s.processPayload(e.message),n={entry:t.payload,timetoken:e.timetoken};return t.error&&(n.error=t.error),e.meta&&(n.meta=e.meta),n})),startTimeToken:r,endTimeToken:i}]:[2,{messages:[],startTimeToken:r,endTimeToken:i}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v2/history/sub-key/".concat(t,"/channel/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.start,r=e.end,i=e.reverse,o=e.count,s=e.stringifiedTimeToken,a=e.includeMeta;return n(n(n(n(n({count:o,include_token:"true"},t?{start:t}:{}),r?{end:r}:{}),s?{string_message_token:"true"}:{}),null!=i?{reverse:i.toString()}:{}),a?{include_meta:"true"}:{})},enumerable:!1,configurable:!0}),r.prototype.processPayload=function(e){var t,n,i=this.parameters,o=i.crypto,s=i.logVerbosity;if(!o||"string"!=typeof e)return{payload:e};try{var a=o.decrypt(e);t=a instanceof ArrayBuffer?JSON.parse(r.decoder.decode(a)):a}catch(r){s&&console.log("decryption error",r.message),t=e,n="Error while decrypting message content: ".concat(r.message)}return{payload:t,error:n}},r}(ue);!function(e){e[e.Message=-1]="Message",e[e.Files=4]="Files"}(Ot||(Ot={}));var Gt=function(e){function r(t){var n,r,i,o,s,a,u=e.call(this)||this;u.parameters=t;var c=null!==(n=t.includeMessageActions)&&void 0!==n&&n,p=1===t.channels.length&&c?100:25;return t.count?t.count=Math.min(t.count,p):t.count=p,t.includeUuid?t.includeUUID=t.includeUuid:null!==(r=t.includeUUID)&&void 0!==r||(t.includeUUID=true),null!==(i=t.stringifiedTimeToken)&&void 0!==i||(t.stringifiedTimeToken=false),null!==(o=t.includeMessageType)&&void 0!==o||(t.includeMessageType=true),null!==(s=t.includeMeta)&&void 0!==s||(t.includeMeta=true),null!==(a=t.logVerbosity)&&void 0!==a||(t.logVerbosity=false),u}return t(r,e),r.prototype.operation=function(){return pe.PNFetchMessagesOperation},r.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.includeMessageActions;return t?n?r&&n.length>1?"History can return actions data for a single channel only. Either pass a single channel or disable the includeMessageActions flag.":void 0:"Missing channels":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s=this;return o(this,(function(o){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return n=null!==(i=t.channels)&&void 0!==i?i:{},r={},Object.keys(n).forEach((function(e){r[e]=n[e].map((function(t){null===t.message_type&&(t.message_type=Ot.Message);var n=s.processPayload(e,t),r={channel:e,timetoken:t.timetoken,message:n.payload,messageType:t.message_type,uuid:t.uuid};if(t.actions){var i=r;i.actions=t.actions,i.data=t.actions}return t.meta&&(r.meta=t.meta),n.error&&(r.error=n.error),r}))})),t.more?[2,{channels:n,more:t.more}]:[2,{channels:n}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.includeMessageActions;return"/v3/".concat(r?"history-with-actions":"history","/sub-key/").concat(t,"/channel/").concat(H(n.join(",")))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.start,r=e.end,i=e.count,o=e.includeMessageType,s=e.includeMeta,a=e.includeUUID,u=e.stringifiedTimeToken;return n(n(n(n(n(n({max:i},t?{start:t}:{}),r?{end:r}:{}),u?{string_message_token:"true"}:{}),s?{include_meta:"true"}:{}),a?{include_uuid:"true"}:{}),o?{include_message_type:"true"}:{})},enumerable:!1,configurable:!0}),r.prototype.processPayload=function(e,t){var i,o,s=this.parameters,a=s.crypto,u=s.logVerbosity;if(!a||"string"!=typeof t.message)return{payload:t.message};try{var c=a.decrypt(t.message);i=c instanceof ArrayBuffer?JSON.parse(r.decoder.decode(c)):c}catch(e){u&&console.log("decryption error",e.message),i=t.message,o="Error while decrypting message content: ".concat(e.message)}if(!o&&i&&t.message_type==Ot.Files&&"object"==typeof i&&this.isFileMessage(i)){var p=i;return{payload:{message:p.message,file:n(n({},p.file),{url:this.parameters.getFileUrl({channel:e,id:p.file.id,name:p.file.name})})},error:o}}return{payload:i,error:o}},r.prototype.isFileMessage=function(e){return void 0!==e.file},r}(ue),qt=function(e){function r(t){var n=e.call(this)||this;return n.parameters=t,n}return t(r,e),r.prototype.operation=function(){return pe.PNGetMessageActionsOperation},r.prototype.validate=function(){return this.parameters.keySet.subscribeKey?this.parameters.channel?void 0:"Missing message channel":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return n=null,r=null,t.data.length>0&&(n=t.data[0].actionTimetoken,r=t.data[t.data.length-1].actionTimetoken),[2,{data:t.data,more:t.more,start:n,end:r}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v1/message-actions/".concat(t,"/channel/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.limit,r=e.start,i=e.end;return n(n(n({},r?{start:r}:{}),i?{end:i}:{}),t?{limit:t}:{})},enumerable:!1,configurable:!0}),r}(ue),Lt=function(e){function n(t){var n=e.call(this,{method:D.POST})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNAddMessageActionOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.action,r=e.channel,i=e.messageTimetoken;return t?r?i?n&&n.value?n.type?n.type.length>15?"Action.type value exceed maximum length of 15":void 0:"Missing Action.type":"Missing Action.value":"Missing message timetoken":"Missing message channel":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{data:t.data}]}))}))},Object.defineProperty(n.prototype,"headers",{get:function(){return{"Content-Type":"application/json"}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel,r=e.messageTimetoken;return"/v1/message-actions/".concat(t,"/channel/").concat(H(n),"/message/").concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"body",{get:function(){return JSON.stringify(this.parameters.action)},enumerable:!1,configurable:!0}),n}(ue),Bt=function(e){function n(t){var n=e.call(this,{method:D.DELETE})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNRemoveMessageActionOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel,r=e.messageTimetoken,i=e.actionTimetoken;return t?n?r?i?void 0:"Missing action timetoken":"Missing message timetoken":"Missing message action channel":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{data:t.data}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel,r=e.actionTimetoken,i=e.messageTimetoken;return"/v1/message-actions/".concat(t,"/channel/").concat(H(n),"/message/").concat(i,"/action/").concat(r)},enumerable:!1,configurable:!0}),n}(ue),Ht=function(e){function r(t){var n,r,i=e.call(this)||this;return i.parameters=t,null!==(n=(r=i.parameters).storeInHistory)&&void 0!==n||(r.storeInHistory=true),i}return t(r,e),r.prototype.operation=function(){return pe.PNPublishFileMessageOperation},r.prototype.validate=function(){var e=this.parameters,t=e.channel,n=e.fileId,r=e.fileName;return t?n?r?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{timetoken:t[2]}]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.message,r=e.channel,i=e.keySet,o=i.publishKey,s=i.subscribeKey,a=e.fileId,u=e.fileName,c=n({file:{name:u,id:a}},t?{message:t}:{});return"/v1/files/publish-file/".concat(o,"/").concat(s,"/0/").concat(H(r),"/0/").concat(H(this.prepareMessagePayload(c)))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.storeInHistory,r=e.ttl,i=e.meta;return n(n({store:t?"1":"0"},r?{ttl:r}:{}),i&&"object"==typeof i?{meta:JSON.stringify(i)}:{})},enumerable:!1,configurable:!0}),r.prototype.prepareMessagePayload=function(e){var t=this.parameters.crypto;if(!t)return JSON.stringify(e)||"";var n=t.encrypt(JSON.stringify(e));return JSON.stringify("string"==typeof n?n:g(n))},r}(ue),zt=function(e){function n(t){var n=e.call(this,{method:D.LOCAL})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNGetFileUrlOperation},n.prototype.validate=function(){var e=this.parameters,t=e.channel,n=e.id,r=e.name;return t?n?r?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,e.url]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.channel,n=e.id,r=e.name,i=e.keySet.subscribeKey;return"/v1/files/".concat(i,"/channels/").concat(H(t),"/files/").concat(n,"/").concat(r)},enumerable:!1,configurable:!0}),n}(ue),Vt=function(e){function n(t){var n=e.call(this,{method:D.DELETE})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNDeleteFileOperation},n.prototype.validate=function(){var e=this.parameters,t=e.channel,n=e.id,r=e.name;return t?n?r?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.id,r=e.channel,i=e.name;return"/v1/files/".concat(t,"/channels/").concat(H(r),"/files/").concat(n,"/").concat(i)},enumerable:!1,configurable:!0}),n}(ue),Wt=function(e){function r(t){var n,r,i=e.call(this)||this;return i.parameters=t,null!==(n=(r=i.parameters).limit)&&void 0!==n||(r.limit=100),i}return t(r,e),r.prototype.operation=function(){return pe.PNListFilesOperation},r.prototype.validate=function(){if(!this.parameters.channel)return"channel can't be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v1/files/".concat(t,"/channels/").concat(H(n),"/files")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.limit,r=e.next;return n({limit:t},r?{next:r}:{})},enumerable:!1,configurable:!0}),r}(ue),Jt=function(e){function n(t){var n=e.call(this,{method:D.POST})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNGenerateUploadUrlOperation},n.prototype.validate=function(){return this.parameters.channel?this.parameters.name?void 0:"'name' can't be empty":"channel can't be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{id:t.data.id,name:t.data.name,url:t.file_upload_request.url,formFields:t.file_upload_request.form_fields}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v1/files/".concat(t,"/channels/").concat(H(n),"/generate-upload-url")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"body",{get:function(){return JSON.stringify({name:this.parameters.name})},enumerable:!1,configurable:!0}),n}(ue),Yt=function(e){function r(t){var n=e.call(this)||this;n.parameters=t;var r=t.file.mimeType;return r&&(t.formFields=t.formFields.map((function(e){return"Content-Type"===e.name?{name:e.name,value:r}:e}))),n}return t(r,e),r.prototype.operation=function(){return pe.PNPublishFileOperation},r.prototype.validate=function(){var e=this.parameters,t=e.fileId,n=e.fileName,r=e.file,i=e.uploadUrl;return t?n?r?i?void 0:"Validation failed: file upload 'url' can't be empty":"Validation failed: 'file' can't be empty":"Validation failed: file 'name' can't be empty":"Validation failed: file 'id' can't be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return[2,{status:e.status,message:e.body?r.decoder.decode(e.body):"OK"}]}))}))},r.prototype.request=function(){return n(n({},e.prototype.request.call(this)),{origin:new URL(this.parameters.uploadUrl).origin})},Object.defineProperty(r.prototype,"path",{get:function(){var e=new URL(this.parameters.uploadUrl),t=e.pathname,n=e.search;return"".concat(t).concat(n)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){return this.parameters.file},enumerable:!1,configurable:!0}),r}(ue),Xt=function(){function e(e){var t;if(this.parameters=e,this.file=null===(t=this.parameters.PubNubFile)||void 0===t?void 0:t.create(e.file),!this.file)throw new Error("File upload error: unable to create File object.")}return e.prototype.process=function(){return i(this,void 0,void 0,(function(){var e,t,n=this;return o(this,(function(r){return[2,this.generateFileUploadUrl().then((function(r){return e=r.name,t=r.id,n.uploadFile(r)})).then((function(){return n.publishFileMessage(t,e)})).catch((function(e){var t=$.create(e).toStatus(pe.PNPublishFileOperation);throw new v("File upload error.",t)}))]}))}))},e.prototype.generateFileUploadUrl=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){return e=new Jt(n(n({},this.parameters),{name:this.file.name,keySet:this.parameters.keySet})),[2,this.parameters.sendRequest(e)]}))}))},e.prototype.uploadFile=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a,u,c,p,l,h;return o(this,(function(o){switch(o.label){case 0:return t=this.parameters,n=t.cipherKey,r=t.PubNubFile,i=t.crypto,s=t.cryptography,a=e.id,u=e.name,c=e.url,p=e.formFields,this.parameters.PubNubFile.supportsEncryptFile?n||!i?[3,2]:(l=this,[4,i.encryptFile(this.file,r)]):[3,4];case 1:return l.file=o.sent(),[3,4];case 2:return n&&s?(h=this,[4,s.encryptFile(n,this.file,r)]):[3,4];case 3:h.file=o.sent(),o.label=4;case 4:return[2,this.parameters.sendRequest(new Yt({fileId:a,fileName:u,file:this.file,uploadUrl:c,formFields:p}))]}}))}))},e.prototype.publishFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s;return o(this,(function(o){switch(o.label){case 0:r={timetoken:"0"},i=this.parameters.fileUploadPublishRetryLimit,s=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.parameters.publishFile(n(n({},this.parameters),{fileId:e,fileName:t}))];case 2:return r=o.sent(),s=!0,[3,4];case 3:return o.sent(),i-=1,[3,4];case 4:if(!s&&i>0)return[3,1];o.label=5;case 5:if(s)return[2,{status:200,timetoken:r.timetoken,id:e,name:t}];throw new v("Publish failed. You may want to execute that operation manually using pubnub.publishFile",{error:!0,channel:this.parameters.channel,id:e,name:t})}}))}))},e}(),$t=function(e){function n(t){var n=e.call(this,{method:D.DELETE})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNAccessManagerRevokeToken},n.prototype.validate=function(){return this.parameters.keySet.secretKey?this.parameters.token?void 0:"token can't be empty":"Missing Secret Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.token;return"/v3/pam/".concat(t,"/grant/").concat(H(n))},enumerable:!1,configurable:!0}),n}(ue),Zt=function(e){function r(t){var n,r,i,o,s=e.call(this,{method:D.POST})||this;return s.parameters=t,null!==(n=(i=s.parameters).resources)&&void 0!==n||(i.resources={}),null!==(r=(o=s.parameters).patterns)&&void 0!==r||(o.patterns={}),s}return t(r,e),r.prototype.operation=function(){return pe.PNAccessManagerGrantToken},r.prototype.validate=function(){var e,t,n,r,i,o,s=this.parameters,a=s.keySet,u=a.subscribeKey,c=a.publishKey,p=a.secretKey,l=s.resources,h=s.patterns;if(!u)return"Missing Subscribe Key";if(!c)return"Missing Publish Key";if(!p)return"Missing Secret Key";if(!l&&!h)return"Missing either Resources or Patterns";if(this.isVspPermissions(this.parameters)&&("channels"in(null!==(e=this.parameters.resources)&&void 0!==e?e:{})||"uuids"in(null!==(t=this.parameters.resources)&&void 0!==t?t:{})||"groups"in(null!==(n=this.parameters.resources)&&void 0!==n?n:{})||"channels"in(null!==(r=this.parameters.patterns)&&void 0!==r?r:{})||"uuids"in(null!==(i=this.parameters.patterns)&&void 0!==i?i:{})||"groups"in(null!==(o=this.parameters.patterns)&&void 0!==o?o:{})))return"Cannot mix `users`, `spaces` and `authorizedUserId` with `uuids`, `channels`, `groups` and `authorized_uuid`";var f=!0;return[this.parameters.resources,this.parameters.patterns].forEach((function(e){Object.keys(null!=e?e:{}).forEach((function(t){var n;e&&f&&Object.keys(null!==(n=e[t])&&void 0!==n?n:{}).length>0&&(f=!1)}))})),f?"Missing values for either Resources or Patterns":void 0},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t.data.token]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){return"/v3/pam/".concat(this.parameters.keySet.subscribeKey,"/grant")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){var e=this,t=this.parameters,r=t.ttl,i=t.meta,o=n({},r||0===r?{ttl:r}:{}),s=this.isVspPermissions(this.parameters)?this.parameters.authorizedUserId:this.parameters.authorized_uuid,a={},u={},c={},p=function(e,t,n,r){r[n]||(r[n]={}),r[n][e]=t},l=this.parameters;return[l.resources,l.patterns].forEach((function(t,n){var r,i,o,s,a,l=0===n?u:c,h={},f={},d={};t&&("spaces"in t||"users"in t?(h=null!==(r=t.spaces)&&void 0!==r?r:{},d=null!==(i=t.users)&&void 0!==i?i:{}):("channels"in t||"uuids"in t||"groups"in t)&&(h=null!==(o=t.channels)&&void 0!==o?o:{},f=null!==(s=t.groups)&&void 0!==s?s:{},d=null!==(a=t.uuids)&&void 0!==a?a:{})),Object.keys(h).forEach((function(t){return p(t,e.extractPermissions(h[t]),"channels",l)})),Object.keys(f).forEach((function(t){return p(t,e.extractPermissions(f[t]),"groups",l)})),Object.keys(d).forEach((function(t){return p(t,e.extractPermissions(d[t]),"uuids",l)}))})),s&&(a.uuid="".concat(s)),i&&(a.meta=i),o.permissions=a,JSON.stringify(o)},enumerable:!1,configurable:!0}),r.prototype.extractPermissions=function(e){var t=0;return"join"in e&&e.join&&(t|=128),"update"in e&&e.update&&(t|=64),"get"in e&&e.get&&(t|=32),"delete"in e&&e.delete&&(t|=8),"manage"in e&&e.manage&&(t|=4),"write"in e&&e.write&&(t|=2),"read"in e&&e.read&&(t|=1),t},r.prototype.isVspPermissions=function(e){var t,n,r,i;return"authorizedUserId"in e||"spaces"in(null!==(t=e.resources)&&void 0!==t?t:{})||"users"in(null!==(n=e.resources)&&void 0!==n?n:{})||"spaces"in(null!==(r=e.patterns)&&void 0!==r?r:{})||"users"in(null!==(i=e.patterns)&&void 0!==i?i:{})},r}(ue),Qt=function(e){function r(t){var n,r,i,o,s,a,u,c,p,l,h,f,d,y,g,v,b,m,w,S,k=e.call(this)||this;return k.parameters=t,null!==(n=(h=k.parameters).channels)&&void 0!==n||(h.channels=[]),null!==(r=(f=k.parameters).channelGroups)&&void 0!==r||(f.channelGroups=[]),null!==(i=(d=k.parameters).uuids)&&void 0!==i||(d.uuids=[]),null!==(o=(y=k.parameters).read)&&void 0!==o||(y.read=false),null!==(s=(g=k.parameters).write)&&void 0!==s||(g.write=false),null!==(a=(v=k.parameters).delete)&&void 0!==a||(v.delete=false),null!==(u=(b=k.parameters).get)&&void 0!==u||(b.get=false),null!==(c=(m=k.parameters).update)&&void 0!==c||(m.update=false),null!==(p=(w=k.parameters).manage)&&void 0!==p||(w.manage=false),null!==(l=(S=k.parameters).join)&&void 0!==l||(S.join=false),k}return t(r,e),r.prototype.operation=function(){return pe.PNAccessManagerGrant},r.prototype.validate=function(){var e,t=this.parameters,n=t.keySet,r=n.subscribeKey,i=n.publishKey,o=n.secretKey,s=t.uuids,a=t.channels,u=t.channelGroups;return r?i?o?0!==(null==s?void 0:s.length)&&0===(null===(e=this.parameters.authKeys)||void 0===e?void 0:e.length)?"authKeys are required for grant request on uuids":!(null==s?void 0:s.length)||0===(null==a?void 0:a.length)&&0===(null==u?void 0:u.length)?void 0:"Both channel/channel group and uuid cannot be used in the same request":"Missing Secret Key":"Missing Publish Key":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t.payload]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){return"/v2/auth/grant/sub-key/".concat(this.parameters.keySet.subscribeKey)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channels,r=e.channelGroups,i=e.authKeys,o=e.uuids,s=e.read,a=e.write,u=e.manage,c=e.delete,p=e.get,l=e.join,h=e.update,f=e.ttl;return n(n(n(n(n(n({},t&&(null==t?void 0:t.length)>0?{channel:t.join(",")}:{}),r&&(null==r?void 0:r.length)>0?{"channel-group":r.join(",")}:{}),i&&(null==i?void 0:i.length)>0?{auth:i.join(",")}:{}),o&&(null==o?void 0:o.length)>0?{"target-uuid":o.join(",")}:{}),{r:s?"1":"0",w:a?"1":"0",m:u?"1":"0",d:c?"1":"0",g:p?"1":"0",j:l?"1":"0",u:h?"1":"0"}),f||0===f?{ttl:f}:{})},enumerable:!1,configurable:!0}),r}(ue),en=[],tn=function(e){function r(t){var n,r,i=e.call(this)||this;return i.parameters=t,null!==(n=(r=i.parameters).authKeys)&&void 0!==n||(r.authKeys=en),i}return t(r,e),r.prototype.operation=function(){return pe.PNAccessManagerAudit},r.prototype.validate=function(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t.payload]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){return"/v2/auth/audit/sub-key/".concat(this.parameters.keySet.subscribeKey)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.channel,r=e.channelGroup,i=e.authKeys;return n(n(n({},t?{channel:t}:{}),r?{"channel-group":r}:{}),i&&i.length?{auth:i.join(",")}:{})},enumerable:!1,configurable:!0}),r}(ue),nn=function(){function e(){}return e.prototype.subscribe=function(){var e,t;this.pubnub.subscribe(n({channels:this.channelNames,channelGroups:this.groupNames},(null===(t=null===(e=this.options)||void 0===e?void 0:e.cursor)||void 0===t?void 0:t.timetoken)&&{timetoken:this.options.cursor.timetoken}))},e.prototype.unsubscribe=function(){this.pubnub.unsubscribe({channels:this.channelNames.filter((function(e){return!e.endsWith("-pnpres")})),channelGroups:this.groupNames.filter((function(e){return!e.endsWith("-pnpres")}))})},Object.defineProperty(e.prototype,"onMessage",{set:function(e){this.listener.message=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPresence",{set:function(e){this.listener.presence=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSignal",{set:function(e){this.listener.signal=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onObjects",{set:function(e){this.listener.objects=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessageAction",{set:function(e){this.listener.messageAction=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onFile",{set:function(e){this.listener.file=e},enumerable:!1,configurable:!0}),e.prototype.addListener=function(e){this.eventEmitter.addListener(e,this.channelNames.filter((function(e){return!e.endsWith("-pnpres")})),this.groupNames.filter((function(e){return!e.endsWith("-pnpres")})))},e.prototype.removeListener=function(e){this.eventEmitter.removeListener(e,this.channelNames,this.groupNames)},Object.defineProperty(e.prototype,"channels",{get:function(){return this.channelNames.slice(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"channelGroups",{get:function(){return this.groupNames.slice(0)},enumerable:!1,configurable:!0}),e}(),rn=function(e){function n(t){var n=t.channels,r=void 0===n?[]:n,i=t.channelGroups,o=void 0===i?[]:i,s=t.subscriptionOptions,c=t.eventEmitter,p=t.pubnub,l=e.call(this)||this;return l.channelNames=[],l.groupNames=[],l.subscriptionList=[],l.options=s,l.eventEmitter=c,l.pubnub=p,r.forEach((function(e){var t=l.pubnub.channel(e).subscription(l.options);l.channelNames=u(u([],a(l.channelNames),!1),a(t.channels),!1),l.subscriptionList.push(t)})),o.forEach((function(e){var t=l.pubnub.channelGroup(e).subscription(l.options);l.groupNames=u(u([],a(l.groupNames),!1),a(t.channelGroups),!1),l.subscriptionList.push(t)})),l.listener={},c.addListener(l.listener,l.channelNames.filter((function(e){return!e.endsWith("-pnpres")})),l.groupNames.filter((function(e){return!e.endsWith("-pnpres")}))),l}return t(n,e),n.prototype.addSubscription=function(e){this.subscriptionList.push(e),this.channelNames=u(u([],a(this.channelNames),!1),a(e.channels),!1),this.groupNames=u(u([],a(this.groupNames),!1),a(e.channelGroups),!1)},n.prototype.removeSubscription=function(e){var t=e.channels,n=e.channelGroups;this.channelNames=this.channelNames.filter((function(e){return!t.includes(e)})),this.groupNames=this.groupNames.filter((function(e){return!n.includes(e)})),this.subscriptionList=this.subscriptionList.filter((function(t){return t!==e}))},n.prototype.addSubscriptionSet=function(e){this.subscriptionList=u(u([],a(this.subscriptionList),!1),a(e.subscriptions),!1),this.channelNames=u(u([],a(this.channelNames),!1),a(e.channels),!1),this.groupNames=u(u([],a(this.groupNames),!1),a(e.channelGroups),!1)},n.prototype.removeSubscriptionSet=function(e){var t=e.channels,n=e.channelGroups;this.channelNames=this.channelNames.filter((function(e){return!t.includes(e)})),this.groupNames=this.groupNames.filter((function(e){return!n.includes(e)})),this.subscriptionList=this.subscriptionList.filter((function(t){return!e.subscriptions.includes(t)}))},Object.defineProperty(n.prototype,"subscriptions",{get:function(){return this.subscriptionList.slice(0)},enumerable:!1,configurable:!0}),n}(nn),on=function(e){function r(t){var n=t.channels,r=t.channelGroups,i=t.subscriptionOptions,o=t.eventEmitter,s=t.pubnub,a=e.call(this)||this;return a.channelNames=[],a.groupNames=[],a.channelNames=n,a.groupNames=r,a.options=i,a.pubnub=s,a.eventEmitter=o,a.listener={},o.addListener(a.listener,a.channelNames.filter((function(e){return!e.endsWith("-pnpres")})),a.groupNames.filter((function(e){return!e.endsWith("-pnpres")}))),a}return t(r,e),r.prototype.addSubscription=function(e){return new rn({channels:u(u([],a(this.channelNames),!1),a(e.channels),!1),channelGroups:u(u([],a(this.groupNames),!1),a(e.channelGroups),!1),subscriptionOptions:n(n({},this.options),null==e?void 0:e.options),eventEmitter:this.eventEmitter,pubnub:this.pubnub})},r}(nn),sn=function(){function e(e,t,n){this.id=e,this.eventEmitter=t,this.pubnub=n}return e.prototype.subscription=function(e){return new on({channels:[this.id],channelGroups:[],subscriptionOptions:e,eventEmitter:this.eventEmitter,pubnub:this.pubnub})},e}(),an=function(){function e(e,t,n){this.eventEmitter=t,this.pubnub=n,this.name=e}return e.prototype.subscription=function(e){return new on({channels:[],channelGroups:(null==e?void 0:e.receivePresenceEvents)?[this.name,"".concat(this.name,"-pnpres")]:[this.name],subscriptionOptions:e,eventEmitter:this.eventEmitter,pubnub:this.pubnub})},e}(),un=function(){function e(e,t,n){this.id=e,this.eventEmitter=t,this.pubnub=n}return e.prototype.subscription=function(e){return new on({channels:[this.id],channelGroups:[],subscriptionOptions:e,eventEmitter:this.eventEmitter,pubnub:this.pubnub})},e}(),cn=function(){function e(e,t,n){this.eventEmitter=t,this.pubnub=n,this.name=e}return e.prototype.subscription=function(e){return new on({channels:(null==e?void 0:e.receivePresenceEvents)?[this.name,"".concat(this.name,"-pnpres")]:[this.name],channelGroups:[],subscriptionOptions:e,eventEmitter:this.eventEmitter,pubnub:this.pubnub})},e}(),pn=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNRemoveChannelsFromGroupOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroup;return t?r?n?void 0:"Missing channels":"Missing Channel Group":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channelGroup;return"/v1/channel-registration/sub-key/".concat(t,"/channel-group/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){return{remove:this.parameters.channels.join(",")}},enumerable:!1,configurable:!0}),n}(ue),ln=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNAddChannelsToGroupOperation},n.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channels,r=e.channelGroup;return t?r?n?void 0:"Missing channels":"Missing Channel Group":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channelGroup;return"/v1/channel-registration/sub-key/".concat(t,"/channel-group/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){return{add:this.parameters.channels.join(",")}},enumerable:!1,configurable:!0}),n}(ue),hn=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNChannelsForGroupOperation},n.prototype.validate=function(){return this.parameters.keySet.subscribeKey?this.parameters.channelGroup?void 0:"Missing Channel Group":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{channels:t.payload.channels}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channelGroup;return"/v1/channel-registration/sub-key/".concat(t,"/channel-group/").concat(H(n))},enumerable:!1,configurable:!0}),n}(ue),fn=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNRemoveGroupOperation},n.prototype.validate=function(){return this.parameters.keySet.subscribeKey?this.parameters.channelGroup?void 0:"Missing Channel Group":"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channelGroup;return"/v1/channel-registration/sub-key/".concat(t,"/channel-group/").concat(H(n),"/remove")},enumerable:!1,configurable:!0}),n}(ue),dn=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNChannelGroupsOperation},n.prototype.validate=function(){if(!this.parameters.keySet.subscribeKey)return"Missing Subscribe Key"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{groups:t.payload.groups}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){return"/v1/channel-registration/sub-key/".concat(this.parameters.keySet.subscribeKey,"/channel-group")},enumerable:!1,configurable:!0}),n}(ue),yn=function(){function e(e,t){this.keySet=e,this.sendRequest=t}return e.prototype.listChannels=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new hn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.listGroups=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=new dn({keySet:this.keySet}),e?[2,this.sendRequest(t,e)]:[2,this.sendRequest(t)]}))}))},e.prototype.addChannels=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new ln(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeChannels=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new pn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.deleteGroup=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new fn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e}(),gn=function(e){function r(t){var n,r,i=e.call(this)||this;return i.parameters=t,"apns2"===i.parameters.pushGateway&&(null!==(n=(r=i.parameters).environment)&&void 0!==n||(r.environment="development")),i.parameters.count&&i.parameters.count>1e3&&(i.parameters.count=1e3),i}return t(r,e),r.prototype.operation=function(){throw Error("Should be implemented in subclass.")},r.prototype.validate=function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.action,r=e.device,i=e.pushGateway;return t?r?"add"!==n&&"remove"!==n||"channels"in this.parameters&&0!==this.parameters.channels.length?i?"apns2"!==this.parameters.pushGateway||this.parameters.topic?void 0:"Missing APNS2 topic":"Missing GW Type (pushGateway: gcm or apns2)":"Missing Channels":"Missing Device ID (device)":"Missing Subscribe Key"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(e){throw Error("Should be implemented in subclass.")}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.action,r=e.device,i="apns2"===e.pushGateway?"/v2/push/sub-key/".concat(t,"/devices-apns2/").concat(r):"/v1/push/sub-key/".concat(t,"/devices/").concat(r);return"remove-device"===n&&(i="".concat(i,"/remove")),i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.start,r=e.count,i=n(n({type:this.parameters.pushGateway},t?{start:t}:{}),r&&r>0?{count:r}:{});if("channels"in this.parameters&&(i[this.parameters.action]=this.parameters.channels.join(",")),"apns2"===this.parameters.pushGateway){var o=this.parameters,s=o.environment,a=o.topic;i=n(n({},i),{environment:s,topic:a})}return i},enumerable:!1,configurable:!0}),r}(ue),vn=function(e){function r(t){return e.call(this,n(n({},t),{action:"remove"}))||this}return t(r,e),r.prototype.operation=function(){return pe.PNRemovePushNotificationEnabledChannelsOperation},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},r}(gn),bn=function(e){function r(t){return e.call(this,n(n({},t),{action:"list"}))||this}return t(r,e),r.prototype.operation=function(){return pe.PNPushNotificationEnabledChannelsOperation},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{channels:t}]}))}))},r}(gn),mn=function(e){function r(t){return e.call(this,n(n({},t),{action:"add"}))||this}return t(r,e),r.prototype.operation=function(){return pe.PNAddPushNotificationEnabledChannelsOperation},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},r}(gn),wn=function(e){function r(t){return e.call(this,n(n({},t),{action:"remove-device"}))||this}return t(r,e),r.prototype.operation=function(){return pe.PNRemoveAllPushNotificationsOperation},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){if(!this.deserializeResponse(e))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{}]}))}))},r}(gn),Sn=function(){function e(e,t){this.keySet=e,this.sendRequest=t}return e.prototype.listChannels=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new bn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.addChannels=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new mn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeChannels=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new vn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.deleteDevice=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new wn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e}(),kn=function(e){function r(t){var n,r,i,o,s,a,u=e.call(this)||this;return u.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(s=t.include).customFields)&&void 0!==r||(s.customFields=false),null!==(i=(a=t.include).totalCount)&&void 0!==i||(a.totalCount=false),null!==(o=t.limit)&&void 0!==o||(t.limit=100),u}return t(r,e),r.prototype.operation=function(){return pe.PNGetAllChannelMetadataOperation},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){return"/v2/objects/".concat(this.parameters.keySet.subscribeKey,"/channels")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.include,r=e.page,i=e.filter,o=e.sort,s=e.limit,c=Object.entries(null!=o?o:{}).map((function(e){var t=a(e,2),n=t[0],r=t[1];return null!==r?"".concat(n,":").concat(r):n}));return n(n(n(n(n({include:u(["status","type"],a(t.customFields?["custom"]:[]),!1).join(","),count:"".concat(t.totalCount)},i?{filter:i}:{}),(null==r?void 0:r.next)?{start:r.next}:{}),(null==r?void 0:r.prev)?{end:r.prev}:{}),s?{limit:s}:{}),c.length?{sort:c}:{})},enumerable:!1,configurable:!0}),r}(ue),Pn=function(e){function n(t){var n=e.call(this,{method:D.DELETE})||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNRemoveChannelMetadataOperation},n.prototype.validate=function(){if(!this.parameters.channel)return"Channel cannot be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v2/objects/".concat(t,"/channels/").concat(H(n))},enumerable:!1,configurable:!0}),n}(ue),En=function(e){function r(t){var n,r,i,o,s,a,u,c,p,l,h,f,d,y,g,v,b=e.call(this)||this;return b.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(l=t.include).customFields)&&void 0!==r||(l.customFields=false),null!==(i=(h=t.include).totalCount)&&void 0!==i||(h.totalCount=false),null!==(o=(f=t.include).statusField)&&void 0!==o||(f.statusField=false),null!==(s=(d=t.include).channelFields)&&void 0!==s||(d.channelFields=false),null!==(a=(y=t.include).customChannelFields)&&void 0!==a||(y.customChannelFields=false),null!==(u=(g=t.include).channelStatusField)&&void 0!==u||(g.channelStatusField=false),null!==(c=(v=t.include).channelTypeField)&&void 0!==c||(v.channelTypeField=false),null!==(p=t.limit)&&void 0!==p||(t.limit=100),b.parameters.userId&&(b.parameters.uuid=b.parameters.userId),b}return t(r,e),r.prototype.operation=function(){return pe.PNGetMembershipsOperation},r.prototype.validate=function(){if(!this.parameters.uuid)return"'uuid' cannot be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid;return"/v2/objects/".concat(t,"/uuids/").concat(H(n),"/channels")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.include,r=e.page,i=e.filter,o=e.sort,s=e.limit,u=Object.entries(null!=o?o:{}).map((function(e){var t=a(e,2),n=t[0],r=t[1];return null!==r?"".concat(n,":").concat(r):n})),c=[];return t.statusField&&c.push("status"),t.customFields&&c.push("custom"),t.channelFields&&c.push("channel"),t.channelStatusField&&c.push("channel.status"),t.channelTypeField&&c.push("channel.type"),t.customChannelFields&&c.push("channel.custom"),n(n(n(n(n(n({count:"".concat(t.totalCount)},c.length>0?{include:c.join(",")}:{}),i?{filter:i}:{}),(null==r?void 0:r.next)?{start:r.next}:{}),(null==r?void 0:r.prev)?{end:r.prev}:{}),s?{limit:s}:{}),u.length?{sort:u}:{})},enumerable:!1,configurable:!0}),r}(ue),On=function(e){function r(t){var n,r,i,o,s,a,u,c,p,l,h=e.call(this,{method:D.PATCH})||this;return h.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(u=t.include).customFields)&&void 0!==r||(u.customFields=false),null!==(i=(c=t.include).totalCount)&&void 0!==i||(c.totalCount=false),null!==(o=(p=t.include).channelFields)&&void 0!==o||(p.channelFields=false),null!==(s=(l=t.include).customChannelFields)&&void 0!==s||(l.customChannelFields=false),null!==(a=t.limit)&&void 0!==a||(t.limit=100),h.parameters.userId&&(h.parameters.uuid=h.parameters.userId),h}return t(r,e),r.prototype.operation=function(){return pe.PNSetMembershipsOperation},r.prototype.validate=function(){var e=this.parameters,t=e.uuid,n=e.channels;return t?n&&0!==n.length?void 0:"Channels cannot be empty":"'uuid' cannot be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid;return"/v2/objects/".concat(t,"/uuids/").concat(H(n),"/channels")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.include,r=e.page,i=e.filter,o=e.sort,s=e.limit,u=Object.entries(null!=o?o:{}).map((function(e){var t=a(e,2),n=t[0],r=t[1];return null!==r?"".concat(n,":").concat(r):n})),c=["channel.status","channel.type","status"];return t.customFields&&c.push("custom"),t.channelFields&&c.push("channel"),t.customChannelFields&&c.push("channel.custom"),n(n(n(n(n(n({count:"".concat(t.totalCount)},c.length>0?{include:c.join(",")}:{}),i?{filter:i}:{}),(null==r?void 0:r.next)?{start:r.next}:{}),(null==r?void 0:r.prev)?{end:r.prev}:{}),s?{limit:s}:{}),u.length?{sort:u}:{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){var e,t=this.parameters,n=t.channels,r=t.type;return JSON.stringify(((e={})["".concat(r)]=n.map((function(e){return"string"==typeof e?{channel:{id:e}}:{channel:{id:e.id},status:e.status,custom:e.custom}})),e))},enumerable:!1,configurable:!0}),r}(ue),Cn=function(e){function r(t){var n,r,i,o,s,a,u=e.call(this)||this;return u.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(s=t.include).customFields)&&void 0!==r||(s.customFields=false),null!==(i=(a=t.include).totalCount)&&void 0!==i||(a.totalCount=false),null!==(o=t.limit)&&void 0!==o||(t.limit=100),u}return t(r,e),r.prototype.operation=function(){return pe.PNGetAllUUIDMetadataOperation},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){return"/v2/objects/".concat(this.parameters.keySet.subscribeKey,"/uuids")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.include,r=e.page,i=e.filter,o=e.sort,s=e.limit,c=Object.entries(null!=o?o:{}).map((function(e){var t=a(e,2),n=t[0],r=t[1];return null!==r?"".concat(n,":").concat(r):n}));return n(n(n(n(n({include:u(["status","type"],a(t.customFields?["custom"]:[]),!1).join(","),count:"".concat(t.totalCount)},i?{filter:i}:{}),(null==r?void 0:r.next)?{start:r.next}:{}),(null==r?void 0:r.prev)?{end:r.prev}:{}),s?{limit:s}:{}),c.length?{sort:c}:{})},enumerable:!1,configurable:!0}),r}(ue),_n=function(e){function n(t){var n,r,i,o=e.call(this)||this;return o.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(i=t.include).customFields)&&void 0!==r||(i.customFields=true),o}return t(n,e),n.prototype.operation=function(){return pe.PNGetChannelMetadataOperation},n.prototype.validate=function(){if(!this.parameters.channel)return"Channel cannot be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v2/objects/".concat(t,"/channels/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){return{include:u(["status","type"],a(this.parameters.include.customFields?["custom"]:[]),!1).join(",")}},enumerable:!1,configurable:!0}),n}(ue),Nn=function(e){function n(t){var n,r,i,o=e.call(this,{method:D.PATCH})||this;return o.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(i=t.include).customFields)&&void 0!==r||(i.customFields=true),o}return t(n,e),n.prototype.operation=function(){return pe.PNSetChannelMetadataOperation},n.prototype.validate=function(){return this.parameters.channel?this.parameters.data?void 0:"Data cannot be empty":"Channel cannot be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v2/objects/".concat(t,"/channels/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){return{include:u(["status","type"],a(this.parameters.include.customFields?["custom"]:[]),!1).join(",")}},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"body",{get:function(){return JSON.stringify(this.parameters.data)},enumerable:!1,configurable:!0}),n}(ue),Mn=function(e){function n(t){var n=e.call(this,{method:D.DELETE})||this;return n.parameters=t,n.parameters.userId&&(n.parameters.uuid=n.parameters.userId),n}return t(n,e),n.prototype.operation=function(){return pe.PNRemoveUUIDMetadataOperation},n.prototype.validate=function(){if(!this.parameters.uuid)return"'uuid' cannot be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid;return"/v2/objects/".concat(t,"/uuids/").concat(H(n))},enumerable:!1,configurable:!0}),n}(ue),An=function(e){function r(t){var n,r,i,o,s,a,u,c,p,l,h,f,d,y,g,v,b=e.call(this)||this;return b.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(l=t.include).customFields)&&void 0!==r||(l.customFields=false),null!==(i=(h=t.include).totalCount)&&void 0!==i||(h.totalCount=false),null!==(o=(f=t.include).statusField)&&void 0!==o||(f.statusField=false),null!==(s=(d=t.include).UUIDFields)&&void 0!==s||(d.UUIDFields=false),null!==(a=(y=t.include).customUUIDFields)&&void 0!==a||(y.customUUIDFields=false),null!==(u=(g=t.include).UUIDStatusField)&&void 0!==u||(g.UUIDStatusField=false),null!==(c=(v=t.include).UUIDTypeField)&&void 0!==c||(v.UUIDTypeField=false),null!==(p=t.limit)&&void 0!==p||(t.limit=100),b}return t(r,e),r.prototype.operation=function(){return pe.PNSetMembersOperation},r.prototype.validate=function(){if(!this.parameters.channel)return"Channel cannot be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v2/objects/".concat(t,"/channels/").concat(H(n),"/uuids")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.include,r=e.page,i=e.filter,o=e.sort,s=e.limit,u=Object.entries(null!=o?o:{}).map((function(e){var t=a(e,2),n=t[0],r=t[1];return null!==r?"".concat(n,":").concat(r):n})),c=[];return t.statusField&&c.push("status"),t.customFields&&c.push("custom"),t.UUIDFields&&c.push("uuid"),t.UUIDStatusField&&c.push("uuid.status"),t.UUIDTypeField&&c.push("uuid.type"),t.customUUIDFields&&c.push("uuid.custom"),n(n(n(n(n(n({count:"".concat(t.totalCount)},c.length>0?{include:c.join(",")}:{}),i?{filter:i}:{}),(null==r?void 0:r.next)?{start:r.next}:{}),(null==r?void 0:r.prev)?{end:r.prev}:{}),s?{limit:s}:{}),u.length?{sort:u}:{})},enumerable:!1,configurable:!0}),r}(ue),Rn=function(e){function r(t){var n,r,i,o,s,a,u,c,p,l,h=e.call(this,{method:D.PATCH})||this;return h.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(u=t.include).customFields)&&void 0!==r||(u.customFields=false),null!==(i=(c=t.include).totalCount)&&void 0!==i||(c.totalCount=false),null!==(o=(p=t.include).UUIDFields)&&void 0!==o||(p.UUIDFields=false),null!==(s=(l=t.include).customUUIDFields)&&void 0!==s||(l.customUUIDFields=false),null!==(a=t.limit)&&void 0!==a||(t.limit=100),h}return t(r,e),r.prototype.operation=function(){return pe.PNSetMembersOperation},r.prototype.validate=function(){var e=this.parameters,t=e.channel,n=e.uuids;return t?n&&0!==n.length?void 0:"UUIDs cannot be empty":"Channel cannot be empty"},r.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(r.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel;return"/v2/objects/".concat(t,"/channels/").concat(H(n),"/uuids")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.include,r=e.page,i=e.filter,o=e.sort,s=e.limit,u=Object.entries(null!=o?o:{}).map((function(e){var t=a(e,2),n=t[0],r=t[1];return null!==r?"".concat(n,":").concat(r):n})),c=["uuid.status","uuid.type","type"];return t.customFields&&c.push("custom"),t.UUIDFields&&c.push("uuid"),t.customUUIDFields&&c.push("uuid.custom"),n(n(n(n(n(n({count:"".concat(t.totalCount)},c.length>0?{include:c.join(",")}:{}),i?{filter:i}:{}),(null==r?void 0:r.next)?{start:r.next}:{}),(null==r?void 0:r.prev)?{end:r.prev}:{}),s?{limit:s}:{}),u.length?{sort:u}:{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"body",{get:function(){var e,t=this.parameters,n=t.uuids,r=t.type;return JSON.stringify(((e={})["".concat(r)]=n.map((function(e){return"string"==typeof e?{uuid:{id:e}}:{uuid:{id:e.id},status:e.status,custom:e.custom}})),e))},enumerable:!1,configurable:!0}),r}(ue),jn=function(e){function n(t){var n,r,i,o=e.call(this)||this;return o.parameters=t,null!==(n=t.include)&&void 0!==n||(t.include={}),null!==(r=(i=t.include).customFields)&&void 0!==r||(i.customFields=true),o.parameters.userId&&(o.parameters.uuid=o.parameters.userId),o}return t(n,e),n.prototype.operation=function(){return pe.PNGetUUIDMetadataOperation},n.prototype.validate=function(){if(!this.parameters.uuid)return"'uuid' cannot be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,t]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.uuid;return"/v2/objects/".concat(t,"/uuids/").concat(H(n))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"queryParameters",{get:function(){var e=this.parameters,t=e.uuid;return e.include,{uuid:t,include:u(["status","type"],a(this.parameters.include.customFields?["custom"]:[]),!1).join(",")}},enumerable:!1,configurable:!0}),n}(ue),In=function(){function e(e,t){this.configuration=e,this.sendRequest=t,this.keySet=e.keySet}return e.prototype.getAllUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._getAllUUIDMetadata(e,t)]}))}))},e.prototype._getAllUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return null!=t||(t="function"==typeof e?e:void 0),r=new Cn(n(n({},e&&"function"!=typeof e?e:{}),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.getUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._getUUIDMetadata(e,t)]}))}))},e.prototype._getUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s;return o(this,(function(o){return null!=t||(t="function"==typeof e?e:void 0),(r=e&&"function"!=typeof e?e:{}).userId&&(r.uuid=r.userId),null!==(s=r.uuid)&&void 0!==s||(r.uuid=this.configuration.userId),i=new jn(n(n({},r),{keySet:this.keySet})),t?[2,this.sendRequest(i,t)]:[2,this.sendRequest(i)]}))}))},e.prototype.setUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._setUUIDMetadata(e,t)]}))}))},e.prototype._setUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){return e.userId&&(e.uuid=e.userId),null!==(i=e.uuid)&&void 0!==i||(e.uuid=this.configuration.userId),r=new jn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._removeUUIDMetadata(e,t)]}))}))},e.prototype._removeUUIDMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s;return o(this,(function(o){return null!=t||(t="function"==typeof e?e:void 0),(r=e&&"function"!=typeof e?e:{}).userId&&(r.uuid=r.userId),null!==(s=r.uuid)&&void 0!==s||(r.uuid=this.configuration.userId),i=new Mn(n(n({},r),{keySet:this.keySet})),t?[2,this.sendRequest(i,t)]:[2,this.sendRequest(i)]}))}))},e.prototype.getAllChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._getAllChannelMetadata(e,t)]}))}))},e.prototype._getAllChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return null!=t||(t="function"==typeof e?e:void 0),r=new kn(n(n({},e&&"function"!=typeof e?e:{}),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.getChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._getChannelMetadata(e,t)]}))}))},e.prototype._getChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new _n(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.setChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._setChannelMetadata(e,t)]}))}))},e.prototype._setChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Nn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this._removeChannelMetadata(e,t)]}))}))},e.prototype._removeChannelMetadata=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Pn(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.getChannelMembers=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new An(n(n({},e),{keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.setChannelMembers=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Rn(n(n({},e),{type:"set",keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeChannelMembers=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Rn(n(n({},e),{type:"delete",keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.getMemberships=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s;return o(this,(function(o){return null!=t||(t="function"==typeof e?e:void 0),(r=e&&"function"!=typeof e?e:{}).userId&&(r.uuid=r.userId),null!==(s=r.uuid)&&void 0!==s||(r.uuid=this.configuration.userId),i=new En(n(n({},r),{keySet:this.keySet})),t?[2,this.sendRequest(i,t)]:[2,this.sendRequest(i)]}))}))},e.prototype.setMemberships=function(e,t){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){return e.userId&&(e.uuid=e.userId),null!==(i=e.uuid)&&void 0!==i||(e.uuid=this.configuration.userId),r=new On(n(n({},e),{type:"set",keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeMemberships=function(e,t){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){return e.userId&&(e.uuid=e.userId),null!==(i=e.uuid)&&void 0!==i||(e.uuid=this.configuration.userId),r=new On(n(n({},e),{type:"delete",keySet:this.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.fetchMemberships=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s,u,c,p,l,h;return o(this,(function(o){return"spaceId"in e?(i={channel:null!==(l=(r=e).spaceId)&&void 0!==l?l:r.channel,filter:r.filter,limit:r.limit,page:r.page,include:n({},r.include),sort:r.sort?Object.fromEntries(Object.entries(r.sort).map((function(e){var t=a(e,2),n=t[0],r=t[1];return[n.replace("user","uuid"),r]}))):void 0},s=function(e){return{status:e.status,data:e.data.map((function(e){return{user:e.uuid,custom:e.custom,updated:e.updated,eTag:e.eTag}})),totalCount:e.totalCount,next:e.next,prev:e.prev}},t?[2,this.getChannelMembers(i,(function(e,n){t(e,n?s(n):n)}))]:[2,this.getChannelMembers(i).then(s)]):(c={uuid:null!==(h=(u=e).userId)&&void 0!==h?h:u.uuid,filter:u.filter,limit:u.limit,page:u.page,include:n({},u.include),sort:u.sort?Object.fromEntries(Object.entries(u.sort).map((function(e){var t=a(e,2),n=t[0],r=t[1];return[n.replace("space","channel"),r]}))):void 0},p=function(e){return{status:e.status,data:e.data.map((function(e){return{space:e.channel,custom:e.custom,updated:e.updated,eTag:e.eTag}})),totalCount:e.totalCount,next:e.next,prev:e.prev}},t?[2,this.getMemberships(c,(function(e,n){t(e,n?p(n):n)}))]:[2,this.getMemberships(c).then(p)])}))}))},e.prototype.addMemberships=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c,p,l,h;return o(this,(function(o){return"spaceId"in e?(r={channel:null!==(a=(n=e).spaceId)&&void 0!==a?a:n.channel,uuids:null!==(c=null===(u=n.users)||void 0===u?void 0:u.map((function(e){return"string"==typeof e?e:(e.userId,{id:e.userId,custom:e.custom})})))&&void 0!==c?c:n.uuids,limit:0},t?[2,this.setChannelMembers(r,t)]:[2,this.setChannelMembers(r)]):(s={uuid:null!==(p=(i=e).userId)&&void 0!==p?p:i.uuid,channels:null!==(h=null===(l=i.spaces)||void 0===l?void 0:l.map((function(e){return"string"==typeof e?e:{id:e.spaceId,custom:e.custom}})))&&void 0!==h?h:i.channels,limit:0},t?[2,this.setMemberships(s,t)]:[2,this.setMemberships(s)])}))}))},e}(),Tn=function(e){function n(){return e.call(this)||this}return t(n,e),n.prototype.operation=function(){return pe.PNTimeOperation},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){if(!(t=this.deserializeResponse(e)))throw new v("Service response error, check status for details",b("Unable to deserialize service response"));return[2,{timetoken:t[0]}]}))}))},Object.defineProperty(n.prototype,"path",{get:function(){return"/time/0"},enumerable:!1,configurable:!0}),n}(ue),Un=function(e){function n(t){var n=e.call(this)||this;return n.parameters=t,n}return t(n,e),n.prototype.operation=function(){return pe.PNDownloadFileOperation},n.prototype.validate=function(){var e=this.parameters,t=e.channel,n=e.id,r=e.name;return t?n?r?void 0:"file name can't be empty":"file id can't be empty":"channel can't be empty"},n.prototype.parse=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a,u,c,p;return o(this,(function(o){switch(o.label){case 0:return t=this.parameters,n=t.cipherKey,r=t.crypto,i=t.cryptography,s=t.name,a=t.PubNubFile,u=e.headers["content-type"],p=e.body,a.supportsEncryptFile&&(n||r)?n&&i?[4,i.decrypt(n,p)]:[3,2]:[3,4];case 1:return p=o.sent(),[3,4];case 2:return n||!r?[3,4]:[4,r.decryptFile(a.create({data:p,name:s,mimeType:u}),a)];case 3:c=o.sent(),o.label=4;case 4:return[2,c||a.create({data:p,name:s,mimeType:u})]}}))}))},Object.defineProperty(n.prototype,"path",{get:function(){var e=this.parameters,t=e.keySet.subscribeKey,n=e.channel,r=e.id,i=e.name;return"/v1/files/".concat(t,"/channels/").concat(H(n),"/files/").concat(r,"/").concat(i)},enumerable:!1,configurable:!0}),n}(ue),Fn=function(){function e(e){var t,n,r,i=this;if(this._configuration=e.configuration,this.cryptography=e.cryptography,this.tokenManager=e.tokenManager,this.transport=e.transport,this.crypto=e.crypto,this._objects=new In(this._configuration,this.sendRequest),this._channelGroups=new yn(this._configuration.keySet,this.sendRequest),this._push=new Sn(this._configuration.keySet,this.sendRequest),this.listenerManager=new Q,this.eventEmitter=new fe(this.listenerManager),this._configuration.enableEventEngine){var o=this._configuration.getHeartbeatInterval();this.presenceState={},o&&(this.presenceEventEngine=new Ve({heartbeat:this.heartbeat,leave:this.unsubscribe,heartbeatDelay:function(){return new Promise((function(e,t){(o=i._configuration.getHeartbeatInterval())?setTimeout(e,1e3*o):t(new v("Heartbeat interval has been reset."))}))},retryDelay:function(e){return new Promise((function(t){return setTimeout(t,e)}))},emitStatus:function(e){return i.listenerManager.announceStatus(e)},config:this._configuration,presenceState:this.presenceState})),this.eventEngine=new Ct({handshake:this.subscribeHandshake,receiveMessages:this.subscribeReceiveMessages,delay:function(e){return new Promise((function(t){return setTimeout(t,e)}))},join:null===(t=this.presenceEventEngine)||void 0===t?void 0:t.join,leave:null===(n=this.presenceEventEngine)||void 0===n?void 0:n.leave,leaveAll:null===(r=this.presenceEventEngine)||void 0===r?void 0:r.leaveAll,presenceState:this.presenceState,config:this._configuration,emitMessages:function(e){return e.forEach((function(e){return i.eventEmitter.emitEvent(e)}))},emitStatus:function(e){return i.listenerManager.announceStatus(e)}})}else this.subscriptionManager=new ne(this._configuration,this.listenerManager,this.eventEmitter,this.makeSubscribe,this.heartbeat,this.makeUnsubscribe,this.time)}return e.notificationPayload=function(e,t){return new ae(e,t)},e.generateUUID=function(){return K()},Object.defineProperty(e.prototype,"configuration",{get:function(){return this._configuration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_config",{get:function(){return this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authKey",{get:function(){var e;return null!==(e=this._configuration.authKey)&&void 0!==e?e:void 0},enumerable:!1,configurable:!0}),e.prototype.getAuthKey=function(){return this.authKey},e.prototype.setAuthKey=function(e){this._configuration.setAuthKey(e)},Object.defineProperty(e.prototype,"userId",{get:function(){return this._configuration.userId},set:function(e){this._configuration.userId=e},enumerable:!1,configurable:!0}),e.prototype.getUserId=function(){return this._configuration.userId},e.prototype.setUserId=function(e){this._configuration.userId=e},Object.defineProperty(e.prototype,"filterExpression",{get:function(){var e;return null!==(e=this._configuration.getFilterExpression())&&void 0!==e?e:void 0},set:function(e){this._configuration.setFilterExpression(e)},enumerable:!1,configurable:!0}),e.prototype.getFilterExpression=function(){return this.filterExpression},e.prototype.setFilterExpression=function(e){this.filterExpression=e},Object.defineProperty(e.prototype,"cipherKey",{get:function(){return this._configuration.cipherKey},set:function(e){this._configuration.setCipherKey(e)},enumerable:!1,configurable:!0}),e.prototype.setCipherKey=function(e){this.cipherKey=e},Object.defineProperty(e.prototype,"heartbeatInterval",{set:function(e){this._configuration.setHeartbeatInterval(e)},enumerable:!1,configurable:!0}),e.prototype.setHeartbeatInterval=function(e){this.heartbeatInterval=e},e.prototype.getVersion=function(){return this._configuration.version},e.prototype._addPnsdkSuffix=function(e,t){this._configuration._addPnsdkSuffix(e,t)},e.prototype.getUUID=function(){return this.userId},e.prototype.setUUID=function(e){this.userId=e},Object.defineProperty(e.prototype,"customEncrypt",{get:function(){return this._configuration.customEncrypt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customDecrypt",{get:function(){return this._configuration.customDecrypt},enumerable:!1,configurable:!0}),e.prototype.channel=function(e){return new cn(e,this.eventEmitter,this)},e.prototype.channelGroup=function(e){return new an(e,this.eventEmitter,this)},e.prototype.channelMetadata=function(e){return new sn(e,this.eventEmitter,this)},e.prototype.userMetadata=function(e){return new un(e,this.eventEmitter,this)},e.prototype.subscriptionSet=function(e){return new rn(n(n({},e),{eventEmitter:this.eventEmitter,pubnub:this}))},e.prototype.sendRequest=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,u,c;return o(this,(function(o){if(n=e.validate()){if(t)return[2,t(b(n),null)];throw new v("Validation failed, check status for details",b(n))}return(r=e.request()).body&&"object"==typeof r.body&&"toArrayBuffer"in r.body?r.timeout=300:e.operation()===pe.PNSubscribeOperation?r.timeout=this._configuration.getSubscribeTimeout():r.timeout=this._configuration.getTransactionTimeout(),i={error:!1,operation:e.operation(),statusCode:0},s=a(this.transport.makeSendable(r),2),u=s[0],c=s[1],e.cancellationController=c||null,[2,u.then((function(t){return i.statusCode=t.status,e.parse(t)})).then((function(e){return t?t(i,e):e})).catch((function(e){console.log("~~~~~~~> WHAT HERE?:",e),e instanceof v&&(console.log("~~~~~~> OH, WE ARE REGULAR PUBNUB ERROR"),console.log("~~~~~~~~> WHAT IN STATUS?: ",e.status));var n={error:!0};throw t&&t(n,null),new v("REST API request processing error, check status for details",n)}))]}))}))},e.prototype.destroy=function(e){this.subscriptionManager?(this.subscriptionManager.unsubscribeAll(e),this.subscriptionManager.disconnect()):this.eventEngine&&this.eventEngine.dispose()},e.prototype.addListener=function(e){this.listenerManager.addListener(e)},e.prototype.removeListener=function(e){this.listenerManager.removeListener(e)},e.prototype.removeAllListeners=function(){this.listenerManager.removeAllListeners()},e.prototype.publish=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new _t(n(n({},e),{keySet:this._configuration.keySet,crypto:this._configuration.cryptoModule})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.signal=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Nt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.fire=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(r){return null!=t||(t=function(){}),[2,this.publish(n(n({},e),{replicate:!1,storeInHistory:!1}),t)]}))}))},e.prototype.getSubscribedChannels=function(){return this.subscriptionManager?this.subscriptionManager.subscribedChannels:this.eventEngine?this.eventEngine.getSubscribedChannels():[]},e.prototype.getSubscribedChannelGroups=function(){return this.subscriptionManager?this.subscriptionManager.subscribedChannelGroups:this.eventEngine?this.eventEngine.getSubscribedChannelGroups():[]},e.prototype.subscribe=function(e){this.subscriptionManager?this.subscriptionManager.subscribe(e):this.eventEngine&&this.eventEngine.subscribe(e)},e.prototype.makeSubscribe=function(e,t){var r=this,i=new he(n(n({},e),{keySet:this._configuration.keySet,getFileUrl:this.getFileUrl}));this.sendRequest(i,(function(e,n){r.subscriptionManager&&r.subscriptionManager.abort===i.abort&&(r.subscriptionManager.abort=null),t(e,n)})),this.subscriptionManager&&(this.subscriptionManager.abort=i.abort)},e.prototype.unsubscribe=function(e){this.subscriptionManager?this.subscriptionManager.unsubscribe(e):this.eventEngine&&this.eventEngine.unsubscribe(e)},e.prototype.makeUnsubscribe=function(e,t){this.sendRequest(new Tt(n(n({},e),{keySet:this._configuration.keySet})),t)},e.prototype.unsubscribeAll=function(){this.subscriptionManager?this.subscriptionManager.unsubscribeAll():this.eventEngine&&this.eventEngine.unsubscribeAll()},e.prototype.disconnect=function(){this.subscriptionManager?this.subscriptionManager.disconnect():this.eventEngine&&this.eventEngine.disconnect()},e.prototype.reconnect=function(e){this.subscriptionManager?this.subscriptionManager.reconnect():this.eventEngine&&this.eventEngine.reconnect(null!=e?e:{})},e.prototype.subscribeHandshake=function(e){return i(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){return t=new At(n(n({},e),{keySet:this._configuration.keySet,crypto:this._configuration.cryptoModule,getFileUrl:this.getFileUrl})),r=e.abortSignal.subscribe(t.abort),[2,this.sendRequest(t).then((function(e){return r(),e.cursor}))]}))}))},e.prototype.subscribeReceiveMessages=function(e){return i(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){return t=new Mt(n(n({},e),{keySet:this._configuration.keySet,crypto:this._configuration.cryptoModule,getFileUrl:this.getFileUrl})),r=e.abortSignal.subscribe(t.abort),[2,this.sendRequest(t).then((function(e){return r(),e}))]}))}))},e.prototype.getMessageActions=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new qt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.addMessageAction=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Lt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.removeMessageAction=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Bt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.fetchMessages=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Gt(n(n({},e),{keySet:this._configuration.keySet,crypto:this._configuration.cryptoModule,getFileUrl:this.getFileUrl})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.deleteMessages=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Dt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.messageCounts=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new xt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.history=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Kt(n(n({},e),{keySet:this._configuration.keySet,crypto:this._configuration.cryptoModule})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.hereNow=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Ft(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.whereNow=function(e,t){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){return n=new Ut({uuid:null!==(r=e.uuid)&&void 0!==r?r:this._configuration.userId,keySet:this._configuration.keySet}),t?[2,this.sendRequest(n,t)]:[2,this.sendRequest(n)]}))}))},e.prototype.getState=function(e,t){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){return r=new Rt(n(n({},e),{uuid:null!==(i=e.uuid)&&void 0!==i?i:this._configuration.userId,keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.setState=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s,a,u,c,p,l;return o(this,(function(o){return r=this._configuration,i=r.keySet,s=r.userId,a=this._configuration.getPresenceTimeout(),this._configuration.enableEventEngine&&this.presenceState&&(c=this.presenceState,null===(p=e.channels)||void 0===p||p.forEach((function(t){return c[t]=e.state})),"channelGroups"in e&&(null===(l=e.channelGroups)||void 0===l||l.forEach((function(t){return c[t]=e.state})))),u="withHeartbeat"in e?new It(n(n({},e),{keySet:i,heartbeat:a})):new jt(n(n({},e),{keySet:i,uuid:s})),this.subscriptionManager&&this.subscriptionManager.setState(e),t?[2,this.sendRequest(u,t)]:[2,this.sendRequest(u)]}))}))},e.prototype.presence=function(e){var t;null===(t=this.subscriptionManager)||void 0===t||t.changePresence(e)},e.prototype.heartbeat=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){return this.subscriptionManager?(t=new It(n(n({},e),{keySet:this._configuration.keySet})),[2,this.sendRequest(t)]):[2]}))}))},e.prototype.grantToken=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Zt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.revokeToken=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new $t(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},Object.defineProperty(e.prototype,"token",{get:function(){return this.tokenManager.getToken()},set:function(e){this.tokenManager.setToken(e)},enumerable:!1,configurable:!0}),e.prototype.getToken=function(){return this.token},e.prototype.setToken=function(e){this.token=e},e.prototype.parseToken=function(e){return this.tokenManager.parseToken(e)},e.prototype.grant=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Qt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.audit=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new tn(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},Object.defineProperty(e.prototype,"objects",{get:function(){return this._objects},enumerable:!1,configurable:!0}),e.prototype.fetchUsers=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._getAllUUIDMetadata(e,t)]}))}))},e.prototype.fetchUser=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._getUUIDMetadata(e,t)]}))}))},e.prototype.createUser=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._setUUIDMetadata(e,t)]}))}))},e.prototype.updateUser=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._setUUIDMetadata(e,t)]}))}))},e.prototype.removeUser=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._removeUUIDMetadata(e,t)]}))}))},e.prototype.fetchSpaces=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._getAllChannelMetadata(e,t)]}))}))},e.prototype.fetchSpace=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._getChannelMetadata(e,t)]}))}))},e.prototype.createSpace=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._setChannelMetadata(e,t)]}))}))},e.prototype.updateSpace=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._setChannelMetadata(e,t)]}))}))},e.prototype.removeSpace=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects._removeChannelMetadata(e,t)]}))}))},e.prototype.fetchMemberships=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects.fetchMemberships(e,t)]}))}))},e.prototype.addMemberships=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects.addMemberships(e,t)]}))}))},e.prototype.updateMemberships=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return[2,this.objects.addMemberships(e,t)]}))}))},e.prototype.removeMemberships=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,a,u,c;return o(this,(function(o){return"spaceId"in e?(r={channel:null!==(a=(n=e).spaceId)&&void 0!==a?a:n.channel,uuids:null!==(u=n.userIds)&&void 0!==u?u:n.uuids,limit:0},t?[2,this.objects.removeChannelMembers(r,t)]:[2,this.objects.removeChannelMembers(r)]):(s={uuid:(i=e).userId,channels:null!==(c=i.spaceIds)&&void 0!==c?c:i.channels,limit:0},t?[2,this.objects.removeMemberships(s,t)]:[2,this.objects.removeMemberships(s)])}))}))},Object.defineProperty(e.prototype,"channelGroups",{get:function(){return this._channelGroups},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"push",{get:function(){return this._push},enumerable:!1,configurable:!0}),e.prototype.sendFile=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s;return o(this,(function(o){if(!this._configuration.PubNubFile)throw new Error("Validation failed: 'PubNubFile' not configured or file upload not supported by the platform.");return r=new Xt(n(n({},e),{cipherKey:null!==(s=e.cipherKey)&&void 0!==s?s:this._configuration.cipherKey,keySet:this._configuration.keySet,PubNubFile:this._configuration.PubNubFile,fileUploadPublishRetryLimit:this._configuration.fileUploadPublishRetryLimit,file:e.file,sendRequest:this.sendRequest,publishFile:this.publishFile,crypto:this._configuration.cryptoModule,cryptography:this.cryptography?this.cryptography:void 0})),i={error:!1,operation:pe.PNPublishFileOperation,statusCode:0},[2,r.process().then((function(e){return i.statusCode=e.status,t?t(i,e):e})).catch((function(e){var n=e.toStatus(i.operation);throw t&&t(n,null),new v("REST API request processing error, check status for details",n)}))]}))}))},e.prototype.publishFile=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){if(!this._configuration.PubNubFile)throw new Error("Validation failed: 'PubNubFile' not configured or file upload not supported by the platform.");return r=new Ht(n(n({},e),{keySet:this._configuration.keySet,crypto:this._configuration.cryptoModule})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.listFiles=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Wt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.getFileUrl=function(e){var t,r=this.transport.request(new zt(n(n({},e),{keySet:this._configuration.keySet})).request()),i=null!==(t=r.queryParameters)&&void 0!==t?t:{},o=Object.keys(i).map((function(e){var t=i[e];return Array.isArray(t)?t.map((function(t){return"".concat(e,"=").concat(H(t))})).join("&"):"".concat(e,"=").concat(H(t))})).join("&");return"".concat(r.origin).concat(r.path,"?").concat(o)},e.prototype.downloadFile=function(e,t){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(o){switch(o.label){case 0:if(!this._configuration.PubNubFile)throw new Error("Validation failed: 'PubNubFile' not configured or file upload not supported by the platform.");return r=new Un(n(n({},e),{cipherKey:null!==(i=e.cipherKey)&&void 0!==i?i:this._configuration.cipherKey,keySet:this._configuration.keySet,PubNubFile:this._configuration.PubNubFile,cryptography:this.cryptography?this.cryptography:void 0,crypto:this._configuration.cryptoModule})),t?[2,this.sendRequest(r,t)]:[4,this.sendRequest(r)];case 1:return[2,o.sent()]}}))}))},e.prototype.deleteFile=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){return r=new Vt(n(n({},e),{keySet:this._configuration.keySet})),t?[2,this.sendRequest(r,t)]:[2,this.sendRequest(r)]}))}))},e.prototype.time=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){return t=new Tn,e?[2,this.sendRequest(t,e)]:[2,this.sendRequest(t)]}))}))},e.prototype.encrypt=function(e,t){if(void 0===t&&this._configuration.cryptoModule){var n=this._configuration.cryptoModule.encrypt(e);return"string"==typeof n?n:g(n)}if(!this.crypto)throw new Error("Encryption error: cypher key not set");return this.crypto.encrypt(e,t)},e.prototype.decrypt=function(e,t){if(void 0===t&&this._configuration.cryptoModule){var n=this._configuration.cryptoModule.decrypt(e);return n instanceof ArrayBuffer?JSON.parse((new TextDecoder).decode(n)):n}if(!this.crypto)throw new Error("Decryption error: cypher key not set");return this.crypto.decrypt(e,t)},e.prototype.encryptFile=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File encryption error. File constructor not configured.");if("string"!=typeof e&&!this._configuration.cryptoModule)throw new Error("File encryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File encryption error. File encryption not available");return[2,this.cryptography.encryptFile(e,t,this._configuration.PubNubFile)]}return[2,null===(n=this._configuration.cryptoModule)||void 0===n?void 0:n.encryptFile(t,this._configuration.PubNubFile)]}))}))},e.prototype.decryptFile=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){if("string"!=typeof e&&(t=e),!t)throw new Error("File encryption error. Source file is missing.");if(!this._configuration.PubNubFile)throw new Error("File decryption error. File constructor not configured.");if("string"==typeof e&&!this._configuration.cryptoModule)throw new Error("File decryption error. Crypto module not configured.");if("string"==typeof e){if(!this.cryptography)throw new Error("File decryption error. File decryption not available");return[2,this.cryptography.decryptFile(e,t,this._configuration.PubNubFile)]}return[2,null===(n=this._configuration.cryptoModule)||void 0===n?void 0:n.decryptFile(t,this._configuration.PubNubFile)]}))}))},e.OPERATIONS=pe,e.CATEGORIES=X,e.ExponentialRetryPolicy=We.ExponentialRetryPolicy,e.LinearRetryPolicy=We.LinearRetryPolicy,e}(),Dn=function(){function e(e,t){this._base64ToBinary=t,this._decode=e}return e.prototype.decodeToken=function(e){var t="";e.length%4==3?t="=":e.length%4==2&&(t="==");var n=e.replace(/-/gi,"+").replace(/_/gi,"/")+t,r=this._decode(this._base64ToBinary(n));if("object"==typeof r)return r},e}();return function(e){function r(t){var r,i,o=this,s=q(t),a=function(e,t){var r,i,o;null===(r=e.retryConfiguration)||void 0===r||r.validate(),null!==(i=e.useRandomIVs)&&void 0!==i||(e.useRandomIVs=!0),e.origin=G(null!==(o=e.ssl)&&void 0!==o&&o,e.origin);var s=n(n({},e),{_pnsdkSuffix:{},_instanceId:"pn-".concat(K()),_cryptoModule:void 0,_cipherKey:void 0,_setupCryptoModule:t,get instanceId(){if(this.useInstanceId)return this._instanceId},getUserId:function(){return this.userId},setUserId:function(e){if(!e||"string"!=typeof e||0===e.trim().length)throw new Error("Missing or invalid userId parameter. Provide a valid string userId");this.userId=e},getAuthKey:function(){return this.authKey},setAuthKey:function(e){this.authKey=e},getFilterExpression:function(){return this.filterExpression},setFilterExpression:function(e){this.filterExpression=e},get cipherKey(){return this._cipherKey},setCipherKey:function(t){this._cipherKey=t,t||!this._cryptoModule?t&&this._setupCryptoModule&&(this._cryptoModule=this._setupCryptoModule({cipherKey:t,useRandomIVs:e.useRandomIVs,customEncrypt:this.customEncrypt,customDecrypt:this.customDecrypt})):this._cryptoModule=void 0},get cryptoModule(){return this._cryptoModule},get useRandomIVs(){return e.useRandomIVs},getPresenceTimeout:function(){return this.presenceTimeout},getHeartbeatInterval:function(){return this.heartbeatInterval},setHeartbeatInterval:function(e){this.heartbeatInterval=e},getTransactionTimeout:function(){return this.transactionalRequestTimeout},getSubscribeTimeout:function(){return this.subscribeRequestTimeout},get PubNubFile(){return e.PubNubFile},get version(){return"7.6.0"},getVersion:function(){return this.version},_addPnsdkSuffix:function(e,t){this._pnsdkSuffix[e]="".concat(t)},_getPnsdkSuffix:function(e){return Object.values(this._pnsdkSuffix).join(e)},getUUID:function(){return this.getUserId()},setUUID:function(e){this.setUserId(e)},get customEncrypt(){return e.customEncrypt},get customDecrypt(){return e.customDecrypt}});return e.cipherKey&&s.setCipherKey(e.cipherKey),s}(n(n({},s),{sdkFamily:"Nodejs",PubNubFile:d}),(function(e){if(e.cipherKey)return new j({default:new R(n({},e)),cryptors:[new C({cipherKey:e.cipherKey})]})})),u=new L(new Dn((function(e){return U(h.decode(e))}),y));if(a.cipherKey||a.secretKey){var c=a.secretKey,p=a.cipherKey,l=a.useRandomIVs,f=a.customEncrypt,g=a.customDecrypt;i=new N({secretKey:c,cipherKey:p,useRandomIVs:l,customEncrypt:f,customDecrypt:g})}var v=new J({clientConfiguration:a,tokenManager:u,transport:new Z(a.keepAlive,a.logVerbosity)});return o=e.call(this,{configuration:a,transport:v,cryptography:new A,tokenManager:u,crypto:i})||this,(null===(r=t.listenToBrowserNetworkEvents)||void 0===r||r)&&(window.addEventListener("offline",(function(){o.networkDownDetected()})),window.addEventListener("online",(function(){o.networkUpDetected()}))),o}return t(r,e),r.prototype.networkDownDetected=function(){this.listenerManager.announceNetworkDown(),this._configuration.restore?this.disconnect():this.destroy(!0)},r.prototype.networkUpDetected=function(){this.listenerManager.announceNetworkUp(),this.reconnect()},r.CryptoModule=j,r}(Fn)}));
