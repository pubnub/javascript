{"version":3,"sources":["core/components/endpoint.js"],"names":["PubNubError","message","status","name","constructor","Error","createError","errorPayload","type","error","createValidationError","decideURL","endpoint","modules","incomingParams","usePost","postURL","usePatch","patchURL","useGetFile","getFileURL","getURL","getAuthToken","token","generatePNSDK","config","sdkName","base","sdkFamily","partnerId","getVersion","pnsdkSuffix","_getPnsdkSuffix","length","getHttpMethod","useDelete","signRequest","url","outgoingParams","crypto","httpMethod","timestamp","Math","floor","Date","getTime","getOperation","signInput","publishKey","utils","signPamFromParams","payload","postPayload","JSON","stringify","patchPayload","signature","HMACSHA256","replace","networking","telemetryManager","requestId","uuidGenerator","createUUID","callback","promiseComponent","operationConstants","PNTimeOperation","PNChannelGroupsOperation","Promise","createPromise","validationResult","validateParams","reject","promise","prepareParams","callInstance","networkingParams","operation","timeout","getRequestTimeout","headers","getRequestHeaders","ignoreBody","forceBuffered","uuid","UUID","pnsdk","telemetryLatencies","operationsLatencyForRequest","Object","keys","useInstanceId","instanceid","instanceId","useRequestId","requestid","isAuthSupported","tokenOrKey","getAuthKey","auth","secretKey","onResponse","stopLatencyMeasure","responseP","handleResponse","then","resolve","result","fulfill","e","errorData","PNSubscribeOperation","statusCode","category","categoryConstants","PNUnknownCategory","startLatencyMeasure","POST","PATCH","DELETE","GETFILE","GET"],"mappings":"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","sourcesContent":["import uuidGenerator from './uuid';\nimport { StatusAnnouncement } from '../flow_interfaces';\nimport utils from '../utils';\nimport Config from './config';\nimport operationConstants from '../constants/operations';\nimport categoryConstants from '../constants/categories';\n\nexport class PubNubError extends Error {\n  constructor(message, status) {\n    super(message);\n    this.name = this.constructor.name;\n    this.status = status;\n    this.message = message;\n  }\n}\n\nfunction createError(errorPayload: Object, type: string): Object {\n  errorPayload.type = type;\n  errorPayload.error = true;\n  return errorPayload;\n}\n\nexport function createValidationError(message: string): Object {\n  return createError({ message }, 'validationError');\n}\n\nfunction decideURL(endpoint, modules, incomingParams) {\n  if (endpoint.usePost && endpoint.usePost(modules, incomingParams)) {\n    return endpoint.postURL(modules, incomingParams);\n  } else if (endpoint.usePatch && endpoint.usePatch(modules, incomingParams)) {\n    return endpoint.patchURL(modules, incomingParams);\n  } else if (endpoint.useGetFile && endpoint.useGetFile(modules, incomingParams)) {\n    return endpoint.getFileURL(modules, incomingParams);\n  } else {\n    return endpoint.getURL(modules, incomingParams);\n  }\n}\n\nfunction getAuthToken(endpoint, modules, incomingParams) {\n  let token;\n\n  if (endpoint.getAuthToken) {\n    token = endpoint.getAuthToken(modules, incomingParams);\n  }\n\n  return token;\n}\n\nexport function generatePNSDK(config: Config): string {\n  if (config.sdkName) {\n    return config.sdkName;\n  }\n\n  let base = `PubNub-JS-${config.sdkFamily}`;\n\n  if (config.partnerId) {\n    base += `-${config.partnerId}`;\n  }\n\n  base += `/${config.getVersion()}`;\n\n  let pnsdkSuffix = config._getPnsdkSuffix(' ');\n\n  if (pnsdkSuffix.length > 0) {\n    base += pnsdkSuffix;\n  }\n\n  return base;\n}\n\nfunction getHttpMethod(modules, endpoint, incomingParams) {\n  if (endpoint.usePost && endpoint.usePost(modules, incomingParams)) {\n    return 'POST';\n  } else if (endpoint.usePatch && endpoint.usePatch(modules, incomingParams)) {\n    return 'PATCH';\n  } else if (endpoint.useDelete && endpoint.useDelete(modules, incomingParams)) {\n    return 'DELETE';\n  } else if (endpoint.useGetFile && endpoint.useGetFile(modules, incomingParams)) {\n    return 'GETFILE';\n  } else {\n    return 'GET';\n  }\n}\n\nexport function signRequest(modules, url, outgoingParams, incomingParams, endpoint) {\n  let { config, crypto } = modules;\n\n  let httpMethod = getHttpMethod(modules, endpoint, incomingParams);\n\n  outgoingParams.timestamp = Math.floor(new Date().getTime() / 1000);\n\n  // This is because of a server-side bug, old publish using post should be deprecated\n  if (endpoint.getOperation() === 'PNPublishOperation' && endpoint.usePost && endpoint.usePost(modules, incomingParams)) {\n    httpMethod = 'GET';\n  }\n\n  if (httpMethod === 'GETFILE') {\n    httpMethod = 'GET';\n  }\n\n  let signInput = `${httpMethod}\\n${config.publishKey}\\n${url}\\n${utils.signPamFromParams(outgoingParams)}\\n`;\n\n  if (httpMethod === 'POST') {\n    let payload = endpoint.postPayload(modules, incomingParams);\n    if (typeof payload === 'string') {\n      signInput += payload;\n    } else {\n      signInput += JSON.stringify(payload);\n    }\n  } else if (httpMethod === 'PATCH') {\n    let payload = endpoint.patchPayload(modules, incomingParams);\n    if (typeof payload === 'string') {\n      signInput += payload;\n    } else {\n      signInput += JSON.stringify(payload);\n    }\n  }\n\n  let signature = `v2.${crypto.HMACSHA256(signInput)}`;\n  signature = signature.replace(/\\+/g, '-');\n  signature = signature.replace(/\\//g, '_');\n  signature = signature.replace(/=+$/, '');\n\n  outgoingParams.signature = signature;\n}\n\nexport default function (modules, endpoint, ...args) {\n  let { networking, config, telemetryManager } = modules;\n  const requestId = uuidGenerator.createUUID();\n  let callback = null;\n  let promiseComponent = null;\n  let incomingParams = {};\n\n  if (\n    endpoint.getOperation() === operationConstants.PNTimeOperation ||\n    endpoint.getOperation() === operationConstants.PNChannelGroupsOperation\n  ) {\n    callback = args[0];\n  } else {\n    incomingParams = args[0];\n    callback = args[1];\n  }\n\n  // bridge in Promise support.\n  if (typeof Promise !== 'undefined' && !callback) {\n    promiseComponent = utils.createPromise();\n  }\n\n  let validationResult = endpoint.validateParams(modules, incomingParams);\n\n  if (validationResult) {\n    if (callback) {\n      return callback(createValidationError(validationResult));\n    } else if (promiseComponent) {\n      promiseComponent.reject(\n        new PubNubError('Validation failed, check status for details', createValidationError(validationResult))\n      );\n      return promiseComponent.promise;\n    }\n    return;\n  }\n\n  let outgoingParams = endpoint.prepareParams(modules, incomingParams);\n  let url = decideURL(endpoint, modules, incomingParams);\n  let callInstance;\n  let networkingParams = {\n    url,\n    operation: endpoint.getOperation(),\n    timeout: endpoint.getRequestTimeout(modules),\n    headers: endpoint.getRequestHeaders ? endpoint.getRequestHeaders() : {},\n    ignoreBody: typeof endpoint.ignoreBody === 'function' ? endpoint.ignoreBody(modules) : false,\n    forceBuffered:\n      typeof endpoint.forceBuffered === 'function' ? endpoint.forceBuffered(modules, incomingParams) : null,\n  };\n\n  outgoingParams.uuid = config.UUID;\n  outgoingParams.pnsdk = generatePNSDK(config);\n\n  // Add telemetry information (if there is any available).\n  const telemetryLatencies = telemetryManager.operationsLatencyForRequest();\n  if (Object.keys(telemetryLatencies).length) {\n    outgoingParams = { ...outgoingParams, ...telemetryLatencies };\n  }\n\n  if (config.useInstanceId) {\n    outgoingParams.instanceid = config.instanceId;\n  }\n\n  if (config.useRequestId) {\n    outgoingParams.requestid = requestId;\n  }\n\n  if (endpoint.isAuthSupported()) {\n    let token = getAuthToken(endpoint, modules, incomingParams);\n    let tokenOrKey = token || config.getAuthKey();\n\n    if (tokenOrKey) {\n      outgoingParams.auth = tokenOrKey;\n    }\n  }\n\n  if (config.secretKey) {\n    signRequest(modules, url, outgoingParams, incomingParams, endpoint);\n  }\n\n  let onResponse = (status: StatusAnnouncement, payload: Object) => {\n    if (status.error) {\n      if (callback) {\n        callback(status);\n      } else if (promiseComponent) {\n        promiseComponent.reject(new PubNubError('PubNub call failed, check status for details', status));\n      }\n      return;\n    }\n\n    // Stop endpoint latency tracking.\n    telemetryManager.stopLatencyMeasure(endpoint.getOperation(), requestId);\n\n    let responseP = endpoint.handleResponse(modules, payload, incomingParams);\n\n    if (typeof responseP?.then !== 'function') {\n      responseP = Promise.resolve(responseP);\n    }\n\n    responseP\n      .then((result) => {\n        if (callback) {\n          callback(status, result);\n        } else if (promiseComponent) {\n          promiseComponent.fulfill(result);\n        }\n      })\n      .catch((e) => {\n        if (callback) {\n          let errorData = e;\n\n          if (endpoint.getOperation() === operationConstants.PNSubscribeOperation) {\n            errorData = {\n              statusCode: 400,\n              error: true,\n              operation: endpoint.getOperation(),\n              errorData: e,\n              category: categoryConstants.PNUnknownCategory\n            };\n          }\n\n          callback(errorData, null);\n        } else if (promiseComponent) {\n          promiseComponent.reject(new PubNubError('PubNub call failed, check status for details', e));\n        }\n      });\n  };\n\n  // Start endpoint latency tracking.\n  telemetryManager.startLatencyMeasure(endpoint.getOperation(), requestId);\n\n  if (getHttpMethod(modules, endpoint, incomingParams) === 'POST') {\n    let payload = endpoint.postPayload(modules, incomingParams);\n    callInstance = networking.POST(outgoingParams, payload, networkingParams, onResponse);\n  } else if (getHttpMethod(modules, endpoint, incomingParams) === 'PATCH') {\n    let payload = endpoint.patchPayload(modules, incomingParams);\n    callInstance = networking.PATCH(outgoingParams, payload, networkingParams, onResponse);\n  } else if (getHttpMethod(modules, endpoint, incomingParams) === 'DELETE') {\n    callInstance = networking.DELETE(outgoingParams, networkingParams, onResponse);\n  } else if (getHttpMethod(modules, endpoint, incomingParams) === 'GETFILE') {\n    callInstance = networking.GETFILE(outgoingParams, networkingParams, onResponse);\n  } else {\n    callInstance = networking.GET(outgoingParams, networkingParams, onResponse);\n  }\n\n  if (endpoint.getOperation() === operationConstants.PNSubscribeOperation) {\n    return callInstance;\n  }\n\n  if (promiseComponent) {\n    return promiseComponent.promise;\n  }\n}\n"],"file":"endpoint.js"}