{"version":3,"sources":["core/components/push_payload.js"],"names":["BaseNotificationPayload","payload","title","body","_payload","_setDefaultPayloadStructure","value","_title","_subtitle","_body","_badge","_sound","APNSNotificationPayload","length","_configurations","aps","alert","subtitle","undefined","badge","sound","_isSilent","_apnsPushType","ReferenceError","configurations","forEach","configuration","push","_objectFromAPNS2Configuration","pn_push","Object","keys","targets","target","_objectFromAPNSTarget","collapseId","expirationDate","objectifiedConfiguration","auth_method","version","collapse_id","expiration","toISOString","topic","TypeError","environment","excludedDevices","objectifiedTarget","excluded_devices","MPNSNotificationPayload","_backContent","back_content","_backTitle","back_title","_count","count","_type","type","backTitle","backContent","FCMNotificationPayload","notification","data","_icon","icon","_tag","tag","initialNotification","initialData","additionalData","NotificationsPayload","apns","mpns","fcm","_debugging","platforms","includes","apnsPayload","toObject","pn_apns","mpnsPayload","pn_mpns","fcmPayload","pn_gcm","pn_debug"],"mappings":"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","sourcesContent":["/* @flow */\n/* eslint max-classes-per-file: [\"error\", 5] */\nimport { APNS2Configuration, APNS2Target } from '../flow_interfaces';\n\nclass BaseNotificationPayload {\n  _subtitle: ?string;\n  _payload: Object;\n  _badge: ?number;\n  _sound: ?string;\n  _title: ?string;\n  _body: ?string;\n\n  get payload() {\n    return this._payload;\n  }\n\n  set title(value: ?string) {\n    this._title = value;\n  }\n\n  set subtitle(value: ?string) {\n    this._subtitle = value;\n  }\n\n  set body(value: ?string) {\n    this._body = value;\n  }\n\n  set badge(value: ?number) {\n    this._badge = value;\n  }\n\n  set sound(value: ?string) {\n    this._sound = value;\n  }\n\n  constructor(payload: Object, title: ?string, body: ?string) {\n    this._payload = payload;\n\n    this._setDefaultPayloadStructure();\n    this.title = title;\n    this.body = body;\n  }\n\n  _setDefaultPayloadStructure() {\n  }\n\n  toObject() {\n    return {};\n  }\n}\n\nexport class APNSNotificationPayload extends BaseNotificationPayload {\n  _configurations: Array<APNS2Configuration>;\n  _apnsPushType: ?string;\n  _isSilent: boolean;\n\n  set configurations(value: Array<APNS2Configuration>) {\n    if (!value || !value.length) return;\n\n    this._configurations = value;\n  }\n\n  get notification() {\n    return this._payload.aps;\n  }\n\n  get title() {\n    return this._title;\n  }\n\n  set title(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.aps.alert.title = value;\n    this._title = value;\n  }\n\n  get subtitle() {\n    return this._subtitle;\n  }\n\n  set subtitle(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.aps.alert.subtitle = value;\n    this._subtitle = value;\n  }\n\n  get body() {\n    return this._body;\n  }\n\n  set body(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.aps.alert.body = value;\n    this._body = value;\n  }\n\n  get badge() {\n    return this._badge;\n  }\n\n  set badge(value: ?number) {\n    if (value === undefined || value === null) return;\n\n    this._payload.aps.badge = value;\n    this._badge = value;\n  }\n\n  get sound() {\n    return this._sound;\n  }\n\n  set sound(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.aps.sound = value;\n    this._sound = value;\n  }\n\n  set silent(value: boolean) {\n    this._isSilent = value;\n  }\n\n  _setDefaultPayloadStructure() {\n    this._payload.aps = { alert: {} };\n  }\n\n  toObject(): ?Object {\n    let payload = { ...this._payload };\n    /** @type {{alert: Object, badge: number, sound: string}} */\n    let aps = payload.aps;\n    let alert = aps.alert;\n\n    if (this._isSilent) {\n      aps['content-available'] = 1;\n    }\n\n    if (this._apnsPushType === 'apns2') {\n      if (!this._configurations || !this._configurations.length) {\n        throw new ReferenceError('APNS2 configuration is missing');\n      }\n\n      let configurations = [];\n      this._configurations.forEach((configuration: APNS2Configuration) => {\n        configurations.push(this._objectFromAPNS2Configuration(configuration));\n      });\n\n      if (configurations.length) {\n        payload.pn_push = configurations;\n      }\n    }\n\n    if (!alert || !Object.keys(alert).length) {\n      delete aps.alert;\n    }\n\n    if (this._isSilent) {\n      delete aps.alert;\n      delete aps.badge;\n      delete aps.sound;\n      alert = {};\n    }\n\n    return this._isSilent || Object.keys(alert).length ? payload : null;\n  }\n\n  _objectFromAPNS2Configuration(configuration: APNS2Configuration) {\n    if (!configuration.targets || !configuration.targets.length) {\n      throw new ReferenceError('At least one APNS2 target should be provided');\n    }\n\n    let targets = [];\n    configuration.targets.forEach((target: APNS2Target) => {\n      targets.push(this._objectFromAPNSTarget(target));\n    });\n\n    const { collapseId, expirationDate } = configuration;\n    let objectifiedConfiguration: {\n      auth_method: string,\n      targets: Array<Object>,\n      version: string,\n      collapse_id?: string,\n      expiration?: string\n    } = { auth_method: 'token', targets, version: 'v2' };\n\n    if (collapseId && collapseId.length) {\n      objectifiedConfiguration.collapse_id = collapseId;\n    }\n\n    if (expirationDate) {\n      objectifiedConfiguration.expiration = expirationDate.toISOString();\n    }\n\n    return objectifiedConfiguration;\n  }\n\n  _objectFromAPNSTarget(target: APNS2Target) {\n    if (!target.topic || !target.topic.length) {\n      throw new TypeError('Target \\'topic\\' undefined.');\n    }\n\n    const {\n      topic,\n      environment = 'development',\n      excludedDevices = []\n    } = target;\n\n    let objectifiedTarget: {\n      topic: string,\n      environment: string,\n      excluded_devices?: Array<string>\n    } = { topic, environment };\n\n    if (excludedDevices.length) {\n      objectifiedTarget.excluded_devices = excludedDevices;\n    }\n\n    return objectifiedTarget;\n  }\n}\n\nexport class MPNSNotificationPayload extends BaseNotificationPayload  {\n  _backContent: ?string;\n  _backTitle: ?string;\n  _count: ?number;\n  _type: ?string;\n\n  get backContent() {\n    return this._backContent;\n  }\n\n  set backContent(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.back_content = value;\n    this._backContent = value;\n  }\n\n  get backTitle() {\n    return this._backTitle;\n  }\n\n  set backTitle(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.back_title = value;\n    this._backTitle = value;\n  }\n\n  get count() {\n    return this._count;\n  }\n\n  set count(value: ?number) {\n    if (value === undefined || value === null) return;\n\n    this._payload.count = value;\n    this._count = value;\n  }\n\n  get title() {\n    return this._title;\n  }\n\n  set title(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.title = value;\n    this._title = value;\n  }\n\n  get type() {\n    return this._type;\n  }\n\n  set type(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.type = value;\n    this._type = value;\n  }\n\n  get subtitle() {\n    return this.backTitle;\n  }\n\n  set subtitle(value: ?string) {\n    this.backTitle = value;\n  }\n\n  get body() {\n    return this.backContent;\n  }\n\n  set body(value: ?string) {\n    this.backContent = value;\n  }\n\n  get badge() {\n    return this.count;\n  }\n\n  set badge(value: ?number) {\n    this.count = value;\n  }\n\n  toObject(): ?Object {\n    return Object.keys(this._payload).length ? { ...this._payload } : null;\n  }\n}\n\nexport class FCMNotificationPayload extends BaseNotificationPayload  {\n  _isSilent: boolean;\n  _icon: ?string;\n  _tag: ?string;\n\n  get notification() {\n    return this._payload.notification;\n  }\n\n  get data() {\n    return this._payload.data;\n  }\n\n  get title() {\n    return this._title;\n  }\n\n  set title(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.notification.title = value;\n    this._title = value;\n  }\n\n  get body() {\n    return this._body;\n  }\n\n  set body(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.notification.body = value;\n    this._body = value;\n  }\n\n  get sound() {\n    return this._sound;\n  }\n\n  set sound(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.notification.sound = value;\n    this._sound = value;\n  }\n\n  get icon() {\n    return this._icon;\n  }\n\n  set icon(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.notification.icon = value;\n    this._icon = value;\n  }\n\n  get tag() {\n    return this._tag;\n  }\n\n  set tag(value: ?string) {\n    if (!value || !value.length) return;\n\n    this._payload.notification.tag = value;\n    this._tag = value;\n  }\n\n  set silent(value: boolean) {\n    this._isSilent = value;\n  }\n\n  _setDefaultPayloadStructure() {\n    this._payload.notification = {};\n    this._payload.data = {};\n  }\n\n  toObject(): ?Object {\n    let data = { ...this._payload.data };\n    let notification = null;\n    let payload = {};\n\n    /**\n     * Check whether additional data has been passed outside of 'data' object\n     * and put it into it if required.\n     */\n    if (Object.keys(this._payload).length > 2) {\n      let { notification: initialNotification, data: initialData, ...additionalData } = this._payload;\n\n      data = { ...data, ...additionalData };\n    }\n\n    if (this._isSilent) {\n      data.notification = this._payload.notification;\n    } else {\n      notification = this._payload.notification;\n    }\n\n    if (Object.keys(data).length) {\n      payload.data = data;\n    }\n\n    if (notification && Object.keys(notification).length) {\n      payload.notification = notification;\n    }\n\n    return Object.keys(payload).length ? payload : null;\n  }\n}\n\nclass NotificationsPayload {\n  _payload: {apns: Object, mpns: Object, fcm: Object};\n  _debugging: boolean;\n  _subtitle: ?string;\n  _badge: ?number;\n  _sound: ?string;\n  _title: ?string;\n  _body: ?string;\n  apns: APNSNotificationPayload;\n  mpns: MPNSNotificationPayload;\n  fcm: FCMNotificationPayload;\n\n  set debugging(value: boolean) {\n    this._debugging = value;\n  }\n\n  get title() {\n    return this._title;\n  }\n\n  get body() {\n    return this._body;\n  }\n\n  get subtitle() {\n    return this._subtitle;\n  }\n\n  set subtitle(value: ?string) {\n    this._subtitle = value;\n    this.apns.subtitle = value;\n    this.mpns.subtitle = value;\n    this.fcm.subtitle = value;\n  }\n\n  get badge() {\n    return this._badge;\n  }\n\n  set badge(value: ?number) {\n    this._badge = value;\n    this.apns.badge = value;\n    this.mpns.badge = value;\n    this.fcm.badge = value;\n  }\n\n  get sound() {\n    return this._sound;\n  }\n\n  set sound(value: ?string) {\n    this._sound = value;\n    this.apns.sound = value;\n    this.mpns.sound = value;\n    this.fcm.sound = value;\n  }\n\n  constructor(title: ?string, body: ?string) {\n    this._payload = { apns: {}, mpns: {}, fcm: {} };\n    this._title = title;\n    this._body = body;\n\n    this.apns = new APNSNotificationPayload(this._payload.apns, title, body);\n    this.mpns = new MPNSNotificationPayload(this._payload.mpns, title, body);\n    this.fcm = new FCMNotificationPayload(this._payload.fcm, title, body);\n  }\n\n  /**\n   * Build notifications platform for requested platforms.\n   *\n   * @param {Array<string>} platforms - List of platforms for which payload\n   * should be added to final dictionary. Supported values: gcm, apns, apns2,\n   * mpns.\n   *\n   * @returns {Object} Object with data, which can be sent with publish method\n   * call and trigger remote notifications for specified platforms.\n   */\n  buildPayload(platforms: Array<string>) {\n    let payload = {};\n\n    if (platforms.includes('apns') || platforms.includes('apns2')) {\n      this.apns._apnsPushType = platforms.includes('apns') ? 'apns' : 'apns2';\n      let apnsPayload = this.apns.toObject();\n\n      if (apnsPayload && Object.keys(apnsPayload).length) {\n        payload.pn_apns = apnsPayload;\n      }\n    }\n\n    if (platforms.includes('mpns')) {\n      let mpnsPayload = this.mpns.toObject();\n\n      if (mpnsPayload && Object.keys(mpnsPayload).length) {\n        payload.pn_mpns = mpnsPayload;\n      }\n    }\n\n    if (platforms.includes('fcm')) {\n      let fcmPayload = this.fcm.toObject();\n\n      if (fcmPayload && Object.keys(fcmPayload).length) {\n        payload.pn_gcm = fcmPayload;\n      }\n    }\n\n    if (Object.keys(payload).length && this._debugging) {\n      payload.pn_debug = true;\n    }\n\n    return payload;\n  }\n}\n\nexport default NotificationsPayload;\n"],"file":"push_payload.js"}