{"version":3,"sources":["core/endpoints/history/message_counts.js"],"names":["getOperation","operationConstants","PNMessageCounts","validateParams","modules","incomingParams","channels","timetoken","channelTimetokens","config","length","subscribeKey","getURL","stringifiedChannels","join","utils","encodeString","getRequestTimeout","getTransactionTimeout","isAuthSupported","prepareParams","outgoingParams","tt","channelsTimetoken","handleResponse","serverResponse"],"mappings":";;;;;;;;;;;;;;;;;AAEA;;AACA;;AAQO,SAASA,YAAT,GAAgC;AACrC,SAAOC,uBAAmBC,eAA1B;AACD;;AAEM,SAASC,cAAT,CAAwBC,OAAxB,EAAgDC,cAAhD,EAAyF;AAC9F,MAAMC,QAAN,GAAiDD,cAAjD,CAAMC,QAAN;AAAA,MAAgBC,SAAhB,GAAiDF,cAAjD,CAAgBE,SAAhB;AAAA,MAA2BC,iBAA3B,GAAiDH,cAAjD,CAA2BG,iBAA3B;AACA,MAAMC,MAAN,GAAiBL,OAAjB,CAAMK,MAAN;AAEA,MAAI,CAACH,QAAL,EAAe,OAAO,iBAAP;AACf,MAAIC,SAAS,IAAIC,iBAAjB,EAAoC,OAAO,2DAAP;AACpC,MAAKD,SAAS,IAAIC,iBAAd,IAAqCA,iBAAiB,CAACE,MAAlB,GAA2B,CAAhE,IAAuEJ,QAAQ,CAACI,MAAT,KAAoBF,iBAAiB,CAACE,MAAjH,EAA0H,OAAO,uDAAP;AAC1H,MAAI,CAACD,MAAM,CAACE,YAAZ,EAA0B,OAAO,uBAAP;AAC3B;;AAEM,SAASC,MAAT,CAAgBR,OAAhB,EAAwCC,cAAxC,EAAyF;AAC9F,MAAMC,QAAN,GAAmBD,cAAnB,CAAMC,QAAN;AACA,MAAMG,MAAN,GAAiBL,OAAjB,CAAMK,MAAN;AAEA,MAAII,mBAAmB,GAAGP,QAAQ,CAACQ,IAAT,CAAc,GAAd,CAA1B;AAEA,uCAA8BL,MAAM,CAACE,YAArC,6BAAoEI,kBAAMC,YAAN,CAAmBH,mBAAnB,CAApE;AACD;;AAEM,SAASI,iBAAT,OAA+D;AAAA,MAAlCR,MAAkC,QAAlCA,MAAkC;AACpE,SAAOA,MAAM,CAACS,qBAAP,EAAP;AACD;;AAEM,SAASC,eAAT,GAAoC;AACzC,SAAO,IAAP;AACD;;AAEM,SAASC,aAAT,CAAuBhB,OAAvB,EAA+CC,cAA/C,EAAgG;AACrG,MAAQE,SAAR,GAAyCF,cAAzC,CAAQE,SAAR;AAAA,MAAmBC,iBAAnB,GAAyCH,cAAzC,CAAmBG,iBAAnB;AACA,MAAIa,cAAsB,GAAG,EAA7B;;AAEA,MAAKb,iBAAD,IAAwBA,iBAAiB,CAACE,MAAlB,KAA6B,CAAzD,EAA6D;AAC3D,6DAAWF,iBAAX;AAAA,QAAKc,EAAL;;AACAD,IAAAA,cAAc,CAACd,SAAf,GAA2Be,EAA3B;AACD,GAHD,MAGO,IAAId,iBAAJ,EAAuB;AAC5Ba,IAAAA,cAAc,CAACE,iBAAf,GAAmCf,iBAAiB,CAACM,IAAlB,CAAuB,GAAvB,CAAnC;AACD,GAFM,MAEA,IAAIP,SAAJ,EAAe;AACpBc,IAAAA,cAAc,CAACd,SAAf,GAA2BA,SAA3B;AACD;;AAED,SAAOc,cAAP;AACD;;AAEM,SAASG,cAAT,CAAwBpB,OAAxB,EAAgDqB,cAAhD,EAAkH;AACvH,SAAO;AAAEnB,IAAAA,QAAQ,EAAEmB,cAAc,CAACnB;AAA3B,GAAP;AACD","sourcesContent":["/* @flow */\n\nimport operationConstants from '../../constants/operations';\nimport utils from '../../utils';\nimport type {\n  MessageCounterArguments,\n  MessageCountersResponse,\n  ModulesInject\n} from '../../flow_interfaces';\n\n\nexport function getOperation(): string {\n  return operationConstants.PNMessageCounts;\n}\n\nexport function validateParams(modules: ModulesInject, incomingParams: MessageCounterArguments) {\n  let { channels, timetoken, channelTimetokens } = incomingParams;\n  let { config } = modules;\n\n  if (!channels) return 'Missing channel';\n  if (timetoken && channelTimetokens) return 'timetoken and channelTimetokens are incompatible together';\n  if ((timetoken && channelTimetokens) && (channelTimetokens.length > 1) && (channels.length !== channelTimetokens.length)) return 'Length of channelTimetokens and channels do not match';\n  if (!config.subscribeKey) return 'Missing Subscribe Key';\n}\n\nexport function getURL(modules: ModulesInject, incomingParams: MessageCounterArguments): string {\n  let { channels } = incomingParams;\n  let { config } = modules;\n\n  let stringifiedChannels = channels.join(',');\n\n  return `/v3/history/sub-key/${config.subscribeKey}/message-counts/${utils.encodeString(stringifiedChannels)}`;\n}\n\nexport function getRequestTimeout({ config }: ModulesInject): boolean {\n  return config.getTransactionTimeout();\n}\n\nexport function isAuthSupported(): boolean {\n  return true;\n}\n\nexport function prepareParams(modules: ModulesInject, incomingParams: MessageCounterArguments): Object {\n  const { timetoken, channelTimetokens } = incomingParams;\n  let outgoingParams: Object = {};\n\n  if ((channelTimetokens) && (channelTimetokens.length === 1)) {\n    let [tt] = channelTimetokens;\n    outgoingParams.timetoken = tt;\n  } else if (channelTimetokens) {\n    outgoingParams.channelsTimetoken = channelTimetokens.join(',');\n  } else if (timetoken) {\n    outgoingParams.timetoken = timetoken;\n  }\n\n  return outgoingParams;\n}\n\nexport function handleResponse(modules: ModulesInject, serverResponse: MessageCounterArguments): MessageCountersResponse {\n  return { channels: serverResponse.channels };\n}\n"],"file":"message_counts.js"}