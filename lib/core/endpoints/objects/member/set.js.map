{"version":3,"sources":["core/endpoints/objects/member/set.js"],"names":["endpoint","getOperation","operationConstants","PNSetMembersOperation","validateParams","_","params","channel","uuids","length","usePatch","patchURL","config","subscribeKey","patchPayload","set","remove","type","map","uuid","id","custom","getRequestTimeout","getTransactionTimeout","isAuthSupported","getAuthToken","tokenManager","getToken","prepareParams","_modules","queryParams","include","customFields","push","customUUIDFields","UUIDFields","totalCount","count","page","next","start","prev","end","filter","limit","sort","Object","entries","key","value","handleResponse","response","status","data"],"mappings":"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","sourcesContent":["/** @flow */\n\nimport type { EndpointConfig } from '../../endpoint';\nimport operationConstants from '../../../constants/operations';\nimport type { Member, PaginatedResultParams } from './member';\n\ntype CommonParams = {\n  channel: string,\n};\n\nexport type RemoveMembersParams = {\n  type: 'remove',\n  uuids: (string | { id: string, custom?: empty })[],\n} & CommonParams & PaginatedResultParams;\n\nexport type UpsertMembersParams = {\n  type: 'set',\n  uuids: (string | { id: string, custom?: any })[]\n} & CommonParams & PaginatedResultParams;\n\nexport type SetMembersParams = RemoveMembersParams | UpsertMembersParams;\n\nexport type SetMembersResult = {|\n  status: 200,\n  data: Member,\n  totalCount?: number,\n  prev?: string,\n  next?: string,\n|};\n\nconst endpoint: EndpointConfig<SetMembersParams, SetMembersResult> = {\n  getOperation: () => operationConstants.PNSetMembersOperation,\n\n  validateParams: (_, params) => {\n    if (!params?.channel) {\n      return 'Channel cannot be empty';\n    }\n\n    if (!params?.uuids || params?.uuids.length === 0) {\n      return 'UUIDs cannot be empty';\n    }\n  },\n\n  usePatch: () => true,\n\n  patchURL: ({ config }, params) => `/v2/objects/${config.subscribeKey}/channels/${params.channel}/uuids`,\n\n  patchPayload: (_, params) => ({\n    set: [],\n    remove: [],\n    [params.type]: params.uuids.map((uuid) => {\n      if (typeof uuid === 'string') {\n        return {\n          uuid: {\n            id: uuid\n          }\n        };\n      } else {\n        return {\n          uuid: { id: uuid.id },\n          custom: uuid.custom,\n        };\n      }\n    })\n  }),\n\n  getRequestTimeout: ({ config }) => config.getTransactionTimeout(),\n\n  isAuthSupported: () => true,\n\n  getAuthToken: ({ tokenManager }) => tokenManager.getToken('member'),\n\n  prepareParams: (_modules, params) => {\n    const queryParams = {};\n\n    if (params?.include) {\n      queryParams.include = [];\n\n      if (params.include?.customFields) {\n        queryParams.include.push('custom');\n      }\n\n      if (params.include?.customUUIDFields) {\n        queryParams.include.push('uuid.custom');\n      }\n\n      if (params.include?.UUIDFields) {\n        queryParams.include.push('uuid');\n      }\n    }\n\n    if (params?.include?.totalCount) {\n      queryParams.count = true;\n    }\n\n    if (params?.page?.next) {\n      queryParams.start = params.page?.next;\n    }\n\n    if (params?.page?.prev) {\n      queryParams.end = params.page?.prev;\n    }\n\n    if (params?.filter) {\n      queryParams.filter = params.filter;\n    }\n\n    if (params?.limit) {\n      queryParams.limit = params.limit;\n    }\n\n    if (params?.sort) {\n      queryParams.sort = Object.entries(params.sort ?? {}).map(([key, value]) => {\n        if (value === 'asc' || value === 'desc') {\n          return `${key}:${value}`;\n        } else {\n          return key;\n        }\n      });\n    }\n\n    return queryParams;\n  },\n\n  handleResponse: (_, response) => ({\n    status: response.status,\n    data: response.data,\n    totalCount: response.totalCount,\n    prev: response.prev,\n    next: response.next,\n  }),\n};\n\nexport default endpoint;\n"],"file":"set.js"}